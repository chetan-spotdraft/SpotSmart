<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpotSmart | Implementation Readiness Assessment</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ============================================
           CSS VARIABLES & RESET
           ============================================ */
        :root {
            /* SpotDraft Brand Colors */
            --primary: #0B1E62;
            --primary-light: #1a3a8f;
            --primary-dark: #071440;
            --secondary: #923313;
            --secondary-light: #b84a1f;
            --secondary-dark: #6d260e;
            
            /* Neutrals */
            --white: #FFFFFF;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            
            /* Status Colors */
            --success: #059669;
            --success-light: #D1FAE5;
            --warning: #D97706;
            --warning-light: #FEF3C7;
            --error: #DC2626;
            --error-light: #FEE2E2;
            --info: #2563EB;
            --info-light: #DBEAFE;
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            --space-3xl: 4rem;
            
            /* Border Radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-base: 200ms ease;
            --transition-slow: 300ms ease;
        }
        
        /* Reset */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 50%, var(--gray-100) 100%);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* ============================================
           LAYOUT
           ============================================ */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .app-header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: var(--space-md) var(--space-xl);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
        }
        
        .logo-text {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        /* Progress Bar */
        .progress-container {
            flex: 1;
            max-width: 600px;
            margin: 0 var(--space-xl);
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-xs);
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: var(--radius-full);
            transition: width var(--transition-slow);
            width: 0%;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: var(--space-2xl) var(--space-3xl);
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* ============================================
           WELCOME SCREEN
           ============================================ */
        .welcome-screen {
            text-align: center;
            padding: var(--space-3xl) var(--space-xl);
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .welcome-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-xl);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
        }
        
        .welcome-icon svg {
            width: 40px;
            height: 40px;
            color: var(--white);
        }
        
        .welcome-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: var(--space-md);
        }
        
        .welcome-subtitle {
            font-size: 1.125rem;
            color: var(--gray-600);
            max-width: 800px;
            margin: 0 auto var(--space-2xl);
        }
        
        .welcome-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-2xl);
            text-align: left;
        }
        
        .feature-card {
            background: var(--white);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
            transition: all var(--transition-base);
        }
        
        .feature-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .feature-icon {
            width: 40px;
            height: 40px;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--space-md);
            color: var(--primary);
        }
        
        .feature-title {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: var(--space-xs);
        }
        
        .feature-desc {
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        /* ============================================
           USER TYPE SELECTION
           ============================================ */
        .user-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }
        
        .user-type-card {
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }
        
        .user-type-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }
        
        .user-type-card.selected {
            border-color: var(--primary);
            background: rgba(11, 30, 98, 0.02);
            box-shadow: var(--shadow-md);
        }
        
        .user-type-card-header {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            flex: 1;
        }
        
        .user-type-icon {
            width: 56px;
            height: 56px;
            background: var(--gray-100);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            flex-shrink: 0;
            transition: all var(--transition-base);
        }
        
        .user-type-card.selected .user-type-icon {
            background: var(--primary);
            color: var(--white);
        }
        
        .user-type-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
        }
        
        .user-type-description {
            color: var(--gray-600);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-top: var(--space-xs);
        }
        
        .user-type-check {
            position: absolute;
            top: var(--space-lg);
            right: var(--space-lg);
            width: 28px;
            height: 28px;
            background: var(--gray-200);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            transition: all var(--transition-base);
        }
        
        .user-type-card.selected .user-type-check {
            background: var(--primary);
            color: var(--white);
        }
        
        .user-type-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            background: var(--gray-100);
            color: var(--gray-700);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: var(--space-xs);
        }
        
        .user-type-card.selected .user-type-badge {
            background: var(--primary);
            color: var(--white);
        }
        
        .user-type-card:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        .user-type-card:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        .skip-default-link {
            display: block;
            text-align: center;
            margin-top: var(--space-md);
            font-size: 0.875rem;
            color: var(--gray-500);
            text-decoration: none;
            cursor: pointer;
            transition: color var(--transition-fast);
        }
        
        .skip-default-link:hover {
            color: var(--primary);
            text-decoration: underline;
        }
        
        .microcopy {
            text-align: center;
            margin-top: var(--space-md);
            font-size: 0.75rem;
            color: var(--gray-500);
            line-height: 1.5;
        }
        
        /* ============================================
           AUTO-SAVE UI
           ============================================ */
        .save-indicator {
            position: fixed;
            top: var(--space-lg);
            right: var(--space-lg);
            background: var(--success);
            color: var(--white);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 500;
            display: none;
            align-items: center;
            gap: var(--space-xs);
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-base);
        }
        
        .save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .save-indicator svg {
            width: 16px;
            height: 16px;
        }
        
        .restore-prompt {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--white);
            border: 2px solid var(--primary);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow-xl);
            z-index: 2000;
            max-width: 500px;
            width: 90%;
            display: none;
        }
        
        .restore-prompt h3 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-md);
        }
        
        .restore-prompt p {
            color: var(--gray-600);
            margin-bottom: var(--space-lg);
        }
        
        .restore-prompt-actions {
            display: flex;
            gap: var(--space-md);
            justify-content: flex-end;
        }
        
        .restore-btn {
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .restore-btn.primary {
            background: var(--primary);
            color: var(--white);
            border: none;
        }
        
        .restore-btn.primary:hover {
            background: var(--primary-light);
        }
        
        .restore-btn.secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }
        
        .restore-btn.secondary:hover {
            background: var(--gray-200);
        }
        
        /* ============================================
           FORM SECTIONS
           ============================================ */
        .form-section {
            display: none;
            animation: fadeInUp 0.4s ease-out;
        }
        
        .form-section.active {
            display: block;
        }
        
        .section-header {
            margin-bottom: var(--space-xl);
        }
        
        .section-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            background: var(--primary);
            color: var(--white);
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-md);
        }
        
        .section-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-sm);
        }
        
        .section-description {
            color: var(--gray-600);
            font-size: 1rem;
        }
        
        /* Form Card */
        .form-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            border: 1px solid var(--gray-200);
            padding: var(--space-xl);
            box-shadow: var(--shadow-sm);
        }
        
        /* Form Groups */
        .form-group {
            margin-bottom: var(--space-lg);
        }
        
        .form-group:last-child {
            margin-bottom: 0;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--space-sm);
            font-size: 0.875rem;
        }
        
        .form-label .required {
            color: var(--error);
            margin-left: 2px;
        }
        
        .form-hint {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: var(--space-xs);
        }
        
        /* Input Fields */
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--space-md);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 1rem;
            color: var(--gray-800);
            background: var(--white);
            transition: all var(--transition-fast);
        }
        
        .form-input:hover,
        .form-select:hover,
        .form-textarea:hover {
            border-color: var(--gray-400);
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(11, 30, 98, 0.1);
        }
        
        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--gray-400);
        }
        
        .form-input.error,
        .form-select.error,
        .form-textarea.error {
            border-color: var(--error);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Input Groups */
        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
        }
        
        /* Two Column Layout for Form Fields */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-lg);
        }
        
        .form-grid .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        /* POC Card */
        .poc-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
        }
        
        .poc-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--space-lg);
        }
        
        .poc-cards-grid .poc-card {
            margin-bottom: 0;
        }
        
        .poc-card-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--gray-200);
        }
        
        .poc-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
        }
        
        .poc-title {
            font-weight: 600;
            color: var(--gray-800);
        }
        
        .poc-subtitle {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        /* Toggle Switch */
        .toggle-group {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .toggle {
            position: relative;
            width: 52px;
            height: 28px;
            background: var(--gray-300);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: background var(--transition-fast);
        }
        
        .toggle.active {
            background: var(--primary);
        }
        
        .toggle-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: var(--white);
            border-radius: 50%;
            box-shadow: var(--shadow-sm);
            transition: transform var(--transition-fast);
        }
        
        .toggle.active .toggle-knob {
            transform: translateX(24px);
        }
        
        .toggle-label {
            font-size: 0.875rem;
            color: var(--gray-700);
        }
        
        /* Multi-select Chips */
        .chip-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
        }
        
        .chip {
            display: inline-flex;
            align-items: center;
            padding: var(--space-sm) var(--space-md);
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-fast);
            user-select: none;
        }
        
        .chip:hover {
            border-color: var(--primary);
            background: var(--gray-50);
        }
        
        .chip.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--white);
        }
        
        .chip-icon {
            width: 16px;
            height: 16px;
            margin-right: var(--space-xs);
        }
        
        /* Date Picker */
        .form-input[type="date"] {
            cursor: pointer;
        }
        
        /* ============================================
           BUTTONS
           ============================================ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-xl);
            border: none;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--white);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }
        
        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }
        
        .btn-lg {
            padding: var(--space-lg) var(--space-2xl);
            font-size: 1.125rem;
        }
        
        .btn-icon {
            width: 20px;
            height: 20px;
        }
        
        /* Button Group */
        .btn-group {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-xl);
            padding-top: var(--space-xl);
            border-top: 1px solid var(--gray-200);
        }
        
        .btn-group .btn-secondary {
            flex: 0 0 auto;
        }
        
        .btn-group .btn-primary {
            flex: 1;
        }
        
        /* ============================================
           CONDITIONAL SECTIONS
           ============================================ */
        .conditional-section {
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        
        .conditional-section.visible {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ============================================
           FILE UPLOAD
           ============================================ */
        .file-upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-lg);
            padding: var(--space-2xl);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-base);
            background: var(--gray-50);
        }
        
        .file-upload-area:hover {
            border-color: var(--primary);
            background: var(--white);
        }
        
        .file-upload-area.drag-over {
            border-color: var(--primary);
            background: rgba(11, 30, 98, 0.05);
        }
        
        .file-upload-area.has-file {
            border-style: solid;
            border-color: var(--success);
            background: var(--success-light);
        }
        
        .file-upload-icon {
            color: var(--gray-400);
            margin-bottom: var(--space-md);
        }
        
        .file-upload-text {
            color: var(--gray-600);
            margin-bottom: var(--space-xs);
        }
        
        .file-upload-primary {
            color: var(--primary);
            font-weight: 600;
        }
        
        .file-upload-hint {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .file-upload-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md);
            background: var(--success-light);
            border: 1px solid var(--success);
            border-radius: var(--radius-md);
            margin-top: var(--space-md);
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            color: var(--success);
            font-weight: 500;
        }
        
        .file-remove-btn {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            padding: var(--space-xs);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .file-remove-btn:hover {
            color: var(--error);
            background: var(--error-light);
        }
        
        .parsing-status {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--info-light);
            border: 1px solid var(--info);
            border-radius: var(--radius-md);
            margin-top: var(--space-md);
            color: var(--info);
            font-size: 0.875rem;
        }
        
        .parsing-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--info-light);
            border-top-color: var(--info);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ============================================
           PREFILL NOTIFICATIONS
           ============================================ */
        .prefill-notification {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            margin-top: var(--space-md);
            animation: slideDown 0.3s ease-out;
        }
        
        .prefill-notification.success {
            background: var(--success-light);
            border: 1px solid var(--success);
        }
        
        .prefill-notification.error {
            background: var(--error-light);
            border: 1px solid var(--error);
        }
        
        .prefill-notification-icon {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .prefill-notification.success .prefill-notification-icon {
            color: var(--success);
        }
        
        .prefill-notification.error .prefill-notification-icon {
            color: var(--error);
        }
        
        .prefill-notification-content {
            flex: 1;
        }
        
        .prefill-notification-title {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: var(--space-xs);
        }
        
        .prefill-notification-desc {
            font-size: 0.875rem;
            color: var(--gray-600);
            line-height: 1.5;
        }
        
        .prefill-notification-desc small {
            color: var(--gray-500);
            font-style: italic;
        }
        
        .prefill-notification-close {
            flex-shrink: 0;
            background: none;
            border: none;
            color: var(--gray-400);
            cursor: pointer;
            padding: var(--space-xs);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }
        
        .prefill-notification-close:hover {
            color: var(--gray-600);
            background: rgba(0, 0, 0, 0.05);
        }
        
        /* ============================================
           LOADING SCREEN
           ============================================ */
        .loading-screen { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.98); z-index: 1000; flex-direction: column; align-items: center; justify-content: center; }
        .loading-screen.active { display: flex; }
        .loading-spinner { width: 60px; height: 60px; border: 4px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: var(--space-xl); }
        .loading-title { font-family: 'Space Grotesk', sans-serif; font-size: 1.5rem; font-weight: 600; color: var(--gray-800); margin-bottom: var(--space-sm); }
        .loading-subtitle { color: var(--gray-500); text-align: center; max-width: 400px; margin-bottom: var(--space-xl); }
        .loading-progress-container { width: 100%; max-width: 400px; margin-top: var(--space-lg); }
        .loading-progress-bar { width: 100%; height: 8px; background: var(--gray-200); border-radius: var(--radius-full); overflow: hidden; position: relative; }
        .loading-progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: var(--radius-full); transition: width 0.3s ease-out; position: relative; }
        .loading-progress-fill::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent); animation: shimmer 2s infinite; }
        .loading-progress-text { text-align: center; color: var(--gray-600); font-size: 0.875rem; margin-top: var(--space-sm); }
        @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        
        /* ============================================
           RESULTS SCREEN
           ============================================ */
        .results-screen { display: none; animation: fadeInUp 0.6s ease-out; }
        .results-screen.active { display: block; }
        .score-card { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: var(--radius-xl); padding: var(--space-2xl); color: var(--white); text-align: center; margin-bottom: var(--space-xl); }
        .score-label { font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.8; margin-bottom: var(--space-md); }
        .score-value { font-family: 'Space Grotesk', sans-serif; font-size: 5rem; font-weight: 700; line-height: 1; margin-bottom: var(--space-md); }
        .score-status { font-size: 1.25rem; font-weight: 600; margin-bottom: var(--space-sm); }
        .score-description { opacity: 0.8; max-width: 500px; margin: 0 auto; }
        .score-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-md); margin-top: var(--space-xl); }
        .score-breakdown-item { background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-md); padding: var(--space-md); }
        .score-breakdown-label { font-size: 0.75rem; opacity: 0.8; margin-bottom: var(--space-xs); }
        .score-breakdown-value { font-size: 1.5rem; font-weight: 700; }
        .score-breakdown-bar { height: 4px; background: rgba(255, 255, 255, 0.2); border-radius: var(--radius-full); margin-top: var(--space-sm); overflow: hidden; }
        .score-breakdown-fill { height: 100%; background: var(--white); border-radius: var(--radius-full); }
        .results-section { background: var(--white); border-radius: var(--radius-xl); border: 1px solid var(--gray-200); padding: var(--space-xl); margin-bottom: var(--space-xl); }
        .results-section-title { font-family: 'Space Grotesk', sans-serif; font-size: 1.25rem; font-weight: 600; color: var(--gray-900); margin-bottom: var(--space-lg); display: flex; align-items: center; gap: var(--space-sm); }
        .red-flag-item { display: flex; gap: var(--space-md); padding: var(--space-md); background: var(--error-light); border-left: 4px solid var(--error); border-radius: var(--radius-md); margin-bottom: var(--space-md); }
        .red-flag-item.warning { background: var(--warning-light); border-left-color: var(--warning); }
        .red-flag-icon { flex-shrink: 0; width: 24px; height: 24px; color: var(--error); }
        .red-flag-item.warning .red-flag-icon { color: var(--warning); }
        .red-flag-content { flex: 1; }
        .red-flag-title { font-weight: 600; color: var(--gray-800); margin-bottom: var(--space-xs); }
        .red-flag-desc { font-size: 0.875rem; color: var(--gray-600); }
        .action-tabs { display: flex; gap: var(--space-sm); margin-bottom: var(--space-lg); border-bottom: 1px solid var(--gray-200); }
        .action-tab { padding: var(--space-md) var(--space-lg); border: none; background: none; font-family: inherit; font-size: 0.875rem; font-weight: 600; color: var(--gray-500); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; }
        .action-tab:hover { color: var(--gray-700); }
        .action-tab.active { color: var(--primary); border-bottom-color: var(--primary); }
        .action-tab-content { display: none; }
        .action-tab-content.active { display: block; }
        .action-item { display: flex; gap: var(--space-md); padding: var(--space-md); background: var(--gray-50); border-radius: var(--radius-md); margin-bottom: var(--space-sm); }
        .action-item-priority { flex-shrink: 0; width: 8px; border-radius: var(--radius-full); }
        .action-item-priority.high { background: var(--error); }
        .action-item-priority.medium { background: var(--warning); }
        .action-item-priority.low { background: var(--success); }
        .action-item-content { flex: 1; }
        .action-item-task { font-weight: 500; color: var(--gray-800); margin-bottom: var(--space-xs); }
        .action-item-meta { font-size: 0.75rem; color: var(--gray-500); display: flex; gap: var(--space-md); flex-wrap: wrap; }
        .timeline-phase { border: 1px solid var(--gray-200); border-radius: var(--radius-lg); margin-bottom: var(--space-md); overflow: hidden; }
        .timeline-phase-header { display: flex; align-items: center; justify-content: space-between; padding: var(--space-md) var(--space-lg); background: var(--gray-50); }
        .timeline-phase-title { font-weight: 600; color: var(--gray-800); }
        .timeline-phase-duration { font-size: 0.875rem; color: var(--gray-500); }
        .timeline-phase-status { font-size: 0.75rem; padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-full); }
        .timeline-phase-status.ready { background: var(--success-light); color: var(--success); }
        .timeline-phase-status.blocked { background: var(--error-light); color: var(--error); }
        .timeline-phase-status.partial { background: var(--warning-light); color: var(--warning); }
        .timeline-phase-content { padding: var(--space-lg); border-top: 1px solid var(--gray-200); }
        .timeline-activity { display: flex; align-items: flex-start; gap: var(--space-sm); padding: var(--space-sm) 0; font-size: 0.875rem; color: var(--gray-700); }
        .timeline-activity::before { content: 'â€¢'; color: var(--primary); font-weight: bold; }
        
        /* ============================================
           MODULE CARDS
           ============================================ */
        .module-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-md);
        }
        
        .module-card {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-lg);
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
        }
        
        .module-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }
        
        .module-card.selected {
            border-color: var(--primary);
            background: rgba(11, 30, 98, 0.03);
        }
        
        .module-card-icon {
            width: 48px;
            height: 48px;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            flex-shrink: 0;
            transition: all var(--transition-base);
        }
        
        .module-card.selected .module-card-icon {
            background: var(--primary);
            color: var(--white);
        }
        
        .module-card-content {
            flex: 1;
        }
        
        .module-card-title {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: var(--space-xs);
        }
        
        .module-card-desc {
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        .module-card-check {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
            width: 24px;
            height: 24px;
            background: var(--gray-200);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            transition: all var(--transition-base);
        }
        
        .module-card.selected .module-card-check {
            background: var(--primary);
            color: var(--white);
        }
        
        /* ============================================
           INTEGRATION CHIPS
           ============================================ */
        .integration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-md);
        }
        
        .integration-chip {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-lg);
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-base);
            text-align: center;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
        }
        
        .integration-chip:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }
        
        .integration-chip.selected {
            border-color: var(--primary);
            background: rgba(11, 30, 98, 0.03);
            color: var(--primary);
        }
        
        .integration-logo {
            width: 32px;
            height: 32px;
            color: var(--gray-500);
            transition: color var(--transition-base);
        }
        
        .integration-chip.selected .integration-logo {
            color: var(--primary);
        }
        
        /* ============================================
           ERROR MESSAGES
           ============================================ */
        .error-message {
            display: none;
            color: var(--error);
            font-size: 0.75rem;
            margin-top: var(--space-xs);
        }
        
        .error-message.visible {
            display: block;
        }
        
        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (max-width: 1024px) {
            .main-content {
                padding: var(--space-xl) var(--space-lg);
            }
            
            .poc-cards-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: var(--space-md);
            }
            
            .progress-container {
                margin: 0;
                max-width: 100%;
                width: 100%;
            }
            
            .main-content {
                padding: var(--space-lg) var(--space-md);
            }
            
            .welcome-title {
                font-size: 1.75rem;
            }
            
            .input-group {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column-reverse;
            }
            
            .btn-group .btn {
                width: 100%;
            }
            
            .user-type-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo-container">
                    <svg class="logo-icon" width="40" height="40" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M25.582 14.3336H20.9869L25.717 2.6109C25.8375 2.28891 25.6287 2.00158 25.344 2L15.9932 2.0021C15.8839 2.0021 15.7777 2.03204 15.6977 2.09823C15.6977 2.09823 12.2934 5.03351 11.2349 5.95906C11.1046 6.07304 11.041 6.176 10.9763 6.34199C10.433 7.73346 6.03596 18.5911 6.03596 18.5911C5.89537 18.9813 6.19706 19.1836 6.42282 19.1841H12.3837C12.3837 19.1841 8.98357 27.7457 8.98254 27.7504L8.31657 29.4182C8.15547 29.8221 8.62749 30.1788 8.95689 29.902C8.95689 29.902 25.3527 15.5155 25.8463 15.0937C26.1136 14.8652 26.0366 14.3336 25.5815 14.3336H25.582ZM18.3559 12.6837L17.7489 14.1871C17.7135 14.2759 17.6289 14.3336 17.5355 14.3336L11.2067 14.3279C11.1159 14.3279 11.0538 14.2338 11.0877 14.1472L11.6921 12.6501C11.7275 12.5608 11.8121 12.5025 11.906 12.5025H18.2374C18.3287 12.5025 18.3908 12.5971 18.3559 12.6837ZM20.1465 8.25717L19.5406 9.75948C19.5052 9.84825 19.4205 9.90604 19.3271 9.90604L12.9968 9.90341C12.906 9.90341 12.8439 9.80938 12.8778 9.72271L13.4812 8.22355C13.5166 8.13425 13.6012 8.07595 13.6951 8.07595H20.0275C20.1188 8.07595 20.1809 8.1705 20.146 8.25717H20.1465Z" fill="#0B1E62"/>
                    </svg>
                    <div class="logo-text">SpotSmart</div>
                </div>
                
                <div class="progress-container" id="progressContainer" style="display: none;">
                    <div class="progress-info">
                        <span id="progressText">Section 1 of 8</span>
                        <span id="progressPercent">12%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                    </svg>
                </div>
                <h1 class="welcome-title">Implementation Readiness Assessment</h1>
                <p class="welcome-subtitle">
                    Let's ensure your SpotDraft implementation is set up for success. 
                    This assessment will help us understand your requirements and create a tailored implementation plan.
                </p>
                
                <div class="welcome-features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 11l3 3L22 4"/>
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                            </svg>
                        </div>
                        <div class="feature-title">Readiness Score</div>
                        <div class="feature-desc">Get an instant assessment of your implementation readiness</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                        </div>
                        <div class="feature-title">Action Items</div>
                        <div class="feature-desc">Clear next steps for both your team and SpotDraft</div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                        </div>
                        <div class="feature-title">Custom Plan</div>
                        <div class="feature-desc">Auto-generated implementation timeline based on your needs</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: var(--space-md); flex-wrap: wrap; justify-content: center;">
                <button class="btn btn-primary btn-lg" onclick="startAssessment()">
                    Start Assessment
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                        <polyline points="12 5 19 12 12 19"/>
                    </svg>
                </button>
                </div>
            </div>
            
            <!-- Section 0: User Type Selection -->
            <div class="form-section" id="section0">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Getting Started
                    </div>
                    <h2 class="section-title">Who are you filling this for?</h2>
                    <p class="section-description">
                        Pick the role that best describes you so we show only the questions you need.
                    </p>
                </div>
                
                <div class="form-card">
                    <div class="user-type-grid">
                        <!-- Prospect Option -->
                        <div class="user-type-card" 
                             data-user-type="prospect" 
                             onclick="selectUserType('prospect')"
                             onkeydown="handleCardKeydown(event, 'prospect')"
                             tabindex="0"
                             role="button"
                             aria-pressed="false"
                             aria-label="Prospect - Quick readiness check">
                            <div class="user-type-check">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="user-type-card-header">
                                <div class="user-type-icon">
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                        <circle cx="9" cy="7" r="4"/>
                                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                    </svg>
                                </div>
                                <div>
                                    <div class="user-type-title">Prospect</div>
                                    <div class="user-type-description">
                                        Planning to purchase SpotDraft and want a quick readiness check? This scan shows effort, high level timeline, and key blockers to expect before purchase.
                                    </div>
                                    <div class="user-type-badge" title="Estimated time to complete: ~5 minutes">
                                        Quick (~5 mins)
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Customer Option -->
                        <div class="user-type-card" 
                             data-user-type="customer" 
                             onclick="selectUserType('customer')"
                             onkeydown="handleCardKeydown(event, 'customer')"
                             tabindex="0"
                             role="button"
                             aria-pressed="false"
                             aria-label="Customer - Full readiness report">
                            <div class="user-type-check">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="user-type-card-header">
                                <div class="user-type-icon">
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                        <circle cx="9" cy="7" r="4"/>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                    </svg>
                                </div>
                                <div>
                                    <div class="user-type-title">Customer</div>
                                    <div class="user-type-description">
                                        Ready to start implementation? Get a full readiness report, actionable gaps, and a preview of the customised implementation plan.
                                    </div>
                                    <div class="user-type-badge" title="Estimated time to complete: ~10 minutes">
                                        Full (~10 mins)
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Implementation Manager Option -->
                        <div class="user-type-card" 
                             data-user-type="implementation_manager" 
                             onclick="selectUserType('implementation_manager')"
                             onkeydown="handleCardKeydown(event, 'implementation_manager')"
                             tabindex="0"
                             role="button"
                             aria-pressed="false"
                             aria-label="SpotDraft Implementation Manager - Detailed plan with internal notes">
                            <div class="user-type-check">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                            <div class="user-type-card-header">
                                <div class="user-type-icon">
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                        <path d="M2 17l10 5 10-5"/>
                                        <path d="M2 12l10 5 10-5"/>
                                    </svg>
                                </div>
                                <div>
                                    <div class="user-type-title">SpotDraft Implementation Manager</div>
                                    <div class="user-type-description">
                                        Filling this on behalf of a customer? Provide detailed inputs and get a Rocketlane-ready plan and internal notes.
                                    </div>
                                    <div class="user-type-badge" title="Estimated time to complete: ~8 minutes">
                                        Detailed (~8 mins)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="goToWelcome()">Back</button>
                        <button class="btn btn-primary" id="continueFromUserType" onclick="proceedFromUserType()" disabled>
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                    
                    <a href="#" class="skip-default-link" onclick="skipToDefault(); return false;">
                        Skip and use default (Customer)
                    </a>
                    
                    <div class="microcopy">
                        You can save and return anytime. Answers are used to auto-generate a high-level plan, not to track delivery.
                    </div>
                </div>
            </div>
            
            <!-- ============================================
                 PROSPECT FLOW SECTIONS
                 ============================================ -->
            
            <!-- Prospect Section 1: Basics -->
            <div class="form-section" id="prospectSection1" data-persona="prospect">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Section 1 of 4
                    </div>
                    <h2 class="section-title">Basics</h2>
                    <p class="section-description">Let's start with some basic information about your organization.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                Company Name <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="prospectCompanyName" placeholder="Enter your company name" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Industry <span class="required">*</span>
                            </label>
                            <select class="form-select" id="prospectIndustry" required>
                                <option value="">Select industry</option>
                                <option value="Technology">Technology</option>
                                <option value="Financial Services">Financial Services</option>
                                <option value="Healthcare">Healthcare</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Retail">Retail</option>
                                <option value="Professional Services">Professional Services</option>
                                <option value="Real Estate">Real Estate</option>
                                <option value="Education">Education</option>
                                <option value="Government">Government</option>
                                <option value="Non-profit">Non-profit</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                No. of Users <span class="required">*</span>
                            </label>
                            <select class="form-select" id="prospectUserCount" required>
                                <option value="">Select range</option>
                                <option value="1-10">1â€“10</option>
                                <option value="10-50">10â€“50</option>
                                <option value="50-200">50â€“200</option>
                                <option value="200+">200+</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(1, 'prospect')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(1, 'prospect')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                    <div style="margin-top: var(--space-md); text-align: center;">
                        <button class="btn btn-test" onclick="fillProspectTestData()" style="background: var(--warning); color: var(--white); border: none; padding: var(--space-sm) var(--space-md); font-size: 0.875rem;">
                            ðŸ§ª Fill Test Data (Testing Only)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Prospect Section 2: Scope Clarity -->
            <div class="form-section" id="prospectSection2" data-persona="prospect">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        Section 2 of 4
                    </div>
                    <h2 class="section-title">Scope Clarity</h2>
                    <p class="section-description">Help us understand what you're looking for from SpotDraft.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">
                            Desired Modules <span class="required">*</span>
                        </label>
                        <div class="form-hint" style="margin-bottom: var(--space-md);">Select all that apply</div>
                        <div class="chip-group" id="prospectModules">
                            <div class="chip" data-value="Repository" onclick="toggleChip(this)">Repository</div>
                            <div class="chip" data-value="Approvals" onclick="toggleChip(this)">Approvals</div>
                            <div class="chip" data-value="Workflows" onclick="toggleChip(this)">Workflows</div>
                            <div class="chip" data-value="Assisted Migration" onclick="toggleChip(this)">Assisted Migration</div>
                            <div class="chip" data-value="Integrations" onclick="toggleChip(this)">Integrations</div>
                            <div class="chip" data-value="Not sure yet" onclick="toggleChip(this)">Not sure yet</div>
                        </div>
                        <div class="error-message" id="prospectModulesError">Please select at least one module</div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: var(--space-lg);">
                        <div class="form-group">
                            <label class="form-label">
                                Assisted Workflows <span class="required">*</span>
                            </label>
                            <select class="form-select" id="prospectAssistedWorkflows" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Contract Templates <span class="required">*</span>
                            </label>
                            <select class="form-select" id="prospectContractTemplates" required>
                                <option value="">Select</option>
                                <option value="Yes, all available">Yes, all available</option>
                                <option value="Yes, some available">Yes, some available</option>
                                <option value="No, need help">No, need help</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Assisted Migration <span class="required">*</span>
                            </label>
                            <select class="form-select" id="prospectAssistedMigration" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Legacy Contracts <span class="required">*</span>
                            </label>
                            <select class="form-select" id="prospectLegacyContracts" required>
                                <option value="">Select</option>
                                <option value="Yes, all available">Yes, all available</option>
                                <option value="Yes, some available">Yes, some available</option>
                                <option value="No, need help">No, need help</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(2, 'prospect')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(2, 'prospect')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Prospect Section 3: Systems and Integrations -->
            <div class="form-section" id="prospectSection3" data-persona="prospect">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="2" width="8" height="8" rx="1"/>
                            <rect x="14" y="2" width="8" height="8" rx="1"/>
                            <rect x="2" y="14" width="8" height="8" rx="1"/>
                            <rect x="14" y="14" width="8" height="8" rx="1"/>
                        </svg>
                        Section 3 of 4
                    </div>
                    <h2 class="section-title">Systems and Integrations</h2>
                    <p class="section-description">Tell us about your existing systems and integration needs.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">
                            Desired Integrations <span class="required">*</span>
                        </label>
                        <div class="form-hint" style="margin-bottom: var(--space-md);">Select all that apply</div>
                        <div class="chip-group" id="prospectSystems">
                            <div class="chip" data-value="CRM" onclick="toggleChip(this)">CRM</div>
                            <div class="chip" data-value="CPQ" onclick="toggleChip(this)">CPQ</div>
                            <div class="chip" data-value="HRIS" onclick="toggleChip(this)">HRIS</div>
                            <div class="chip" data-value="ERP" onclick="toggleChip(this)">ERP</div>
                            <div class="chip" data-value="Custom system" onclick="toggleChip(this)">Custom system</div>
                            <div class="chip" data-value="Others" onclick="toggleChip(this)">Others</div>
                        </div>
                        <div class="error-message" id="prospectSystemsError">Please select at least one system</div>
                    </div>
                    
                    <div class="form-group" style="margin-top: var(--space-lg);">
                        <label class="form-label">
                            API Access Available <span class="required">*</span>
                        </label>
                        <select class="form-select" id="prospectApiAccess" required>
                            <option value="">Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                            <option value="Not sure">Not sure</option>
                        </select>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(3, 'prospect')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(3, 'prospect')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Prospect Section 4: Timeline Readiness -->
            <div class="form-section" id="prospectSection4" data-persona="prospect">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        Section 4 of 5
                    </div>
                    <h2 class="section-title">Timeline Readiness</h2>
                    <p class="section-description">Help us understand your timeline and concerns.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                Desired Go-Live <span class="required">*</span>
                            </label>
                            <select class="form-select" id="prospectGoLiveTimeline" required>
                                <option value="">Select</option>
                                <option value="0-1 month">0â€“1 month</option>
                                <option value="1-3 months">1â€“3 months</option>
                                <option value="3-6 months">3â€“6 months</option>
                                <option value="6+ months">6+ months</option>
                                <option value="Not sure">Not sure</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: var(--space-lg);">
                        <label class="form-label">
                            Biggest Fear/Concern
                        </label>
                        <textarea class="form-textarea" id="prospectBiggestConcern" placeholder="Share your concerns or questions..."></textarea>
                        <div class="form-hint">Optional - This helps us address your specific needs</div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(4, 'prospect')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(4, 'prospect')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Prospect Section 5: Additional Context -->
            <div class="form-section" id="prospectSection5" data-persona="prospect">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        Section 5 of 5
                    </div>
                    <h2 class="section-title">Additional Context</h2>
                    <p class="section-description">Help us understand any additional factors that may impact your implementation.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">
                            Internal Bottlenecks
                        </label>
                        <textarea class="form-textarea" id="prospectInternalBottlenecks" placeholder="Describe any internal bottlenecks or constraints..."></textarea>
                        <div class="form-hint">Optional</div>
                    </div>
                    
                    <div class="form-group" style="margin-top: var(--space-lg);">
                        <label class="form-label">
                            Compliance Deadlines
                        </label>
                        <textarea class="form-textarea" id="prospectComplianceDeadlines" placeholder="Any compliance deadlines or regulatory requirements..."></textarea>
                        <div class="form-hint">Optional</div>
                    </div>
                    
                    <div class="form-group" style="margin-top: var(--space-lg);">
                        <label class="form-label">
                            Past CLM Experience
                        </label>
                        <textarea class="form-textarea" id="prospectPastCLMExperience" placeholder="Share your experience with other CLM systems..."></textarea>
                        <div class="form-hint">Optional</div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(5, 'prospect')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="submitProspectAssessment()">
                            Get Readiness Report
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                        </button>
                    </div>
                    <div style="margin-top: var(--space-md); text-align: center;">
                        <button class="btn btn-test" onclick="fillProspectTestData()" style="background: var(--warning); color: var(--white); border: none; padding: var(--space-sm) var(--space-md); font-size: 0.875rem;">
                            ðŸ§ª Fill Test Data (Testing Only)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ============================================
                 CUSTOMER FLOW SECTIONS
                 ============================================ -->
            
            <!-- Customer Section 1: Stakeholders -->
            <div class="form-section" id="customerSection1" data-persona="customer">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Section 1 of 7
                    </div>
                    <h2 class="section-title">Stakeholders</h2>
                    <p class="section-description">Let's identify the key people involved in your implementation.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                Primary POC Name <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="customerPrimaryContactName" placeholder="Full name" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Primary POC Role <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="customerPrimaryContactRole" placeholder="e.g., Legal Ops Manager" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Approving Stakeholder for Templates <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="customerTemplateApprover" placeholder="Name and role" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Approving Stakeholder for Migrations <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="customerMigrationApprover" placeholder="Name and role" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Approving Stakeholder for Integrations <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="customerIntegrationApprover" placeholder="Name and role" required>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(1, 'customer')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(1, 'customer')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                    <div style="margin-top: var(--space-md); text-align: center;">
                        <button class="btn btn-test" onclick="fillCustomerTestData()" style="background: var(--warning); color: var(--white); border: none; padding: var(--space-sm) var(--space-md); font-size: 0.875rem;">
                            ðŸ§ª Fill Test Data (Testing Only)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Customer Section 2: Purchased Scope -->
            <div class="form-section" id="customerSection2" data-persona="customer">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        Section 2 of 7
                    </div>
                    <h2 class="section-title">Purchased Scope</h2>
                    <p class="section-description">Tell us about what you've purchased and your template plans.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">
                            Which SpotDraft modules have you purchased? <span class="required">*</span>
                        </label>
                        <div class="form-hint" style="margin-bottom: var(--space-md);">Select all that apply</div>
                        <div class="chip-group" id="customerPurchasedModules">
                            <div class="chip" data-value="Repository" onclick="toggleChip(this)">Repository</div>
                            <div class="chip" data-value="Approvals" onclick="toggleChip(this)">Approvals</div>
                            <div class="chip" data-value="Assisted Workflows" onclick="toggleChip(this)">Assisted Workflows</div>
                            <div class="chip" data-value="Integrations" onclick="toggleChip(this)">Integrations</div>
                        </div>
                        <div class="error-message" id="customerPurchasedModulesError">Please select at least one module</div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(2, 'customer')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(2, 'customer')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Customer Section 3: Migration -->
            <div class="form-section" id="customerSection3" data-persona="customer">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        Section 3 of 7
                    </div>
                    <h2 class="section-title">Migration</h2>
                    <p class="section-description">Help us understand your migration needs.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">
                            Do you need to migrate existing contracts? <span class="required">*</span>
                        </label>
                        <select class="form-select" id="customerMigrationNeeded" onchange="toggleCustomerMigrationQuestions()" required>
                            <option value="">Select</option>
                            <option value="No">No</option>
                            <option value="Yes, partial">Yes, partial</option>
                            <option value="Yes, full">Yes, full</option>
                        </select>
                    </div>
                    
                    <div class="conditional-section" id="customerMigrationQuestionsSection">
                        <div class="form-grid" style="margin-top: var(--space-lg);">
                            <div class="form-group">
                                <label class="form-label">
                                    Volume of Contracts <span class="required">*</span>
                                </label>
                                <select class="form-select" id="customerMigrationContractCount" required>
                                    <option value="">Select</option>
                                    <option value="0-500">0â€“500</option>
                                    <option value="500-2000">500â€“2000</option>
                                    <option value="2000+">2000+</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    Current Location <span class="required">*</span>
                                </label>
                                <select class="form-select" id="customerContractStorage" required>
                                    <option value="">Select</option>
                                    <option value="Drive">Drive</option>
                                    <option value="Shared mailbox">Shared mailbox</option>
                                    <option value="Legacy CLM">Legacy CLM</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    Data Cleanliness <span class="required">*</span>
                                </label>
                                <select class="form-select" id="customerDataCleanliness" required>
                                    <option value="">Select</option>
                                    <option value="Clean">Clean</option>
                                    <option value="Mixed">Mixed</option>
                                    <option value="Messy">Messy</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    Data Format <span class="required">*</span>
                                </label>
                                <div class="chip-group" id="customerDataFormat">
                                    <div class="chip" data-value="PDF" onclick="toggleChip(this)">PDF</div>
                                    <div class="chip" data-value="DOC" onclick="toggleChip(this)">DOC</div>
                                    <div class="chip" data-value="Email exports" onclick="toggleChip(this)">Email exports</div>
                                </div>
                                <div class="error-message" id="customerDataFormatError">Please select at least one format</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(3, 'customer')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(3, 'customer')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Customer Section 4: Integrations -->
            <div class="form-section" id="customerSection4" data-persona="customer">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="2" width="8" height="8" rx="1"/>
                            <rect x="14" y="2" width="8" height="8" rx="1"/>
                            <rect x="2" y="14" width="8" height="8" rx="1"/>
                            <rect x="14" y="14" width="8" height="8" rx="1"/>
                        </svg>
                        Section 4 of 7
                    </div>
                    <h2 class="section-title">Integrations</h2>
                    <p class="section-description">Tell us about your integration requirements.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">
                            Which systems must integrate with SpotDraft? <span class="required">*</span>
                        </label>
                        <div class="form-hint" style="margin-bottom: var(--space-md);">Select all that apply</div>
                        <div class="chip-group" id="customerIntegrationSystems">
                            <div class="chip" data-value="CRM" onclick="toggleChip(this)">CRM</div>
                            <div class="chip" data-value="CPQ" onclick="toggleChip(this)">CPQ</div>
                            <div class="chip" data-value="HRIS" onclick="toggleChip(this)">HRIS</div>
                            <div class="chip" data-value="ERP" onclick="toggleChip(this)">ERP</div>
                            <div class="chip" data-value="Salesforce" onclick="toggleChip(this)">Salesforce</div>
                            <div class="chip" data-value="HubSpot" onclick="toggleChip(this)">HubSpot</div>
                            <div class="chip" data-value="DocuSign" onclick="toggleChip(this)">DocuSign</div>
                            <div class="chip" data-value="SSO" onclick="toggleChip(this)">SSO</div>
                            <div class="chip" data-value="Custom system" onclick="toggleChip(this)">Custom system</div>
                            <div class="chip" data-value="Others" onclick="toggleChip(this)">Others</div>
                        </div>
                        <div class="error-message" id="customerIntegrationSystemsError">Please select at least one system</div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: var(--space-lg);">
                        <div class="form-group">
                            <label class="form-label">
                                API Access Available <span class="required">*</span>
                            </label>
                            <select class="form-select" id="customerApiAccess" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="Not sure">Not sure</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Webhooks Supported <span class="required">*</span>
                            </label>
                            <select class="form-select" id="customerWebhooksSupport" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="Not sure">Not sure</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(4, 'customer')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(4, 'customer')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Customer Section 5: Business Processes -->
            <div class="form-section" id="customerSection5" data-persona="customer">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                        Section 5 of 7
                    </div>
                    <h2 class="section-title">Business Processes</h2>
                    <p class="section-description">Help us understand your workflow requirements.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                Approval Workflows <span class="required">*</span>
                            </label>
                            <select class="form-select" id="customerApprovalComplexity" required>
                                <option value="">Select</option>
                                <option value="Simple (1-2 steps)">Simple (1â€“2 steps)</option>
                                <option value="Medium (3-5 steps)">Medium (3â€“5 steps)</option>
                                <option value="Complex (5+ steps)">Complex (5+ steps)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Signatories <span class="required">*</span>
                            </label>
                            <select class="form-select" id="customerAgreementSigners" required>
                                <option value="">Select</option>
                                <option value="Internal only">Internal only</option>
                                <option value="Internal plus external">Internal plus external</option>
                                <option value="Mixed depending on template">Mixed depending on template</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(5, 'customer')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(5, 'customer')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Customer Section 6: Security and Access -->
            <div class="form-section" id="customerSection6" data-persona="customer">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                        Section 6 of 7
                    </div>
                    <h2 class="section-title">Security and Access</h2>
                    <p class="section-description">Tell us about your security and compliance requirements.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                Require SSO/SAML <span class="required">*</span>
                            </label>
                            <select class="form-select" id="customerSSORequired" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="Not sure">Not sure</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                VPN/IP Allowlisting/Data Residency Requirements <span class="required">*</span>
                            </label>
                            <select class="form-select" id="customerSecurityNeeds" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                DPA Status <span class="required">*</span>
                            </label>
                            <select class="form-select" id="customerDPAStatus" required>
                                <option value="">Select</option>
                                <option value="Signed">Signed</option>
                                <option value="In progress">In progress</option>
                                <option value="Not started">Not started</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(6, 'customer')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(6, 'customer')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Customer Section 7: Optional Uploads -->
            <div class="form-section" id="customerSection7" data-persona="customer">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Section 7 of 7
                    </div>
                    <h2 class="section-title">Optional Uploads</h2>
                    <p class="section-description">Upload documents to help us better understand your requirements.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Upload Template Contracts</label>
                            <input type="file" class="form-input" id="customerTemplates" accept=".docx,.pdf" multiple>
                            <div class="form-hint">Optional - Contract templates</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Upload Sample Legacy Contracts</label>
                            <input type="file" class="form-input" id="customerSampleContracts" accept=".pdf,.docx,.png,.jpg" multiple>
                            <div class="form-hint">Optional - Sample contracts or workflow diagrams</div>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(7, 'customer')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="submitCustomerAssessment()">
                            Submit Assessment
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                        </button>
                    </div>
                    <div style="margin-top: var(--space-md); text-align: center;">
                        <button class="btn btn-test" onclick="fillCustomerTestData()" style="background: var(--warning); color: var(--white); border: none; padding: var(--space-sm) var(--space-md); font-size: 0.875rem;">
                            ðŸ§ª Fill Test Data (Testing Only)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ============================================
                 IMPLEMENTATION MANAGER FLOW
                 ============================================ -->
            
            <!-- IM Section 1: Customer Context -->
            <div class="form-section" id="imSection1" data-persona="implementation_manager">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Section 1 of 6
                    </div>
                    <h2 class="section-title">Customer Context</h2>
                    <p class="section-description">Provide context about the customer and known risks.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                Company Name <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="imCustomerName" placeholder="Enter customer name" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Purchased Package <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imPackage" required>
                                <option value="">Select</option>
                                <option value="Standard">Standard</option>
                                <option value="Premium">Premium</option>
                                <option value="Enterprise">Enterprise</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Expected Implementation Complexity <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imComplexity" required>
                                <option value="">Select</option>
                                <option value="Low">Low</option>
                                <option value="Medium">Medium</option>
                                <option value="High">High</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: var(--space-lg);">
                        <label class="form-label">
                            Known Risks since Day 0
                        </label>
                        <div class="form-hint" style="margin-bottom: var(--space-md);">Select all that apply</div>
                        <div class="chip-group" id="imKnownRisks">
                            <div class="chip" data-value="Low responsiveness" onclick="toggleChip(this)">Low responsiveness</div>
                            <div class="chip" data-value="Lack of template readiness" onclick="toggleChip(this)">Lack of template readiness</div>
                            <div class="chip" data-value="Lack of technical ownership" onclick="toggleChip(this)">Lack of technical ownership</div>
                            <div class="chip" data-value="Security review delays" onclick="toggleChip(this)">Security review delays</div>
                            <div class="chip" data-value="Custom workflows expected" onclick="toggleChip(this)">Custom workflows expected</div>
                            <div class="chip" data-value="Integration feasibility unclear" onclick="toggleChip(this)">Integration feasibility unclear</div>
                        </div>
                        <div class="form-hint" style="margin-top: var(--space-sm);">Optional - If no risks, leave unselected</div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(1, 'implementation_manager')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(1, 'implementation_manager')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                    <div style="margin-top: var(--space-md); text-align: center;">
                        <button class="btn btn-test" onclick="fillIMTestData()" style="background: var(--warning); color: var(--white); border: none; padding: var(--space-sm) var(--space-md); font-size: 0.875rem;">
                            ðŸ§ª Fill Test Data (Testing Only)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- IM Section 2: Scope & Deliverables -->
            <div class="form-section" id="imSection2" data-persona="implementation_manager">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        Section 2 of 5
                    </div>
                    <h2 class="section-title">Template Needs</h2>
                    <p class="section-description">Define the scope and any custom development needs.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                Templates <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imTemplateCount" required>
                                <option value="">Select</option>
                                <option value="0-5">0â€“5</option>
                                <option value="5-15">5â€“15</option>
                                <option value="15+">15+</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Template Complexity <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imWorkflowComplexity" required>
                                <option value="">Select</option>
                                <option value="Simple (1-2 flows)">Simple (1â€“2 flows)</option>
                                <option value="Medium (3-5 flows)">Medium (3â€“5 flows)</option>
                                <option value="Complex (5+ flows)">Complex (5+ flows)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Custom Development Anticipated <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imCustomDevelopment" onchange="toggleIMCustomDevelopment()" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="conditional-section" id="imCustomDevelopmentSection">
                        <div class="form-group" style="margin-top: var(--space-lg);">
                            <label class="form-label">
                                Describe <span class="required">*</span>
                            </label>
                            <textarea class="form-textarea" id="imCustomDevelopmentDetails" placeholder="Describe the custom development requirements..."></textarea>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(2, 'implementation_manager')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(2, 'implementation_manager')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- IM Section 3: Migration Details -->
            <div class="form-section" id="imSection3" data-persona="implementation_manager">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        Section 3 of 5
                    </div>
                    <h2 class="section-title">Migration Needs</h2>
                    <p class="section-description">Provide details about migration requirements.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                Will migration require support from engineering? <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imMigrationEngineeringSupport" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Expected migration volume <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imMigrationVolume" required>
                                <option value="">Select</option>
                                <option value="None">None</option>
                                <option value="Small (0-500)">Small (0â€“500)</option>
                                <option value="Medium (500-2000)">Medium (500â€“2000)</option>
                                <option value="Large (2000+)">Large (2000+)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(3, 'implementation_manager')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(3, 'implementation_manager')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- IM Section 4: Integrations -->
            <div class="form-section" id="imSection4" data-persona="implementation_manager">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="2" width="8" height="8" rx="1"/>
                            <rect x="14" y="2" width="8" height="8" rx="1"/>
                            <rect x="2" y="14" width="8" height="8" rx="1"/>
                            <rect x="14" y="14" width="8" height="8" rx="1"/>
                        </svg>
                        Section 4 of 5
                    </div>
                    <h2 class="section-title">Integration Needs</h2>
                    <p class="section-description">Specify integration requirements and engineering needs.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-group">
                        <label class="form-label">
                            Integration types confirmed? <span class="required">*</span>
                        </label>
                        <div class="form-hint" style="margin-bottom: var(--space-md);">Select all that apply</div>
                        <div class="chip-group" id="imIntegrationTypes">
                            <div class="chip" data-value="CRM (SFDC, HubSpot, Zoho)" onclick="toggleChip(this)">CRM (SFDC, HubSpot, Zoho)</div>
                            <div class="chip" data-value="CPQ" onclick="toggleChip(this)">CPQ</div>
                            <div class="chip" data-value="HRIS" onclick="toggleChip(this)">HRIS</div>
                            <div class="chip" data-value="ERP" onclick="toggleChip(this)">ERP</div>
                            <div class="chip" data-value="Storage" onclick="toggleChip(this)">Storage</div>
                            <div class="chip" data-value="Custom API" onclick="toggleChip(this)">Custom API</div>
                        </div>
                        <div class="error-message" id="imIntegrationTypesError">Please select at least one integration type</div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: var(--space-lg);">
                        <div class="form-group">
                            <label class="form-label">
                                Does integration require engineering effort? <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imIntegrationEngineeringEffort" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                                <option value="Not sure">Not sure</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Do we foresee multiple UAT rounds for integrations? <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imIntegrationUATRounds" required>
                                <option value="">Select</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(4, 'implementation_manager')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(4, 'implementation_manager')">
                            Continue
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- IM Section 6: Timeline Expectations -->
            <div class="form-section" id="imSection6" data-persona="implementation_manager">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        Section 5 of 5
                    </div>
                    <h2 class="section-title">Timeline Expectations</h2>
                    <p class="section-description">Set realistic timeline expectations and identify blockers.</p>
                </div>
                
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                What is your realistic go-live expectation? <span class="required">*</span>
                            </label>
                            <select class="form-select" id="imGoLiveExpectation" required>
                                <option value="">Select</option>
                                <option value="4-6 weeks">4â€“6 weeks</option>
                                <option value="6-8 weeks">6â€“8 weeks</option>
                                <option value="8-12 weeks">8â€“12 weeks</option>
                                <option value="12+ weeks">12+ weeks</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: var(--space-lg);">
                        <label class="form-label">
                            Any known blockers that will delay the project?
                        </label>
                        <textarea class="form-textarea" id="imKnownBlockers" placeholder="Describe any known blockers or delays..."></textarea>
                        <div class="form-hint">Optional - This helps with timeline planning</div>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(6, 'implementation_manager')">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="submitIMAssessment()">
                            Generate Plan
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                        </button>
                    </div>
                    <div style="margin-top: var(--space-md); text-align: center;">
                        <button class="btn btn-test" onclick="fillIMTestData()" style="background: var(--warning); color: var(--white); border: none; padding: var(--space-sm) var(--space-md); font-size: 0.875rem;">
                            ðŸ§ª Fill Test Data (Testing Only)
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Legacy Section 1: Account & Stakeholder Identity (kept for backward compatibility) -->
            <div class="form-section" id="section1" data-persona="implementation_manager" style="display: none;">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Section 1 of 8
                    </div>
                    <h2 class="section-title">Account & Stakeholder Identity</h2>
                    <p class="section-description">Let's start by understanding who will be involved in this implementation.</p>
                </div>
                
                <div class="form-card">
                    <!-- Organisation Name -->
                    <div class="form-group" style="margin-bottom: var(--space-xl);">
                        <label class="form-label">
                            Organisation Name <span class="required">*</span>
                        </label>
                        <input type="text" class="form-input" id="orgName" placeholder="Enter your organisation name" required>
                        <div class="error-message" id="orgNameError">Please enter your organisation name</div>
                    </div>
                    
                    <!-- POC Cards Grid -->
                    <div class="poc-cards-grid">
                        <!-- Primary POC -->
                        <div class="poc-card">
                            <div class="poc-card-header">
                                <div class="poc-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                        <circle cx="12" cy="7" r="4"/>
                                    </svg>
                                </div>
                                <div>
                                    <div class="poc-title">Primary Point of Contact</div>
                                    <div class="poc-subtitle">Main person we'll coordinate with</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="form-group">
                                    <label class="form-label">Name <span class="required">*</span></label>
                                    <input type="text" class="form-input" id="primaryPocName" placeholder="Full name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Role <span class="required">*</span></label>
                                    <input type="text" class="form-input" id="primaryPocRole" placeholder="e.g., Legal Ops Manager" required>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="form-group">
                                    <label class="form-label">Email <span class="required">*</span></label>
                                    <input type="email" class="form-input" id="primaryPocEmail" placeholder="email@company.com" required onblur="validateEmailField('primaryPocEmail')">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Timezone <span class="required">*</span></label>
                                    <select class="form-select" id="primaryPocTimezone" required>
                                        <option value="">Select timezone</option>
                                        <option value="APAC">APAC</option>
                                        <option value="US">US</option>
                                        <option value="EMEA">EMEA</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Legal POC -->
                        <div class="poc-card">
                            <div class="poc-card-header">
                                <div class="poc-icon" style="background: var(--secondary);">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                    </svg>
                                </div>
                                <div>
                                    <div class="poc-title">Legal Point of Contact</div>
                                    <div class="poc-subtitle">For template and contract conversations</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="form-group">
                                    <label class="form-label">Name <span class="required">*</span></label>
                                    <input type="text" class="form-input" id="legalPocName" placeholder="Full name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Role <span class="required">*</span></label>
                                    <input type="text" class="form-input" id="legalPocRole" placeholder="e.g., Legal Counsel" required>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="form-group">
                                    <label class="form-label">Email <span class="required">*</span></label>
                                    <input type="email" class="form-input" id="legalPocEmail" placeholder="email@company.com" required onblur="validateEmailField('legalPocEmail')">
                                </div>
                            <div class="form-group">
                                <label class="form-label">Timezone <span class="required">*</span></label>
                                <select class="form-select" id="legalPocTimezone" required>
                                    <option value="">Select timezone</option>
                                    <option value="APAC">APAC</option>
                                    <option value="US">US</option>
                                    <option value="EMEA">EMEA</option>
                                </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Integrations Required Toggle -->
                    <div class="form-group" style="margin-top: var(--space-lg);">
                        <label class="form-label">Will you require integrations with external systems?</label>
                        <div class="toggle-group">
                            <div class="toggle" id="integrationsToggle" onclick="toggleIntegrations()">
                                <div class="toggle-knob"></div>
                            </div>
                            <span class="toggle-label" id="integrationsToggleLabel">No</span>
                        </div>
                    </div>
                    
                    <!-- Technical POC (Conditional) -->
                    <div class="conditional-section" id="technicalPocSection">
                        <div class="poc-card">
                            <div class="poc-card-header">
                                <div class="poc-icon" style="background: var(--info);">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                        <line x1="8" y1="21" x2="16" y2="21"/>
                                        <line x1="12" y1="17" x2="12" y2="21"/>
                                    </svg>
                                </div>
                                <div>
                                    <div class="poc-title">Technical / IT Point of Contact</div>
                                    <div class="poc-subtitle">For integration setup and configuration</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <div class="form-group">
                                    <label class="form-label">Name <span class="required">*</span></label>
                                    <input type="text" class="form-input" id="technicalPocName" placeholder="Full name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email <span class="required">*</span></label>
                                    <input type="email" class="form-input" id="technicalPocEmail" placeholder="email@company.com" onblur="validateEmailField('technicalPocEmail')">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Timezone <span class="required">*</span></label>
                                <select class="form-select" id="technicalPocTimezone">
                                    <option value="">Select timezone</option>
                                    <option value="APAC">APAC</option>
                                    <option value="US">US</option>
                                    <option value="EMEA">EMEA</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bottom Fields Grid -->
                    <div class="form-grid" style="margin-top: var(--space-lg);">
                        <!-- Availability -->
                        <div class="form-group">
                            <label class="form-label">
                                Availability for weekly checkpoints <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="availability" placeholder="e.g., Tuesdays and Thursdays, 2-4 PM EST" required>
                            <div class="form-hint">Please include days, times, and timezone</div>
                        </div>
                        
                        <!-- Desired Implementation Start Date -->
                        <div class="form-group">
                            <label class="form-label">
                                Desired implementation start date <span class="required">*</span>
                            </label>
                            <input type="date" class="form-input" id="implementationStartDate" required>
                            <div class="form-hint">When would you like to start the implementation?</div>
                        </div>
                        
                        <!-- Expected Go-Live (Calculated) -->
                        <div class="form-group">
                            <label class="form-label">
                                Expected launch timeline <span class="required">*</span>
                            </label>
                            <input type="date" class="form-input" id="expectedGoLive" required readonly>
                            <div class="form-hint">Calculated go-live date (typically 8-12 weeks from start date)</div>
                        </div>
                        
                        <!-- Communication Channels -->
                        <div class="form-group full-width">
                            <label class="form-label">
                                Preferred communication channels <span class="required">*</span>
                            </label>
                            <div class="chip-group" id="communicationChannels">
                                <div class="chip" data-value="Slack" onclick="toggleChip(this)">
                                    <svg class="chip-icon" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/>
                                    </svg>
                                    Slack
                                </div>
                                <div class="chip" data-value="MS Teams" onclick="toggleChip(this)">
                                    <svg class="chip-icon" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M20.625 8.073c.574 0 1.125.228 1.53.633.407.406.634.958.633 1.532v4.462a2.165 2.165 0 0 1-2.163 2.163h-1.238v3.114a3.321 3.321 0 0 1-3.318 3.318H9.645a3.321 3.321 0 0 1-3.318-3.318v-6.23H4.325a3.623 3.623 0 0 1-3.62-3.62V6.308a3.623 3.623 0 0 1 3.62-3.62h7.748a3.623 3.623 0 0 1 3.62 3.62v1.765h4.932zm-5.332 2.165v3.639h3.394V10.238h-3.394zm0-3.93v3.13h3.792a.765.765 0 0 0-.26-.58.766.766 0 0 0-.537-.215h-2.995v-2.335zm-1.6-3.62H4.325a2.222 2.222 0 0 0-2.22 2.22v3.82a2.222 2.222 0 0 0 2.22 2.22h2.002V6.308c0-.893.355-1.75.986-2.382a3.366 3.366 0 0 1 2.382-.986h4.998v-.453zM16.07 20.295V9.685a1.92 1.92 0 0 0-1.92-1.92H9.645a1.92 1.92 0 0 0-1.918 1.92v10.61c0 1.06.86 1.918 1.918 1.918h4.507a1.92 1.92 0 0 0 1.918-1.918z"/>
                                    </svg>
                                    MS Teams
                                </div>
                                <div class="chip" data-value="Email" onclick="toggleChip(this)">
                                    <svg class="chip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                        <polyline points="22,6 12,13 2,6"/>
                                    </svg>
                                    Email
                                </div>
                                <div class="chip" data-value="Video Meetings" onclick="toggleChip(this)">
                                    <svg class="chip-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="23 7 16 12 23 17 23 7"/>
                                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                                    </svg>
                                    Video Meetings
                                </div>
                            </div>
                            <div class="error-message" id="communicationError">Please select at least one communication channel</div>
                        </div>
                    </div>
                    
                    <!-- Navigation Buttons -->
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(1)">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(1)">
                            Continue to Order Form
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Section 2: Order Form Scope Validation -->
            <div class="form-section" id="section2">
                <div class="section-header">
                    <div class="section-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        Section 2 of 8
                    </div>
                    <h2 class="section-title">Order Form Scope Validation</h2>
                    <p class="section-description">Confirm the modules you've purchased and provide details about your implementation scope.</p>
                </div>
                
                <div class="form-card">
                    <!-- Purchased Modules -->
                    <div class="form-group">
                        <label class="form-label">
                            Purchased Modules <span class="required">*</span>
                        </label>
                        <div class="form-hint" style="margin-bottom: var(--space-md);">Select all modules included in your purchase</div>
                        <div class="module-cards" id="purchasedModules">
                            <div class="module-card" data-value="Template Setup" onclick="toggleModule(this)">
                                <div class="module-card-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10 9 9 9 8 9"/>
                                    </svg>
                                </div>
                                <div class="module-card-content">
                                    <div class="module-card-title">Template Setup</div>
                                    <div class="module-card-desc">Contract template creation and configuration</div>
                                </div>
                                <div class="module-card-check">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"/>
                                    </svg>
                                </div>
                            </div>
                            
                            <div class="module-card" data-value="Migration" onclick="toggleModule(this)">
                                <div class="module-card-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.66 0 3-4.03 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4.03-3-9s1.34-9 3-9m-9 9a9 9 0 0 1 9-9"/>
                                    </svg>
                                </div>
                                <div class="module-card-content">
                                    <div class="module-card-title">Migration</div>
                                    <div class="module-card-desc">Historical contracts migration and metadata extraction</div>
                                </div>
                                <div class="module-card-check">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"/>
                                    </svg>
                                </div>
                            </div>
                            
                            <div class="module-card" data-value="Integrations" onclick="toggleModule(this)">
                                <div class="module-card-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="2" y="2" width="8" height="8" rx="1"/>
                                        <rect x="14" y="2" width="8" height="8" rx="1"/>
                                        <rect x="2" y="14" width="8" height="8" rx="1"/>
                                        <rect x="14" y="14" width="8" height="8" rx="1"/>
                                        <path d="M10 6h4"/>
                                        <path d="M6 10v4"/>
                                        <path d="M18 10v4"/>
                                        <path d="M10 18h4"/>
                                    </svg>
                                </div>
                                <div class="module-card-content">
                                    <div class="module-card-title">Integrations</div>
                                    <div class="module-card-desc">Connect with your existing business systems</div>
                                </div>
                                <div class="module-card-check">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="error-message" id="modulesError">Please select at least one module</div>
                    </div>
                    
                    <!-- Additional Add-ons -->
                    <div class="form-group" style="margin-top: var(--space-lg);">
                        <label class="form-label">
                            Any additional add-ons or requirements?
                        </label>
                        <textarea class="form-textarea" id="additionalAddons" placeholder="Describe any additional requirements or add-ons..."></textarea>
                        <div class="form-hint">Optional - Let us know if there's anything else we should be aware of</div>
                    </div>
                    
                    <!-- Navigation Buttons -->
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="prevSection(2)">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="12" x2="5" y2="12"/>
                                <polyline points="12 19 5 12 12 5"/>
                            </svg>
                            Back
                        </button>
                        <button class="btn btn-primary" onclick="nextSection(2)">
                            Continue to Template Readiness
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12"/>
                                <polyline points="12 5 19 12 12 19"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Placeholder for other sections -->
            <!-- ============================================
                 SECTION 3: Template Readiness
                 ============================================ -->
            <div class="form-section" id="section3">
                <div class="section-header">
                    <div class="section-badge"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/></svg>Section 3 of 8</div>
                    <h2 class="section-title">Template Readiness & Complexity Scanner</h2>
                    <p class="section-description">Help us understand the complexity of your templates for accurate planning.</p>
                </div>
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">How many templates require setup? <span class="required">*</span></label><input type="number" class="form-input" id="s3TemplateCount" placeholder="e.g., 5" min="1"></div>
                        <div class="form-group"><label class="form-label">How many templates are finalised? <span class="required">*</span></label><input type="number" class="form-input" id="s3TemplatesFinalized" placeholder="e.g., 3" min="0"></div>
                        <div class="form-group"><label class="form-label">How many of the templates are supposed to be integrated/created from integrated? <span class="required">*</span></label><input type="number" class="form-input" id="s3IntegratedTemplates" placeholder="e.g., 2" min="0"></div>
                        <div class="form-group"><label class="form-label">Template formats <span class="required">*</span></label><div class="chip-group" id="s3TemplateFormats"><div class="chip" data-value="Word" onclick="toggleChip(this)">Word</div><div class="chip" data-value="PDF" onclick="toggleChip(this)">PDF</div><div class="chip" data-value="Google Docs" onclick="toggleChip(this)">Google Docs</div></div></div>
                        <div class="form-group"><label class="form-label">Do you need dynamic rendering of contract language/content? <span class="required">*</span></label><select class="form-select" id="s3DynamicRendering" onchange="toggleSection('s3DynamicRenderingComplexitySection')"><option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option></select></div>
                        <div class="conditional-section" id="s3DynamicRenderingComplexitySection"><div class="form-group"><label class="form-label">What is the complexity of dynamic rendering? <span class="required">*</span></label><select class="form-select" id="s3DynamicRenderingComplexity"><option value="">Select</option><option value="Simple">Simple</option><option value="Moderate">Moderate</option><option value="Complex">Complex</option></select></div></div>
                        <div class="form-group"><label class="form-label">Conditional logic complexity <span class="required">*</span></label><select class="form-select" id="s3ConditionalLogic"><option value="">Select</option><option value="None">None</option><option value="Simple">Simple</option><option value="Moderate">Moderate</option><option value="Complex">Complex</option></select></div>
                        <div class="form-group"><label class="form-label">Are there any merged templates that you want to build?</label><div class="form-hint" style="margin-bottom: var(--space-sm);">Unilateral and Mutual NDA can be merged into a single customer.</div><div class="toggle-group"><div class="toggle" id="s3MergedTemplates" onclick="toggleGeneric(this)"><div class="toggle-knob"></div></div><span class="toggle-label">No</span></div></div>
                    </div>
                    <div class="form-grid" style="margin-top: var(--space-md);">
                        <div class="form-group"><label class="form-label">Clause-level changes needed?</label><div class="toggle-group" style="justify-content: flex-start;"><div class="toggle" id="s3ClauseChanges" onclick="toggleGeneric(this)"><div class="toggle-knob"></div></div><span class="toggle-label">No</span></div></div>
                        <div class="form-group"><label class="form-label">Language variations?</label><div class="toggle-group" style="justify-content: flex-start;"><div class="toggle" id="s3LanguageVariations" onclick="toggleGeneric(this)"><div class="toggle-knob"></div></div><span class="toggle-label">No</span></div></div>
                        <div class="form-group"><label class="form-label">Calculations in templates?</label><div class="toggle-group" style="justify-content: flex-start;"><div class="toggle" id="s3Calculations" onclick="toggleGeneric(this)"><div class="toggle-knob"></div></div><span class="toggle-label">No</span></div></div>
                        <div class="form-group"><label class="form-label">Existing approval matrices?</label><div class="toggle-group" style="justify-content: flex-start;"><div class="toggle" id="s3ApprovalMatrices" onclick="toggleGeneric(this)"><div class="toggle-knob"></div></div><span class="toggle-label">No</span></div></div>
                    </div>
                    <div class="btn-group"><button class="btn btn-secondary" onclick="prevSection(3)"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button><button class="btn btn-primary" onclick="nextSection(3)">Continue to Migration<svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button></div>
                </div>
            </div>

            <!-- SECTION 4: Migration Readiness -->
            <div class="form-section" id="section4">
                <div class="section-header">
                    <div class="section-badge"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>Section 4 of 8</div>
                    <h2 class="section-title">Migration Readiness Scanner</h2>
                    <p class="section-description">Assess the complexity of migrating your historical contracts.</p>
                </div>
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Contracts for migration <span class="required">*</span></label><input type="number" class="form-input" id="s4ContractCount" placeholder="e.g., 2500" min="1"></div>
                        <div class="form-group"><label class="form-label">Contract types <span class="required">*</span></label><input type="text" class="form-input" id="s4ContractTypes" placeholder="e.g., NDA, MSA, SOW"><div class="form-hint">Add your contract types separated by ","</div></div>
                        <div class="form-group"><label class="form-label">Metadata fields <span class="required">*</span></label><div class="form-hint" style="margin-bottom: var(--space-sm);">Here is what we offer as standard <a href="https://docs.google.com/document/d/1QBB6IgfQxKCEkyjfYITrixCuxjtnFQtIxxnO8XUjR_g/edit?pli=1&tab=t.0" target="_blank" style="color: var(--primary); text-decoration: underline;">(view standard metadata fields)</a></div><div class="toggle-group" style="margin-top: var(--space-sm);"><label class="form-label" style="margin: 0;">Do you need customised metadata fields on top of standard provided by SpotDraft?</label><div class="toggle" id="s4MetadataFieldsCustomised" onclick="toggleGeneric(this); toggleSection('s4CustomMetadataSection')"><div class="toggle-knob"></div></div><span class="toggle-label">No</span></div><div class="conditional-section" id="s4CustomMetadataSection" style="margin-top: var(--space-md);"><div class="form-group"><label class="form-label">Custom metadata fields</label><div class="form-hint" style="margin-bottom: var(--space-sm);">You can have a maximum of 10 custom metadata fields.</div><textarea class="form-textarea" id="s4CustomMetadata" placeholder="Add the metadata field title along with the approach."></textarea></div></div></div>
                        <div class="form-group"><label class="form-label">Storage location <span class="required">*</span></label><div class="chip-group" id="s4StorageLocation"><div class="chip" data-value="Google Drive" onclick="toggleChip(this)">Google Drive</div><div class="chip" data-value="SharePoint" onclick="toggleChip(this)">SharePoint</div><div class="chip" data-value="Dropbox" onclick="toggleChip(this)">Dropbox</div><div class="chip" data-value="Box" onclick="toggleChip(this)">Box</div><div class="chip" data-value="Local" onclick="toggleChip(this)">Local</div></div></div>
                        <div class="form-group"><label class="form-label">Structured naming? <span class="required">*</span></label><div class="form-hint" style="margin-bottom: var(--space-sm);">Data for migration available in a structured and clean folders?</div><select class="form-select" id="s4NamingConvention"><option value="">Select</option><option value="Yes - 100%">Yes - 100% of data is clean and structured</option><option value="Partial">Partial</option><option value="None">None - it's random mess</option></select></div>
                        <div class="form-group"><label class="form-label">Contract formats <span class="required">*</span></label><div class="chip-group" id="s4ContractFormats"><div class="chip" data-value="PDF" onclick="toggleChip(this)">PDF</div><div class="chip" data-value="Word" onclick="toggleChip(this)">Word</div><div class="chip" data-value="Scanned" onclick="toggleChip(this)">Scanned</div></div></div>
                        <div class="form-group"><label class="form-label">Existing metadata? <span class="required">*</span></label><div class="form-hint" style="margin-bottom: var(--space-sm);">Do you have existing metadata for your contracts? This includes information like contract type, parties, dates, values, etc. that is already captured in your current system.</div><select class="form-select" id="s4ExistingMetadata"><option value="">Select</option><option value="Yes - fully">Yes - fully captured and structured</option><option value="Yes - partially">Yes - partially captured, some gaps exist</option><option value="No">No - no existing metadata available</option></select></div>
                        <div class="form-group"><label class="form-label">Migration priority <span class="required">*</span></label><select class="form-select" id="s4MigrationPriority"><option value="">Select</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option></select></div>
                    </div>
                    <div class="form-group" style="margin-top: var(--space-md);"><label class="form-label">Excel trackers</label><div class="form-hint" style="margin-bottom: var(--space-sm);">Here is our standard format - will you be able to share your metadata in the below format <a href="https://docs.google.com/spreadsheets/d/1ONP7GkyTVqPgQV2T1GZgfbEC1yDrNOVTZTNUFcrx75U/edit?gid=695040956#gid=695040956" target="_blank" style="color: var(--primary); text-decoration: underline;">(view format)</a></div><div class="toggle-group"><div class="toggle" id="s4ExcelTrackers" onclick="toggleGeneric(this); toggleSection('s4ExcelUploadSection')"><div class="toggle-knob"></div></div><span class="toggle-label">No</span></div></div>
                    <div class="conditional-section" id="s4ExcelUploadSection"><div class="form-group"><label class="form-label">Upload tracker(s)</label><input type="file" class="form-input" id="s4ExcelFiles" accept=".xlsx,.csv" multiple></div></div>
                    <div class="btn-group"><button class="btn btn-secondary" onclick="prevSection(4)"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button><button class="btn btn-primary" onclick="nextSection(4)">Continue to Integrations<svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button></div>
                </div>
            </div>

            <!-- SECTION 5: Integration Readiness -->
            <div class="form-section" id="section5" style="display: none;">
                <div class="section-header">
                    <div class="section-badge"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="8" height="8"/><rect x="14" y="2" width="8" height="8"/></svg>Section 5 of 8</div>
                    <h2 class="section-title">Integration Readiness Scanner</h2>
                    <p class="section-description">Identify IT preparedness and integration blockers.</p>
                </div>
                <div class="form-card">
                    <div class="form-group"><label class="form-label">Systems to integrate <span class="required">*</span></label>
                        <div class="integration-grid" id="s5IntegrationSystems">
                            <div class="integration-chip" data-value="Salesforce" onclick="toggleIntegrationChip(this)"><svg class="integration-logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/></svg>Salesforce</div>
                            <div class="integration-chip" data-value="HubSpot" onclick="toggleIntegrationChip(this)"><svg class="integration-logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/></svg>HubSpot</div>
                            <div class="integration-chip" data-value="Cloud Storage" onclick="toggleIntegrationChip(this)"><svg class="integration-logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>Cloud Storage</div>
                            <div class="integration-chip" data-value="DocuSign" onclick="toggleIntegrationChip(this)"><svg class="integration-logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5z"/></svg>DocuSign</div>
                            <div class="integration-chip" data-value="SSO" onclick="toggleIntegrationChip(this)"><svg class="integration-logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2"/></svg>SSO</div>
                            <div class="integration-chip" data-value="Jira" onclick="toggleIntegrationChip(this)"><svg class="integration-logo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>Jira</div>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Custom integration?</label><div class="toggle-group"><div class="toggle" id="s5CustomIntegration" onclick="toggleGeneric(this); toggleSection('s5CustomIntegrationSection')"><div class="toggle-knob"></div></div><span class="toggle-label">No</span></div></div>
                        <div class="form-group"><label class="form-label">API/Webhook access?</label><div class="toggle-group"><div class="toggle" id="s5ApiAccess" onclick="toggleGeneric(this)"><div class="toggle-knob"></div></div><span class="toggle-label">No</span></div></div>
                        <div class="form-group"><label class="form-label">Admin access? <span class="required">*</span></label><select class="form-select" id="s5AdminAccess"><option value="">Select</option><option value="Yes - all">Yes - all</option><option value="Yes - some">Yes - some</option><option value="No">No</option></select></div>
                        <div class="form-group"><label class="form-label">IT approval needed? <span class="required">*</span></label><select class="form-select" id="s5SecurityApproval"><option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option><option value="Not sure">Not sure</option></select></div>
                    </div>
                    <div class="conditional-section" id="s5CustomIntegrationSection"><div class="form-group"><label class="form-label">Describe custom integration requirements</label><textarea class="form-textarea" id="s5CustomIntegrationDetails" placeholder="Describe your custom integration requirements..."></textarea></div></div>
                    <div class="poc-card" style="margin-top: var(--space-lg);"><div class="poc-card-header"><div class="poc-icon" style="background: var(--info);"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div><div><div class="poc-title">Integration Decision Maker</div><div class="poc-subtitle">For integration decisions</div></div></div><div class="input-group"><div class="form-group"><label class="form-label">Name <span class="required">*</span></label><input type="text" class="form-input" id="s5DecisionMakerName" placeholder="Name"></div><div class="form-group"><label class="form-label">Role <span class="required">*</span></label><input type="text" class="form-input" id="s5DecisionMakerRole" placeholder="Role"></div><div class="form-group"><label class="form-label">Email <span class="required">*</span></label><input type="email" class="form-input" id="s5DecisionMakerEmail" placeholder="Email" onblur="validateEmailField('s5DecisionMakerEmail')"></div></div></div>
                    <div class="form-group" style="margin-top: var(--space-lg);"><label class="form-label">Expected outcomes <span class="required">*</span></label><div class="chip-group" id="s5IntegrationOutcomes"><div class="chip" data-value="Contract sync" onclick="toggleChip(this)">Contract sync</div><div class="chip" data-value="Deal sync" onclick="toggleChip(this)">Deal sync</div><div class="chip" data-value="Auto-fill" onclick="toggleChip(this)">Auto-fill</div><div class="chip" data-value="Automation" onclick="toggleChip(this)">Automation</div></div></div>
                    <div class="btn-group"><button class="btn btn-secondary" onclick="prevSection(5)"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button><button class="btn btn-primary" onclick="nextSection(5)">Continue to Business Process<svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button></div>
                </div>
            </div>

            <!-- SECTION 6: Business Process -->
            <div class="form-section" id="section6">
                <div class="section-header">
                    <div class="section-badge"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Section 6 of 8</div>
                    <h2 class="section-title">Business Process Readiness</h2>
                    <p class="section-description">Understand your current processes and expectations.</p>
                </div>
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Approval workflow? <span class="required">*</span></label><div class="form-hint" style="margin-bottom: var(--space-sm);">Do you have an existing approval workflow for contracts? This refers to the process of getting contracts reviewed and approved by different stakeholders (e.g., Legal, Finance, Management) before execution.</div><select class="form-select" id="s6ApprovalWorkflow" onchange="toggleSection('s6WorkflowDetailsSection')"><option value="">Select</option><option value="Yes - documented">Yes - documented (formal process with clear steps and stakeholders)</option><option value="Yes - informal">Yes - informal (process exists but not formally documented)</option><option value="No">No (no approval workflow currently in place)</option></select></div>
                        <div class="form-group full-width"><label class="form-label">Who generates contracts? <span class="required">*</span></label><div class="chip-group" id="s6ContractGenerators"><div class="chip" data-value="Sales" onclick="toggleChip(this)">Sales</div><div class="chip" data-value="Legal" onclick="toggleChip(this)">Legal</div><div class="chip" data-value="Operations" onclick="toggleChip(this)">Operations</div><div class="chip" data-value="Mixed" onclick="toggleChip(this)">Mixed</div></div></div>
                    </div>
                    <div class="conditional-section" id="s6WorkflowDetailsSection"><div class="form-group"><label class="form-label">Describe workflow</label><textarea class="form-textarea" id="s6WorkflowDetails" placeholder="e.g., Legal > Manager > Finance"></textarea></div></div>
                    <div class="form-group"><label class="form-label">Current bottlenecks <span class="required">*</span></label><textarea class="form-textarea" id="s6Bottlenecks" placeholder="Describe pain points..."></textarea></div>
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Phase 1 must-haves <span class="required">*</span></label><textarea class="form-textarea" id="s6Phase1MustHaves" placeholder="Essential for go-live..."></textarea></div>
                        <div class="form-group"><label class="form-label">Phase 2 nice-to-haves</label><textarea class="form-textarea" id="s6Phase2NiceToHaves" placeholder="Future phases..."></textarea></div>
                    </div>
                    <div class="btn-group"><button class="btn btn-secondary" onclick="prevSection(6)"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button><button class="btn btn-primary" onclick="nextSection(6)">Continue to Security<svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button></div>
                </div>
            </div>

            <!-- SECTION 7: Security & Compliance -->
            <div class="form-section" id="section7">
                <div class="section-header">
                    <div class="section-badge"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Section 7 of 8</div>
                    <h2 class="section-title">Security, Compliance & IT</h2>
                    <p class="section-description">Identify security requirements and blockers.</p>
                </div>
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Security review needed? <span class="required">*</span></label><select class="form-select" id="s7SecurityReview" onchange="handleSecurityReviewChange()"><option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option><option value="Completed">Already completed</option></select></div>
                        <div class="form-group"><label class="form-label">Infosec approvals pending? <span class="required">*</span></label><select class="form-select" id="s7InfosecApprovals" onchange="toggleSection('s7InfosecSection')"><option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option><option value="Not sure">Not sure</option></select></div>
                        <div class="form-group"><label class="form-label">Data residency requirements? <span class="required">*</span></label><select class="form-select" id="s7DataResidency" onchange="toggleSection('s7DataResidencySection')"><option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option><option value="Not sure">Not sure</option></select></div>
                        <div class="form-group"><label class="form-label">Custom SSO? <span class="required">*</span></label><select class="form-select" id="s7CustomSSO" onchange="toggleSection('s7SSOSection')"><option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option></select></div>
                    </div>
                    <div class="conditional-section" id="s7SecurityReviewSection"><div class="form-group"><label class="form-label">Reviews needed</label><div class="chip-group" id="s7SecurityReviews"><div class="chip" data-value="DPA" onclick="toggleChip(this)">DPA</div><div class="chip" data-value="SOC-2" onclick="toggleChip(this)">SOC-2</div><div class="chip" data-value="Security" onclick="toggleChip(this)">Security Review</div><div class="chip" data-value="Other" onclick="toggleChip(this)">Other</div></div></div></div>
                    <div class="conditional-section" id="s7InfosecSection"><div class="form-group"><label class="form-label">Pending approvals</label><textarea class="form-textarea" id="s7InfosecDetails" placeholder="Details..."></textarea></div></div>
                    <div class="conditional-section" id="s7DataResidencySection"><div class="form-group"><label class="form-label">Data residency</label><input type="text" class="form-input" id="s7DataResidencyDetails" placeholder="e.g., EU-only, US"></div></div>
                    <div class="conditional-section" id="s7SSOSection"><div class="form-group"><label class="form-label">SSO provider</label><input type="text" class="form-input" id="s7SSODetails" placeholder="e.g., Okta, Azure AD"></div></div>
                    <div class="btn-group"><button class="btn btn-secondary" onclick="prevSection(7)"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button><button class="btn btn-primary" onclick="nextSection(7)">Continue to Uploads<svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></button></div>
                </div>
            </div>

            <!-- SECTION 8: Upload Center -->
            <div class="form-section" id="section8">
                <div class="section-header">
                    <div class="section-badge"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>Section 8 of 8</div>
                    <h2 class="section-title">Upload Center</h2>
                    <p class="section-description">Upload documents upfront to unblock delivery.</p>
                </div>
                <div class="form-card">
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Templates</label><input type="file" class="form-input" id="s8Templates" accept=".docx,.pdf" multiple><div class="form-hint">Contract templates</div></div>
                        <div class="form-group"><label class="form-label">Approval matrices</label><input type="file" class="form-input" id="s8ApprovalMatrices" accept=".xlsx,.pdf" multiple></div>
                        <div class="form-group"><label class="form-label">Sample contracts</label><input type="file" class="form-input" id="s8SampleContracts" accept=".pdf,.docx" multiple></div>
                        <div class="form-group"><label class="form-label">Integration docs</label><input type="file" class="form-input" id="s8IntegrationDocs" accept=".pdf,.docx" multiple></div>
                        <div class="form-group"><label class="form-label">Brand guidelines</label><input type="file" class="form-input" id="s8BrandGuidelines" accept=".pdf,.zip" multiple></div>
                    </div>
                    <div class="btn-group"><button class="btn btn-secondary" onclick="prevSection(8)"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>Back</button><button class="btn btn-primary" onclick="submitAssessment()">Submit Assessment<svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg></button></div>
                </div>
            </div>

            <!-- LOADING SCREEN -->
            <div class="loading-screen" id="loadingScreen">
                <div class="loading-spinner"></div>
                <div class="loading-title">Analyzing Your Responses</div>
                <div class="loading-subtitle">Generating readiness assessment and implementation plan with AI. This may take 1-2 minutes.</div>
                <div class="loading-progress-container">
                    <div class="loading-progress-bar">
                        <div class="loading-progress-fill" id="loadingProgressFill" style="width: 0%;"></div>
                    </div>
                    <div class="loading-progress-text" id="loadingProgressText">Initializing AI...</div>
                </div>
            </div>

            <!-- RESULTS SCREEN -->
            <div class="results-screen" id="resultsScreen">
                <div class="score-card">
                    <div class="score-label">Readiness Score</div>
                    <div class="score-value" id="overallScore">--</div>
                    <div class="score-status" id="scoreStatus">Calculating...</div>
                    <div class="score-description" id="scoreDescription"></div>
                    <div class="score-breakdown" id="scoreBreakdown"></div>
                </div>
                <div class="results-section" id="redFlagsSection"><h3 class="results-section-title"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--error)" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>Red Flags & Risks</h3><div id="redFlagsList"></div></div>
                <div class="results-section" id="actionItemsSection"><h3 class="results-section-title"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>Action Items</h3><div class="action-tabs"><button class="action-tab active" onclick="switchActionTab('customer')">Your Team</button><button class="action-tab" onclick="switchActionTab('spotdraft')">SpotDraft Team</button></div><div class="action-tab-content active" id="customerActions"></div><div class="action-tab-content" id="spotdraftActions"></div></div>
                <div class="results-section" id="implementationPlanSection"><h3 class="results-section-title"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Implementation Plan</h3><div id="timelineSummary" style="margin-bottom: var(--space-lg); padding: var(--space-md); background: var(--info-light); border-radius: var(--radius-md);"></div><div id="implementationPhases"></div></div>
                <div class="results-section" id="preparationListSection" style="display: none;"><h3 class="results-section-title"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>What to Prepare Before Purchasing SpotDraft</h3><div id="preparationList"></div></div>
                <div class="btn-group" style="border-top: none;"><button class="btn btn-secondary" onclick="location.reload()"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/></svg>New Assessment</button><button class="btn btn-primary" onclick="window.print()"><svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>Print Report</button></div>
            </div>
        </main>
    </div>
    
    <script>
        // ============================================
        // API CONFIGURATION
        // ============================================
        // API Configuration - automatically detects environment
        const API_CONFIG = {
            // Detect environment and set appropriate base URL
            BASE_URL: (() => {
                const hostname = window.location.hostname;
                // Local development
                if (hostname === 'localhost' || hostname === '127.0.0.1') {
                    return 'http://localhost:3000';
                }
                // Production (Render, Vercel, etc.) - use same origin
                return ''; // Use relative path (same origin)
            })(),
            ENDPOINTS: {
                ASSESS: '/assess'
            }
        };
        
        // ============================================
        // API PAYLOAD EXAMPLES
        // ============================================
        /*
        Response Payload:
        {
            "success": true,
            "extracted_data": {
                "organisation_name": "Acme Corporation",
                "purchased_modules": ["Template Setup", "Migration", "Integrations"],
                "template_count": 5,
                "migration_contract_count": 2500,
                "integration_systems": ["Salesforce", "HubSpot"]
            },
            "confidence": 0.95,
            "flags": [
                {
                    "type": "warning",
                    "message": "Template count not explicitly stated, estimated from context"
                }
            ]
        }
        
        API 2: Submit Assessment
        Endpoint: POST /assess
        
        Request Payload:
        {
            "intake_responses": {
                "section_1_account_stakeholder": {
                    "organisation_name": "Acme Corporation",
                    "primary_poc": {
                        "name": "John Doe",
                        "role": "Legal Ops Manager",
                        "email": "john.doe@acme.com",
                        "timezone": "US"
                    },
                    "legal_poc": {
                        "name": "Jane Smith",
                        "role": "Legal Counsel",
                        "email": "jane.smith@acme.com",
                        "timezone": "US"
                    },
                    "integrations_required": true,
                    "technical_poc": {
                        "name": "Bob Johnson",
                        "email": "bob.johnson@acme.com",
                        "timezone": "US"
                    },
                    "availability": "Tuesdays and Thursdays, 2-4 PM EST",
                    "communication_channels": ["Slack", "Email"],
                    "expected_go_live": "2024-06-01"
                },
                "section_2_order_form_scope": {
                    "purchased_modules": ["Template Setup", "Migration"],
                    "template_count": 5,
                    "migration_contract_count": 2500,
                    "migration_file_formats": ["PDF", "DOCX"],
                    "integrations": [],
                    "additional_addons": ""
                },
                "section_3_template_readiness": {
                    "template_count": 5,
                    "templates_finalized": "Yes",
                    "template_formats": ["Word"],
                    "clause_level_changes": false,
                    "conditional_logic": "Moderate",
                    "dynamic_rendering_needed": true,
                    "dynamic_rendering_complexity": "Simple",
                    "language_variations": false,
                    "calculations_involved": false,
                    "approval_matrices_exist": true
                },
                "section_4_migration_readiness": {
                    "contract_count": 2500,
                    "contract_types": "NDA, MSA, SOW",
                    "metadata_fields_standard": true,
                    "metadata_fields_customised": false,
                    "custom_metadata": "",
                    "storage_locations": ["Google Drive"],
                    "structured_naming": "Yes - 100%",
                    "contract_formats": ["PDF"],
                    "existing_metadata": "Yes - fully",
                    "excel_trackers": true,
                    "migration_priority": "High"
                },
                "section_5_integration_readiness": {
                    "systems_to_integrate": ["Salesforce"],
                    "custom_integration": false,
                    "custom_integration_details": "",
                    "api_webhook_access": true,
                    "admin_access": "Yes - all",
                    "security_approval": "Yes",
                    "decision_maker": {
                        "name": "Alice Brown",
                        "role": "IT Director",
                        "email": "alice.brown@acme.com"
                    },
                    "expected_outcomes": ["Contract sync", "Auto-fill"]
                },
                "section_6_business_process": {
                    "approval_workflow": "Yes - documented",
                    "workflow_details": "Legal > Manager > Finance",
                    "contracts_per_month": 150,
                    "contract_generators": ["Sales", "Legal"],
                    "bottlenecks": "Manual review process takes too long",
                    "phase1_must_haves": "Template automation, basic approval workflow",
                    "phase2_nice_to_haves": "Advanced analytics, custom reporting"
                },
                "section_7_security_compliance": {
                    "security_review": "Yes",
                    "security_reviews_needed": ["DPA", "SOC-2"],
                    "infosec_approvals": "Yes",
                    "infosec_details": "Pending SOC-2 review",
                    "data_residency": "No",
                    "data_residency_details": "",
                    "custom_sso": "Yes",
                    "sso_details": "Okta"
                },
                "section_8_uploads": {
                    "templates": ["template1.docx", "template2.docx"],
                    "clause_libraries": ["clauses.xlsx"],
                    "approval_matrices": ["approval-matrix.xlsx"],
                    "metadata_sheets": ["metadata.csv"],
                    "sample_contracts": ["sample1.pdf"],
                    "integration_docs": ["integration-spec.pdf"],
                    "brand_guidelines": ["brand-guidelines.pdf"]
                }
            }
        }
        
        Response Payload:
        {
            "success": true,
            "data": {
                "readiness_score": {
                    "overall": 78,
                    "breakdown": {
                        "account_stakeholder": 90,
                        "order_form_scope": 85,
                        "template_readiness": 75,
                        "migration_readiness": 70,
                        "integration_readiness": 80,
                        "business_process": 75,
                        "security_compliance": 65
                    }
                },
                "status_label": "Ready with Minor Blockers",
                "status_description": "Your organization is well-prepared for implementation. A few items need attention before go-live.",
                "red_flags": [
                    {
                        "section": "Security & Compliance",
                        "issue": "Security review pending",
                        "impact": "May delay go-live by 2-3 weeks",
                        "severity": "medium"
                    }
                ],
                "action_items": {
                    "customer": [
                        {
                            "task": "Complete SOC-2 security review",
                            "section": "Security & Compliance",
                            "priority": "high",
                            "deadline": "2024-05-15",
                            "owner": "IT Team"
                        }
                    ],
                    "spotdraft": [
                        {
                            "task": "Schedule template review session",
                            "section": "Template Readiness",
                            "priority": "medium",
                            "deadline": "2024-04-20",
                            "owner": "Implementation Team"
                        }
                    ]
                },
                "implementation_plan": {
                    "estimated_timeline": "12-16 weeks",
                    "phases": [
                        {
                            "phase": "Phase 1: Setup & Configuration",
                            "duration": "4-6 weeks",
                            "tasks": ["Account setup", "Template configuration", "User training"]
                        }
                    ]
                }
            }
        }
        */
        
        // ============================================
        // STATE MANAGEMENT
        // ============================================
        const formData = {
            userType: '', // 'prospect', 'customer', or 'implementation_manager'
            prospect: {
                section1: {},
                section2: {},
                section3: {},
                section4: {}
            },
            customer: {
                section1: {},
                section2: {},
                section3: {},
                section4: {},
                section5: {},
                section6: {},
                section7: {}
            },
            im: {
                section1: {},
                section2: {},
                section3: {},
                section4: {},
                section5: {},
                section6: {}
            },
            section1: {
                orgName: '',
                primaryPoc: { name: '', role: '', email: '', timezone: '' },
                legalPoc: { name: '', role: '', email: '', timezone: '' },
                integrationsRequired: false,
                technicalPoc: { name: '', email: '', timezone: '' },
                availability: '',
                communicationChannels: [],
                expectedGoLive: ''
            },
            section2: {
                purchasedModules: [],
                integrations: [],
                additionalAddons: ''
            }
        };
        
        let currentSection = 0;
        const totalSections = 8;
        
        // ============================================
        // LOCALSTORAGE AUTO-SAVE
        // ============================================
        const STORAGE_KEY = 'spotsmart_form_data';
        const STORAGE_TIMESTAMP_KEY = 'spotsmart_form_timestamp';
        
        function saveToLocalStorage() {
            try {
                const dataToSave = {
                    userType: formData.userType,
                    prospect: formData.prospect,
                    customer: formData.customer,
                    im: formData.im,
                    section1: formData.section1,
                    section2: formData.section2,
                    currentSection: currentSection
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                localStorage.setItem(STORAGE_TIMESTAMP_KEY, new Date().toISOString());
                showSaveIndicator();
            } catch (error) {
                console.warn('Failed to save to LocalStorage:', error);
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.userType) formData.userType = data.userType;
                    if (data.prospect) formData.prospect = data.prospect;
                    if (data.customer) formData.customer = data.customer;
                    if (data.im) formData.im = data.im;
                    if (data.section1) formData.section1 = data.section1;
                    if (data.section2) formData.section2 = data.section2;
                    if (data.currentSection !== undefined) currentSection = data.currentSection;
                    return true;
                }
            } catch (error) {
                console.warn('Failed to load from LocalStorage:', error);
            }
            return false;
        }
        
        function clearLocalStorage() {
            try {
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(STORAGE_TIMESTAMP_KEY);
            } catch (error) {
                console.warn('Failed to clear LocalStorage:', error);
            }
        }
        
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            if (indicator) {
                indicator.style.display = 'inline-flex';
                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                    setTimeout(() => {
                        if (!indicator.classList.contains('show')) {
                            indicator.style.display = 'none';
                        }
                    }, 300);
                }, 2000);
            }
        }
        
        function exportFormData() {
            try {
                const dataToExport = {
                    userType: formData.userType,
                    prospect: formData.prospect,
                    customer: formData.customer,
                    im: formData.im,
                    section1: formData.section1,
                    section2: formData.section2,
                    exportedAt: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `spotsmart-form-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                alert('Failed to export form data: ' + error.message);
            }
        }
        
        function importFormData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.userType) formData.userType = imported.userType;
                    if (imported.prospect) formData.prospect = imported.prospect;
                    if (imported.customer) formData.customer = imported.customer;
                    if (imported.im) formData.im = imported.im;
                    if (imported.section1) formData.section1 = imported.section1;
                    if (imported.section2) formData.section2 = imported.section2;
                    
                    // Save to LocalStorage
                    saveToLocalStorage();
                    
                    // Restore form fields
                    restoreFormFields();
                    
                    alert('Form data imported successfully!');
                } catch (error) {
                    alert('Failed to import form data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        function restoreFormFields() {
            // Restore user type selection
            if (formData.userType) {
                const userTypeCard = document.querySelector(`[data-user-type="${formData.userType}"]`);
                if (userTypeCard) {
                    userTypeCard.click();
                }
            }
            
            // Restore prospect fields
            if (formData.prospect) {
                if (formData.prospect.section1) {
                    const s1 = formData.prospect.section1;
                    if (s1.companyName) document.getElementById('prospectCompanyName')?.setAttribute('value', s1.companyName);
                    if (s1.industry) document.getElementById('prospectIndustry')?.setAttribute('value', s1.industry);
                    if (s1.userCount) document.getElementById('prospectUserCount')?.setAttribute('value', s1.userCount);
                }
                // Add more restoration logic for other sections as needed
            }
            
            // Restore customer fields
            if (formData.customer) {
                // Add restoration logic for customer sections
            }
            
            // Restore IM fields
            if (formData.im) {
                // Add restoration logic for IM sections
            }
        }
        
        // Auto-save wrapper for save functions
        function autoSave() {
            saveToLocalStorage();
        }
        
        // Load saved data on page load
        window.addEventListener('DOMContentLoaded', function() {
            const hasSavedData = loadFromLocalStorage();
            if (hasSavedData) {
                // Show restore prompt
                const restorePrompt = document.getElementById('restorePrompt');
                if (restorePrompt) {
                    restorePrompt.style.display = 'block';
                }
            }
        });
        
        // ============================================
        // NAVIGATION
        // ============================================
        function startAssessment() {
            // Hide ALL sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            const welcomeScreen = document.getElementById('welcomeScreen');
            const section0 = document.getElementById('section0');
            const progressContainer = document.getElementById('progressContainer');
            const resultsScreen = document.getElementById('resultsScreen');
            
            if (welcomeScreen) welcomeScreen.style.display = 'none';
            if (resultsScreen) resultsScreen.classList.remove('active');
            if (section0) {
                section0.style.display = 'block';
                section0.classList.add('active');
            }
            if (progressContainer) progressContainer.style.display = 'block';
            currentSection = 0;
            updateProgress();
        }
        
        function selectUserType(userType) {
            // Remove selected class and aria-pressed from all cards
            document.querySelectorAll('.user-type-card').forEach(card => {
                card.classList.remove('selected');
                card.setAttribute('aria-pressed', 'false');
            });
            
            // Add selected class to clicked card
            const selectedCard = document.querySelector(`[data-user-type="${userType}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
                selectedCard.setAttribute('aria-pressed', 'true');
            }
            
            // Store user type
            formData.userType = userType;
            
            // Enable continue button
            const continueBtn = document.getElementById('continueFromUserType');
            if (continueBtn) {
                continueBtn.disabled = false;
            }
        }
        
        function handleCardKeydown(event, userType) {
            // Handle Enter and Space key presses for keyboard accessibility
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                selectUserType(userType);
            }
        }
        
        function skipToDefault() {
            // Set default to Customer and proceed
            selectUserType('customer');
            proceedFromUserType();
        }
        
        function proceedFromUserType() {
            if (!formData.userType) {
                alert('Please select a user type to continue.');
                return;
            }
            
            // Save section 0 data
            saveSection(0);
            
            // Route to appropriate first section based on user type
            if (formData.userType === 'prospect') {
                // Hide all sections first
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.remove('active');
                    section.style.display = 'none';
                });
                
                // Show Prospect Section 1
                const prospectSection1 = document.getElementById('prospectSection1');
                if (prospectSection1) {
                    prospectSection1.style.display = 'block';
                    prospectSection1.classList.add('active');
                }
            currentSection = 1;
            updateProgress();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (formData.userType === 'customer') {
                // Hide all sections first
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.remove('active');
                    section.style.display = 'none';
                });
                
                // Show Customer Section 1
                const customerSection1 = document.getElementById('customerSection1');
                if (customerSection1) {
                    customerSection1.style.display = 'block';
                    customerSection1.classList.add('active');
                }
                currentSection = 1;
                updateProgress();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (formData.userType === 'implementation_manager') {
                // Hide all sections first
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.remove('active');
                    section.style.display = 'none';
                });
                
                // Show IM Section 1
                const imSection1 = document.getElementById('imSection1');
                if (imSection1) {
                    imSection1.style.display = 'block';
                    imSection1.classList.add('active');
                }
                currentSection = 1;
                updateProgress();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        function goToWelcome() {
            document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
            const welcomeScreen = document.getElementById('welcomeScreen');
            const progressContainer = document.getElementById('progressContainer');
            if (welcomeScreen) welcomeScreen.style.display = 'block';
            if (progressContainer) progressContainer.style.display = 'none';
            currentSection = 0;
        }
        
        function nextSection(current, persona) {
            // Handle Prospect flow
            if (persona === 'prospect' || formData.userType === 'prospect') {
                return nextProspectSection(current);
            }
            
            // Handle Customer flow
            if (persona === 'customer' || formData.userType === 'customer') {
                return nextCustomerSection(current);
            }
            
            // Handle Implementation Manager flow
            if (persona === 'implementation_manager' || formData.userType === 'implementation_manager') {
                return nextIMSection(current);
            }
            
            // Skip validation for section 0 (user type selection)
            if (current > 0 && !validateSection(current)) return;
            
            // Don't save section 0 here as it's handled by proceedFromUserType
            if (current > 0) {
            saveSection(current);
            }
            
            // Remove active class from ALL sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            let nextSectionNum = current + 1;
            
            // Handle Section 5 visibility based on integrations requirement
            if (nextSectionNum === 5) {
                const integrationsRequired = formData.section1?.integrationsRequired || false;
                if (!integrationsRequired) {
                    // Skip Section 5 if integrations are not required
                    nextSectionNum = 6; // Skip to Section 6
                } else {
                    // Show Section 5 if integrations are required
                    const section5 = document.getElementById('section5');
                    if (section5) {
                        section5.style.display = 'block';
                    }
                }
            }
            
            // Add active class only to the next section and ensure it's visible
            const nextSectionEl = document.getElementById(`section${nextSectionNum}`);
            if (nextSectionEl) {
                // Ensure all other sections are explicitly hidden
                document.querySelectorAll('.form-section').forEach(section => {
                    if (section.id !== `section${nextSectionNum}`) {
                        section.style.display = 'none';
                    }
                });
                // Show and activate the next section
                nextSectionEl.style.display = 'block';
                nextSectionEl.classList.add('active');
            }
            currentSection = nextSectionNum;
            updateProgress();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function nextProspectSection(current) {
            // Validate current section
            if (current > 0 && !validateProspectSection(current)) return;
            
            // Save current section
            if (current > 0) {
                saveProspectSection(current);
            }
            
            // Remove active class from ALL sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            let nextSectionNum = current + 1;
            
            // Show next Prospect section
            const nextSectionEl = document.getElementById(`prospectSection${nextSectionNum}`);
            if (nextSectionEl) {
                // Ensure all other sections are explicitly hidden
                document.querySelectorAll('.form-section').forEach(section => {
                    if (section.id !== `prospectSection${nextSectionNum}`) {
                        section.style.display = 'none';
                    }
                });
                // Show and activate the next section
                nextSectionEl.style.display = 'block';
                nextSectionEl.classList.add('active');
            }
            currentSection = nextSectionNum;
            updateProgress();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function prevSection(current, persona) {
            // Handle Prospect flow
            if (persona === 'prospect' || formData.userType === 'prospect') {
                return prevProspectSection(current);
            }
            
            // Handle Customer flow
            if (persona === 'customer' || formData.userType === 'customer') {
                return prevCustomerSection(current);
            }
            
            // Handle Implementation Manager flow
            if (persona === 'implementation_manager' || formData.userType === 'implementation_manager') {
                return prevIMSection(current);
            }
            
            // Remove active class from ALL sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            let prevSectionNum = current - 1;
            
            // If going back from section 1, go to section 0
            if (prevSectionNum === 0) {
                const section0 = document.getElementById('section0');
                if (section0) {
                    // Ensure all other sections are explicitly hidden
                    document.querySelectorAll('.form-section').forEach(section => {
                        if (section.id !== 'section0') {
                            section.style.display = 'none';
                        }
                    });
                    section0.style.display = 'block';
                    section0.classList.add('active');
                    currentSection = 0;
                    updateProgress();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
            }
            
            // Handle Section 5 visibility based on integrations requirement
            if (prevSectionNum === 5) {
                const integrationsRequired = formData.section1?.integrationsRequired || false;
                if (!integrationsRequired) {
                    // Skip Section 5 if integrations are not required
                    prevSectionNum = 4; // Skip to Section 4
                } else {
                    // Show Section 5 if integrations are required
                    const section5 = document.getElementById('section5');
                    if (section5) {
                        section5.style.display = 'block';
                    }
                }
            }
            
            // Add active class only to the previous section and ensure it's visible
            const prevSectionEl = document.getElementById(`section${prevSectionNum}`);
            if (prevSectionEl) {
                // Ensure all other sections are explicitly hidden
                document.querySelectorAll('.form-section').forEach(section => {
                    if (section.id !== `section${prevSectionNum}`) {
                        section.style.display = 'none';
                    }
                });
                // Show and activate the previous section
                prevSectionEl.style.display = 'block';
                prevSectionEl.classList.add('active');
            }
            currentSection = prevSectionNum;
            updateProgress();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function prevProspectSection(current) {
            // Remove active class from ALL sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            let prevSectionNum = current - 1;
            
            // If going back from Prospect Section 1, go to section 0
            if (prevSectionNum === 0) {
                const section0 = document.getElementById('section0');
                if (section0) {
                    // Ensure all other sections are explicitly hidden
                    document.querySelectorAll('.form-section').forEach(section => {
                        if (section.id !== 'section0') {
                            section.style.display = 'none';
                        }
                    });
                    section0.style.display = 'block';
                    section0.classList.add('active');
                    currentSection = 0;
                    updateProgress();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
            }
            
            // Show previous Prospect section
            const prevSectionEl = document.getElementById(`prospectSection${prevSectionNum}`);
            if (prevSectionEl) {
                // Ensure all other sections are explicitly hidden
                document.querySelectorAll('.form-section').forEach(section => {
                    if (section.id !== `prospectSection${prevSectionNum}`) {
                        section.style.display = 'none';
                    }
                });
                // Show and activate the previous section
                prevSectionEl.style.display = 'block';
                prevSectionEl.classList.add('active');
            }
            currentSection = prevSectionNum;
            updateProgress();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function nextCustomerSection(current) {
            // Validate current section
            if (current > 0 && !validateCustomerSection(current)) return;
            
            // Save current section
            if (current > 0) {
                saveCustomerSection(current);
            }
            
            // Remove active class from ALL sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            let nextSectionNum = current + 1;
            
            // Show next Customer section
            const nextSectionEl = document.getElementById(`customerSection${nextSectionNum}`);
            if (nextSectionEl) {
                // Ensure all other sections are explicitly hidden
                document.querySelectorAll('.form-section').forEach(section => {
                    if (section.id !== `customerSection${nextSectionNum}`) {
                        section.style.display = 'none';
                    }
                });
                // Show and activate the next section
                nextSectionEl.style.display = 'block';
                nextSectionEl.classList.add('active');
            }
            currentSection = nextSectionNum;
            updateProgress();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function prevCustomerSection(current) {
            // Remove active class from ALL sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            let prevSectionNum = current - 1;
            
            // If going back from Customer Section 1, go to section 0
            if (prevSectionNum === 0) {
                const section0 = document.getElementById('section0');
                if (section0) {
                    // Ensure all other sections are explicitly hidden
                    document.querySelectorAll('.form-section').forEach(section => {
                        if (section.id !== 'section0') {
                            section.style.display = 'none';
                        }
                    });
                    section0.style.display = 'block';
                    section0.classList.add('active');
                    currentSection = 0;
                    updateProgress();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
            }
            
            // Show previous Customer section
            const prevSectionEl = document.getElementById(`customerSection${prevSectionNum}`);
            if (prevSectionEl) {
                // Ensure all other sections are explicitly hidden
                document.querySelectorAll('.form-section').forEach(section => {
                    if (section.id !== `customerSection${prevSectionNum}`) {
                        section.style.display = 'none';
                    }
                });
                // Show and activate the previous section
                prevSectionEl.style.display = 'block';
                prevSectionEl.classList.add('active');
            }
            currentSection = prevSectionNum;
            updateProgress();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function nextIMSection(current) {
            // Validate current section
            if (current > 0 && !validateIMSection(current)) return;
            
            // Save current section
            if (current > 0) {
                saveIMSection(current);
            }
            
            // Remove active class from ALL sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            let nextSectionNum = current + 1;
            
            // Skip section 5 (removed)
            if (nextSectionNum === 5) {
                nextSectionNum = 6;
            }
            
            // Show next IM section
            const nextSectionEl = document.getElementById(`imSection${nextSectionNum}`);
            if (nextSectionEl) {
                // Ensure all other sections are explicitly hidden
                document.querySelectorAll('.form-section').forEach(section => {
                    if (section.id !== `imSection${nextSectionNum}`) {
                        section.style.display = 'none';
                    }
                });
                // Show and activate the next section
                nextSectionEl.style.display = 'block';
                nextSectionEl.classList.add('active');
            }
            currentSection = nextSectionNum;
            updateProgress();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function prevIMSection(current) {
            // Remove active class from ALL sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            let prevSectionNum = current - 1;
            
            // Skip section 5 (removed)
            if (prevSectionNum === 5) {
                prevSectionNum = 4;
            }
            
            // If going back from IM Section 1, go to section 0
            if (prevSectionNum === 0) {
                const section0 = document.getElementById('section0');
                if (section0) {
                    // Ensure all other sections are explicitly hidden
                    document.querySelectorAll('.form-section').forEach(section => {
                        if (section.id !== 'section0') {
                            section.style.display = 'none';
                        }
                    });
                    section0.style.display = 'block';
                    section0.classList.add('active');
                    currentSection = 0;
                    updateProgress();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
            }
            
            // Show previous IM section
            const prevSectionEl = document.getElementById(`imSection${prevSectionNum}`);
            if (prevSectionEl) {
                // Ensure all other sections are explicitly hidden
                document.querySelectorAll('.form-section').forEach(section => {
                    if (section.id !== `imSection${prevSectionNum}`) {
                        section.style.display = 'none';
                    }
                });
                // Show and activate the previous section
                prevSectionEl.style.display = 'block';
                prevSectionEl.classList.add('active');
            }
            currentSection = prevSectionNum;
            updateProgress();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function updateProgress() {
            // Section 0 is not counted in total sections for progress
            if (currentSection === 0) {
                // Section 0 shows as "Getting Started" with minimal progress
                const percent = 5; // Small progress for user type selection
                document.getElementById('progressFill').style.width = `${percent}%`;
                document.getElementById('progressText').textContent = `Getting Started`;
                document.getElementById('progressPercent').textContent = `${percent}%`;
                return;
            }
            
            // Handle Prospect flow (4 sections)
            if (formData.userType === 'prospect') {
                const prospectTotalSections = 4;
                const percent = Math.round((currentSection / prospectTotalSections) * 100);
                document.getElementById('progressFill').style.width = `${percent}%`;
                document.getElementById('progressText').textContent = `Section ${currentSection} of ${prospectTotalSections}`;
                document.getElementById('progressPercent').textContent = `${percent}%`;
                return;
            }
            
            // Handle Customer flow (7 sections)
            if (formData.userType === 'customer') {
                const customerTotalSections = 7;
                const percent = Math.round((currentSection / customerTotalSections) * 100);
                document.getElementById('progressFill').style.width = `${percent}%`;
                document.getElementById('progressText').textContent = `Section ${currentSection} of ${customerTotalSections}`;
                document.getElementById('progressPercent').textContent = `${percent}%`;
                return;
            }
            
            // Handle Implementation Manager flow (6 sections)
            if (formData.userType === 'implementation_manager') {
                const imTotalSections = 6;
                const percent = Math.round((currentSection / imTotalSections) * 100);
                document.getElementById('progressFill').style.width = `${percent}%`;
                document.getElementById('progressText').textContent = `Section ${currentSection} of ${imTotalSections}`;
                document.getElementById('progressPercent').textContent = `${percent}%`;
                return;
            }
            
            // For Customer/Implementation Manager sections 1-8, calculate progress normally
            const percent = Math.round((currentSection / totalSections) * 100);
            document.getElementById('progressFill').style.width = `${percent}%`;
            document.getElementById('progressText').textContent = `Section ${currentSection} of ${totalSections}`;
            document.getElementById('progressPercent').textContent = `${percent}%`;
        }
        
        // ============================================
        // VALIDATION
        // ============================================
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function validateEmailField(fieldId) {
            const field = document.getElementById(fieldId);
            if (!field) return true;
            
            const email = field.value.trim();
            if (!email) {
                field.classList.add('error');
                return false;
            }
            
            if (!validateEmail(email)) {
                field.classList.add('error');
                // Show error message
                let errorMsg = field.parentElement.querySelector('.email-error');
                if (!errorMsg) {
                    errorMsg = document.createElement('div');
                    errorMsg.className = 'error-message email-error';
                    errorMsg.textContent = 'Please enter a valid email address';
                    field.parentElement.appendChild(errorMsg);
                }
                errorMsg.classList.add('visible');
                return false;
            } else {
                field.classList.remove('error');
                const errorMsg = field.parentElement.querySelector('.email-error');
                if (errorMsg) {
                    errorMsg.classList.remove('visible');
                }
                return true;
            }
        }
        
        function validateSection(section) {
            let isValid = true;
            
            // Section 0 (user type selection) doesn't need validation
            // as it's handled by proceedFromUserType function
            if (section === 0) {
                return true;
            }
            
            if (section === 1) {
                // Organisation Name
                const orgName = document.getElementById('orgName');
                const orgNameError = document.getElementById('orgNameError');
                if (!orgName) {
                    isValid = false;
                } else if (!orgName.value.trim()) {
                    orgName.classList.add('error');
                    if (orgNameError) orgNameError.classList.add('visible');
                    isValid = false;
                } else {
                    orgName.classList.remove('error');
                    if (orgNameError) orgNameError.classList.remove('visible');
                }
                
                // Primary POC
                const primaryFields = ['primaryPocName', 'primaryPocRole', 'primaryPocTimezone'];
                primaryFields.forEach(id => {
                    const field = document.getElementById(id);
                    if (!field.value.trim()) {
                        field.classList.add('error');
                        isValid = false;
                    } else {
                        field.classList.remove('error');
                    }
                });
                
                // Primary POC Email with validation
                if (!validateEmailField('primaryPocEmail')) {
                    isValid = false;
                }
                
                // Legal POC
                const legalFields = ['legalPocName', 'legalPocRole', 'legalPocTimezone'];
                legalFields.forEach(id => {
                    const field = document.getElementById(id);
                    if (!field || !field.value.trim()) {
                        if (field) field.classList.add('error');
                        isValid = false;
                    } else {
                        field.classList.remove('error');
                    }
                });
                
                // Legal POC Email with validation
                if (!validateEmailField('legalPocEmail')) {
                    isValid = false;
                }
                
                // Technical POC (if integrations required)
                if (formData.section1.integrationsRequired) {
                    const techFields = ['technicalPocName', 'technicalPocTimezone'];
                    techFields.forEach(id => {
                        const field = document.getElementById(id);
                        if (!field.value.trim()) {
                            field.classList.add('error');
                            isValid = false;
                        } else {
                            field.classList.remove('error');
                        }
                    });
                    
                    // Technical POC Email with validation
                    if (!validateEmailField('technicalPocEmail')) {
                        isValid = false;
                    }
                }
                
                // Availability
                const availability = document.getElementById('availability');
                if (!availability.value.trim()) {
                    availability.classList.add('error');
                    isValid = false;
                } else {
                    availability.classList.remove('error');
                }
                
                // Communication Channels
                const selectedChannels = document.querySelectorAll('#communicationChannels .chip.selected');
                const communicationError = document.getElementById('communicationError');
                if (selectedChannels.length === 0) {
                    if (communicationError) communicationError.classList.add('visible');
                    isValid = false;
                } else {
                    if (communicationError) communicationError.classList.remove('visible');
                }
                
                // Expected Go-Live
                const startDate = document.getElementById('implementationStartDate');
                if (!startDate.value) {
                    startDate.classList.add('error');
                    isValid = false;
                } else {
                    startDate.classList.remove('error');
                    // Calculate go-live date
                    calculateGoLiveDate();
                }
                
                const goLive = document.getElementById('expectedGoLive');
                if (!goLive.value) {
                    goLive.classList.add('error');
                    isValid = false;
                } else {
                    goLive.classList.remove('error');
                }
            }
            
            if (section === 2) {
                // Purchased Modules
                const selectedModules = document.querySelectorAll('#purchasedModules .module-card.selected');
                const modulesError = document.getElementById('modulesError');
                if (selectedModules.length === 0) {
                    if (modulesError) modulesError.classList.add('visible');
                    isValid = false;
                } else {
                    if (modulesError) modulesError.classList.remove('visible');
                }
            }
            
            if (section === 5) {
                // Check if Section 5 should be visible (only if integrations are required)
                const integrationsRequired = formData.section1?.integrationsRequired || false;
                if (!integrationsRequired) {
                    // Section 5 is not required, skip validation
                    return true;
                }
                
                // Systems to integrate (required)
                const selectedSystems = document.querySelectorAll('#s5IntegrationSystems .integration-chip.selected');
                if (selectedSystems.length === 0) {
                    isValid = false;
                    // Show error message
                    const systemsContainer = document.getElementById('s5IntegrationSystems');
                    if (systemsContainer) {
                        let errorMsg = systemsContainer.parentElement.querySelector('.error-message');
                        if (!errorMsg) {
                            errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.textContent = 'Please select at least one system to integrate';
                            systemsContainer.parentElement.appendChild(errorMsg);
                        }
                        errorMsg.classList.add('visible');
                    }
                } else {
                    const errorMsg = document.querySelector('#s5IntegrationSystems').parentElement.querySelector('.error-message');
                    if (errorMsg) errorMsg.classList.remove('visible');
                }
                
                // Admin access (required)
                const adminAccess = document.getElementById('s5AdminAccess');
                if (!adminAccess || !adminAccess.value) {
                    if (adminAccess) adminAccess.classList.add('error');
                        isValid = false;
                    } else {
                    adminAccess.classList.remove('error');
                }
                
                // IT approval needed (required)
                const securityApproval = document.getElementById('s5SecurityApproval');
                if (!securityApproval || !securityApproval.value) {
                    if (securityApproval) securityApproval.classList.add('error');
                    isValid = false;
                } else {
                    securityApproval.classList.remove('error');
                }
                
                // Integration Decision Maker (required)
                const decisionMakerName = document.getElementById('s5DecisionMakerName');
                const decisionMakerRole = document.getElementById('s5DecisionMakerRole');
                const decisionMakerEmail = document.getElementById('s5DecisionMakerEmail');
                
                if (!decisionMakerName || !decisionMakerName.value.trim()) {
                    if (decisionMakerName) decisionMakerName.classList.add('error');
                        isValid = false;
                    } else {
                    decisionMakerName.classList.remove('error');
                    }
                    
                if (!decisionMakerRole || !decisionMakerRole.value.trim()) {
                    if (decisionMakerRole) decisionMakerRole.classList.add('error');
                        isValid = false;
                } else {
                    decisionMakerRole.classList.remove('error');
                }
                
                if (!decisionMakerEmail || !decisionMakerEmail.value.trim()) {
                    if (decisionMakerEmail) decisionMakerEmail.classList.add('error');
                    isValid = false;
                } else {
                    decisionMakerEmail.classList.remove('error');
                    // Validate email format
                    if (!validateEmail(decisionMakerEmail.value.trim())) {
                        decisionMakerEmail.classList.add('error');
                        isValid = false;
                    }
                }
                
                // Expected outcomes (required)
                const selectedOutcomes = document.querySelectorAll('#s5IntegrationOutcomes .chip.selected');
                if (selectedOutcomes.length === 0) {
                        isValid = false;
                    // Show error message
                    const outcomesContainer = document.getElementById('s5IntegrationOutcomes');
                    if (outcomesContainer) {
                        let errorMsg = outcomesContainer.parentElement.querySelector('.error-message');
                        if (!errorMsg) {
                            errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.textContent = 'Please select at least one expected outcome';
                            outcomesContainer.parentElement.appendChild(errorMsg);
                        }
                        errorMsg.classList.add('visible');
                    }
                } else {
                    const errorMsg = document.querySelector('#s5IntegrationOutcomes').parentElement.querySelector('.error-message');
                    if (errorMsg) errorMsg.classList.remove('visible');
                }
            }
            
            return isValid;
        }
        
        // ============================================
        // PROSPECT VALIDATION
        // ============================================
        function validateProspectSection(section) {
            let isValid = true;
            
            if (section === 1) {
                // Company name
                const companyName = document.getElementById('prospectCompanyName');
                if (!companyName || !companyName.value.trim()) {
                    if (companyName) companyName.classList.add('error');
                    isValid = false;
                } else {
                    companyName.classList.remove('error');
                }
                
                // Industry
                const industry = document.getElementById('prospectIndustry');
                if (!industry || !industry.value) {
                    if (industry) industry.classList.add('error');
                    isValid = false;
                } else {
                    industry.classList.remove('error');
                }
                
                // User count
                const userCount = document.getElementById('prospectUserCount');
                if (!userCount || !userCount.value) {
                    if (userCount) userCount.classList.add('error');
                    isValid = false;
                } else {
                    userCount.classList.remove('error');
                }
            }
            
            if (section === 2) {
                // Modules interested in
                const selectedModules = document.querySelectorAll('#prospectModules .chip.selected');
                const modulesError = document.getElementById('prospectModulesError');
                if (selectedModules.length === 0) {
                    if (modulesError) modulesError.classList.add('visible');
                    isValid = false;
                } else {
                    if (modulesError) modulesError.classList.remove('visible');
                }
                
                // Assisted Workflows
                const assistedWorkflows = document.getElementById('prospectAssistedWorkflows');
                if (!assistedWorkflows || !assistedWorkflows.value) {
                    if (assistedWorkflows) assistedWorkflows.classList.add('error');
                    isValid = false;
                } else {
                    assistedWorkflows.classList.remove('error');
                }
                
                // Contract Templates
                const contractTemplates = document.getElementById('prospectContractTemplates');
                if (!contractTemplates || !contractTemplates.value) {
                    if (contractTemplates) contractTemplates.classList.add('error');
                    isValid = false;
                } else {
                    contractTemplates.classList.remove('error');
                }
                
                // Assisted Migration
                const assistedMigration = document.getElementById('prospectAssistedMigration');
                if (!assistedMigration || !assistedMigration.value) {
                    if (assistedMigration) assistedMigration.classList.add('error');
                    isValid = false;
                } else {
                    assistedMigration.classList.remove('error');
                }
                
                // Legacy Contracts
                const legacyContracts = document.getElementById('prospectLegacyContracts');
                if (!legacyContracts || !legacyContracts.value) {
                    if (legacyContracts) legacyContracts.classList.add('error');
                    isValid = false;
                } else {
                    legacyContracts.classList.remove('error');
                }
            }
            
            if (section === 3) {
                // Systems used
                const selectedSystems = document.querySelectorAll('#prospectSystems .chip.selected');
                const systemsError = document.getElementById('prospectSystemsError');
                if (selectedSystems.length === 0) {
                    if (systemsError) systemsError.classList.add('visible');
                    isValid = false;
                } else {
                    if (systemsError) systemsError.classList.remove('visible');
                }
                
                // API access
                const apiAccess = document.getElementById('prospectApiAccess');
                if (!apiAccess || !apiAccess.value) {
                    if (apiAccess) apiAccess.classList.add('error');
                    isValid = false;
            } else {
                    apiAccess.classList.remove('error');
                }
            }
            
            if (section === 4) {
                // Go-live timeline
                const goLiveTimeline = document.getElementById('prospectGoLiveTimeline');
                if (!goLiveTimeline || !goLiveTimeline.value) {
                    if (goLiveTimeline) goLiveTimeline.classList.add('error');
                    isValid = false;
                } else {
                    goLiveTimeline.classList.remove('error');
                }
                // Biggest concern is optional, no validation needed
            }
            
            if (section === 5) {
                // All fields in section 5 are optional, no validation needed
            }
            
            return isValid;
        }
        
        // ============================================
        // PROSPECT SAVE DATA
        // ============================================
        function saveProspectSection(section) {
            if (!formData.prospect) {
                formData.prospect = {};
            }
            
            if (section === 1) {
                formData.prospect.section1 = {
                    companyName: document.getElementById('prospectCompanyName').value,
                    industry: document.getElementById('prospectIndustry').value,
                    userCount: document.getElementById('prospectUserCount').value
                };
            }
            
            if (section === 2) {
                formData.prospect.section2 = {
                    modulesInterested: getSelectedChips('prospectModules'),
                    assistedWorkflows: document.getElementById('prospectAssistedWorkflows')?.value || '',
                    contractTemplates: document.getElementById('prospectContractTemplates')?.value || '',
                    assistedMigration: document.getElementById('prospectAssistedMigration')?.value || '',
                    legacyContracts: document.getElementById('prospectLegacyContracts')?.value || ''
                };
            }
            
            if (section === 3) {
                formData.prospect.section3 = {
                    systemsUsed: getSelectedChips('prospectSystems'),
                    apiAccess: document.getElementById('prospectApiAccess').value
                };
            }
            
            if (section === 4) {
                formData.prospect.section4 = {
                    goLiveTimeline: document.getElementById('prospectGoLiveTimeline').value,
                    biggestConcern: document.getElementById('prospectBiggestConcern').value
                };
            }
            
            if (section === 5) {
                formData.prospect.section5 = {
                    internalBottlenecks: document.getElementById('prospectInternalBottlenecks')?.value || '',
                    complianceDeadlines: document.getElementById('prospectComplianceDeadlines')?.value || '',
                    pastCLMExperience: document.getElementById('prospectPastCLMExperience')?.value || ''
                };
            }
            
            autoSave();
        }
        
        // ============================================
        // PROSPECT DATA COLLECTION
        // ============================================
        function collectProspectFormData() {
            return {
                user_type: 'prospect',
                prospect_section_1_basics: {
                    company_name: getValue('prospectCompanyName'),
                    industry: getValue('prospectIndustry'),
                    user_count: getValue('prospectUserCount')
                },
                prospect_section_2_scope_clarity: {
                    modules_interested: getSelectedChips('prospectModules'),
                    assisted_workflows: getValue('prospectAssistedWorkflows'),
                    contract_templates: getValue('prospectContractTemplates'),
                    assisted_migration: getValue('prospectAssistedMigration'),
                    legacy_contracts: getValue('prospectLegacyContracts')
                },
                prospect_section_3_systems_integrations: {
                    systems_used: getSelectedChips('prospectSystems'),
                    api_access: getValue('prospectApiAccess')
                },
                prospect_section_4_timeline_readiness: {
                    go_live_timeline: getValue('prospectGoLiveTimeline'),
                    biggest_concern: getValue('prospectBiggestConcern')
                },
                prospect_section_5_additional_context: {
                    internal_bottlenecks: getValue('prospectInternalBottlenecks'),
                    compliance_deadlines: getValue('prospectComplianceDeadlines'),
                    past_clm_experience: getValue('prospectPastCLMExperience')
                }
            };
        }
        
        // ============================================
        // TEST DATA FUNCTIONS (FOR TESTING ONLY)
        // ============================================
        function fillProspectTestData() {
            try {
                console.log('ðŸ§ª fillProspectTestData called');
                
                // Set user type if not set
                if (!formData.userType) {
                    formData.userType = 'prospect';
                }
                
                // Make all prospect sections visible temporarily to fill them
                for (let i = 1; i <= 4; i++) {
                    const section = document.getElementById(`prospectSection${i}`);
                    if (section) {
                        section.style.display = 'block';
                    }
                }
                
                // Fill Section 1
                const companyName = document.getElementById('prospectCompanyName');
                if (companyName) companyName.value = 'Test Company Inc.';
                
                const industry = document.getElementById('prospectIndustry');
                if (industry) industry.value = 'Technology';
                
                const userCount = document.getElementById('prospectUserCount');
                if (userCount) userCount.value = '10-50';
                
                // Fill Section 2
                const modulesToSelect = ['Repository', 'Approvals'];
                modulesToSelect.forEach(value => {
                    const chip = document.querySelector(`#prospectModules .chip[data-value="${value}"]`);
                    if (chip && !chip.classList.contains('selected')) {
                        chip.click();
                    }
                });
                
                const assistedWorkflows = document.getElementById('prospectAssistedWorkflows');
                if (assistedWorkflows) assistedWorkflows.value = 'Yes';
                
                const contractTemplates = document.getElementById('prospectContractTemplates');
                if (contractTemplates) contractTemplates.value = 'Yes, all available';
                
                const assistedMigration = document.getElementById('prospectAssistedMigration');
                if (assistedMigration) assistedMigration.value = 'Yes';
                
                const legacyContracts = document.getElementById('prospectLegacyContracts');
                if (legacyContracts) legacyContracts.value = 'Yes, some available';
                
                // Fill Section 3
                const systemsToSelect = ['CRM', 'ERP'];
                systemsToSelect.forEach(value => {
                    const chip = document.querySelector(`#prospectSystems .chip[data-value="${value}"]`);
                    if (chip && !chip.classList.contains('selected')) {
                        chip.click();
                    }
                });
                
                const apiAccess = document.getElementById('prospectApiAccess');
                if (apiAccess) apiAccess.value = 'Yes';
                
                // Fill Section 4
                const goLiveTimeline = document.getElementById('prospectGoLiveTimeline');
                if (goLiveTimeline) goLiveTimeline.value = '3-6 months';
                
                const biggestConcern = document.getElementById('prospectBiggestConcern');
                if (biggestConcern) biggestConcern.value = 'Integration complexity and timeline concerns';
                
                // Fill Section 5
                const internalBottlenecks = document.getElementById('prospectInternalBottlenecks');
                if (internalBottlenecks) internalBottlenecks.value = 'Limited IT resources and budget constraints';
                
                const complianceDeadlines = document.getElementById('prospectComplianceDeadlines');
                if (complianceDeadlines) complianceDeadlines.value = 'Q2 2024 compliance deadline';
                
                const pastCLMExperience = document.getElementById('prospectPastCLMExperience');
                if (pastCLMExperience) pastCLMExperience.value = 'Previous experience with DocuSign CLM';
                
                // Save all sections
                saveProspectSection(1);
                saveProspectSection(2);
                saveProspectSection(3);
                saveProspectSection(4);
                saveProspectSection(5);
                
                // Save to LocalStorage
                autoSave();
                
                console.log('âœ… Test data filled, submitting in 500ms...');
                
                // Automatically submit the assessment
                setTimeout(() => {
                    submitProspectAssessment();
                }, 500);
            } catch (error) {
                console.error('âŒ Error filling prospect test data:', error);
                alert('Error filling test data: ' + error.message + '\n\nCheck console for details.');
            }
        }
        
        function fillCustomerTestData() {
            try {
                console.log('ðŸ§ª fillCustomerTestData called');
                
                // Set user type if not set
                if (!formData.userType) {
                    formData.userType = 'customer';
                }
                
                // Make all customer sections visible temporarily to fill them
                for (let i = 1; i <= 7; i++) {
                    const section = document.getElementById(`customerSection${i}`);
                    if (section) {
                        section.style.display = 'block';
                    }
                }
                
                // Fill Section 1
                const primaryName = document.getElementById('customerPrimaryContactName');
                if (primaryName) primaryName.value = 'John Doe';
                
                const primaryRole = document.getElementById('customerPrimaryContactRole');
                if (primaryRole) primaryRole.value = 'Legal Operations Manager';
                
                const templateApprover = document.getElementById('customerTemplateApprover');
                if (templateApprover) templateApprover.value = 'Jane Smith - Legal Director';
                
                const migrationApprover = document.getElementById('customerMigrationApprover');
                if (migrationApprover) migrationApprover.value = 'Mike Johnson - IT Manager';
                
                const integrationApprover = document.getElementById('customerIntegrationApprover');
                if (integrationApprover) integrationApprover.value = 'Sarah Williams - Technical Lead';
                
                // Fill Section 2
                const modules = ['Repository', 'Approvals', 'Assisted Workflows'];
                modules.forEach(value => {
                    const chip = document.querySelector(`#customerPurchasedModules .chip[data-value="${value}"]`);
                    if (chip && !chip.classList.contains('selected')) chip.click();
                });
                
                // Fill Section 3
                const migrationNeeded = document.getElementById('customerMigrationNeeded');
                if (migrationNeeded) {
                    migrationNeeded.value = 'Yes, partial';
                    toggleCustomerMigrationQuestions();
                }
                
                const migrationCount = document.getElementById('customerMigrationContractCount');
                if (migrationCount) migrationCount.value = '500-2000';
                
                const contractStorage = document.getElementById('customerContractStorage');
                if (contractStorage) contractStorage.value = 'Drive';
                
                const dataCleanliness = document.getElementById('customerDataCleanliness');
                if (dataCleanliness) dataCleanliness.value = 'Mixed';
                
                const formats = ['PDF', 'DOC'];
                formats.forEach(value => {
                    const chip = document.querySelector(`#customerDataFormat .chip[data-value="${value}"]`);
                    if (chip && !chip.classList.contains('selected')) chip.click();
                });
                
                // Fill Section 4
                const integrations = ['CRM', 'Salesforce'];
                integrations.forEach(value => {
                    const chip = document.querySelector(`#customerIntegrationSystems .chip[data-value="${value}"]`);
                    if (chip && !chip.classList.contains('selected')) chip.click();
                });
                
                const apiAccess = document.getElementById('customerApiAccess');
                if (apiAccess) apiAccess.value = 'Yes';
                
                const webhooks = document.getElementById('customerWebhooksSupport');
                if (webhooks) webhooks.value = 'Yes';
                
                // Fill Section 5
                const approvalComplexity = document.getElementById('customerApprovalComplexity');
                if (approvalComplexity) approvalComplexity.value = 'Medium (3-5 steps)';
                
                const signers = document.getElementById('customerAgreementSigners');
                if (signers) signers.value = 'Internal plus external';
                
                // Fill Section 6
                const sso = document.getElementById('customerSSORequired');
                if (sso) sso.value = 'Yes';
                
                const securityNeeds = document.getElementById('customerSecurityNeeds');
                if (securityNeeds) securityNeeds.value = 'No';
                
                const dpaStatus = document.getElementById('customerDPAStatus');
                if (dpaStatus) dpaStatus.value = 'Signed';
                
                // Section 7 - No file uploads for test data
                
                // Save all sections
                saveCustomerSection(1);
                saveCustomerSection(2);
                saveCustomerSection(3);
                saveCustomerSection(4);
                saveCustomerSection(5);
                saveCustomerSection(6);
                saveCustomerSection(7);
                
                // Save to LocalStorage
                autoSave();
                
                console.log('âœ… Test data filled, submitting in 500ms...');
                
                // Automatically submit the assessment
                setTimeout(() => {
                    submitCustomerAssessment();
                }, 500);
            } catch (error) {
                console.error('âŒ Error filling customer test data:', error);
                alert('Error filling test data: ' + error.message + '\n\nCheck console for details.');
            }
        }
        
        function fillIMTestData() {
            try {
                console.log('ðŸ§ª fillIMTestData called');
                
                // Set user type if not set
                if (!formData.userType) {
                    formData.userType = 'implementation_manager';
                }
                
                // Make all IM sections visible temporarily to fill them (skip section 5)
                for (let i = 1; i <= 6; i++) {
                    if (i === 5) continue; // Skip section 5 (removed)
                    const section = document.getElementById(`imSection${i}`);
                    if (section) {
                        section.style.display = 'block';
                    }
                }
                
                // Fill Section 1
                const customerName = document.getElementById('imCustomerName');
                if (customerName) customerName.value = 'Acme Corporation';
                
                const package = document.getElementById('imPackage');
                if (package) package.value = 'Enterprise';
                
                const complexity = document.getElementById('imComplexity');
                if (complexity) complexity.value = 'High';
                
                const risks = ['Low responsiveness', 'Lack of template readiness'];
                risks.forEach(value => {
                    const chip = document.querySelector(`#imKnownRisks .chip[data-value="${value}"]`);
                    if (chip && !chip.classList.contains('selected')) chip.click();
                });
                
                // Fill Section 2
                const templateCount = document.getElementById('imTemplateCount');
                if (templateCount) templateCount.value = '15+';
                
                const workflowComplexity = document.getElementById('imWorkflowComplexity');
                if (workflowComplexity) workflowComplexity.value = 'Complex (5+ flows)';
                
                const customDev = document.getElementById('imCustomDevelopment');
                if (customDev) {
                    customDev.value = 'Yes';
                    toggleIMCustomDevelopment();
                }
                
                const customDetails = document.getElementById('imCustomDevelopmentDetails');
                if (customDetails) customDetails.value = 'Custom approval workflows and integration with legacy systems';
                
                // Fill Section 3
                const migrationSupport = document.getElementById('imMigrationEngineeringSupport');
                if (migrationSupport) migrationSupport.value = 'Yes';
                
                const migrationVolume = document.getElementById('imMigrationVolume');
                if (migrationVolume) migrationVolume.value = 'Large';
                
                // Fill Section 4
                const integrationTypes = ['crm', 'custom_api'];
                integrationTypes.forEach(value => {
                    const chip = document.querySelector(`#imIntegrationTypes .chip[data-value="${value}"]`);
                    if (chip && !chip.classList.contains('selected')) chip.click();
                });
                
                const integrationEffort = document.getElementById('imIntegrationEngineeringEffort');
                if (integrationEffort) integrationEffort.value = 'Yes';
                
                const uatRounds = document.getElementById('imIntegrationUATRounds');
                if (uatRounds) uatRounds.value = 'Yes';
                
                // Section 5 - Removed per user request
                
                // Fill Section 6
                const goLive = document.getElementById('imGoLiveExpectation');
                if (goLive) goLive.value = '8-12 weeks';
                
                const blockers = document.getElementById('imKnownBlockers');
                if (blockers) blockers.value = 'Pending security review and API access approval';
                
                // Save all sections
                saveIMSection(1);
                saveIMSection(2);
                saveIMSection(3);
                saveIMSection(4);
                saveIMSection(6);
                
                // Save to LocalStorage
                autoSave();
                
                console.log('âœ… Test data filled, submitting in 500ms...');
                
                // Automatically submit the assessment
                setTimeout(() => {
                    submitIMAssessment();
                }, 500);
            } catch (error) {
                console.error('âŒ Error filling IM test data:', error);
                alert('Error filling test data: ' + error.message + '\n\nCheck console for details.');
            }
        }
        
        // ============================================
        // PROSPECT SUBMIT
        // ============================================
        async function submitProspectAssessment() {
            // Validate last section
            if (!validateProspectSection(5)) return;
            
            // Save last section
            saveProspectSection(5);
            
            const prospectSection5 = document.getElementById('prospectSection5');
            const progressContainer = document.getElementById('progressContainer');
            const loadingScreen = document.getElementById('loadingScreen');
            if (prospectSection5) prospectSection5.classList.remove('active');
            if (progressContainer) progressContainer.style.display = 'none';
            if (loadingScreen) loadingScreen.classList.add('active');
            
            // Reset and start progress animation
            updateLoadingProgress(0, 'Initializing...');
            const progressInterval = startProgressAnimation();
            
            try {
                const prospectData = collectProspectFormData();
                
                const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.ASSESS}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ intake_responses: prospectData })
                });
                
                // Update progress to 98% when response arrives
                clearInterval(progressInterval);
                updateLoadingProgress(98, 'Processing AI response...');
                
                // Check for timeout or other errors
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorData;
                    try {
                        errorData = JSON.parse(errorText);
                    } catch (e) {
                        errorData = { error: errorText || `Server error: ${response.status}` };
                    }
                    throw new Error(errorData.error || `Server error: ${response.status}`);
                }
                
                const result = await response.json();
                if (result.success) {
                    // Complete the progress bar
                    updateLoadingProgress(100, 'Assessment complete!');
                    setTimeout(() => {
                    displayProspectResults(result.data);
                    }, 300);
            } else {
                    throw new Error(result.error || 'Assessment failed');
                }
            } catch (error) {
                clearInterval(progressInterval);
                console.error('Error:', error);
                
                // Hide loading screen
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) loadingScreen.classList.remove('active');
                
                // Restore progress container visibility
                const progressContainer = document.getElementById('progressContainer');
                if (progressContainer) progressContainer.style.display = 'block';
                
                // Show error message and allow user to retry
                updateLoadingProgress(0, 'Error occurred');
                setTimeout(() => {
                    alert('Failed to submit assessment: ' + error.message + '\n\nPlease check your connection and try again.');
                    // Return to form (show prospect section 4)
                    const prospectSection4 = document.getElementById('prospectSection4');
                    if (prospectSection4) prospectSection4.classList.add('active');
                }, 500);
            }
        }
        
        // ============================================
        // PROSPECT RESULTS DISPLAY
        // ============================================
        function displayProspectResults(data) {
            // Hide ALL form sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Hide progress container
            const progressContainer = document.getElementById('progressContainer');
            if (progressContainer) progressContainer.style.display = 'none';
            
            const loadingScreen = document.getElementById('loadingScreen');
            const resultsScreen = document.getElementById('resultsScreen');
            if (loadingScreen) loadingScreen.classList.remove('active');
            if (resultsScreen) resultsScreen.classList.add('active');
            
            // Configure results screen for Prospect persona
            configureResultsScreenForPersona('prospect');
            
            // Display Prospect-specific results
            document.getElementById('overallScore').textContent = data.readiness_score?.overall || '--';
            document.getElementById('scoreStatus').textContent = data.status_label || 'Calculating...';
            document.getElementById('scoreDescription').textContent = data.status_description || '';
            
            // Display score breakdown (only Prospect sections: basics, scope_clarity, systems_integrations, timeline_readiness)
            const prospectSectionMap = {
                'basics': 'Basics',
                'scope_clarity': 'Scope Clarity',
                'systems_integrations': 'Systems & Integrations',
                'timeline_readiness': 'Timeline Readiness'
            };
            const breakdownHtml = Object.entries(data.readiness_score?.breakdown || {})
                .filter(([key]) => prospectSectionMap[key])
                .map(([key, value]) => `
                <div class="score-breakdown-item">
                    <div class="score-breakdown-label">${prospectSectionMap[key] || key.replace(/_/g, ' ')}</div>
                    <div class="score-breakdown-value">${value}%</div>
                    <div class="score-breakdown-bar"><div class="score-breakdown-fill" style="width: ${value}%"></div></div>
                </div>
            `).join('');
            document.getElementById('scoreBreakdown').innerHTML = breakdownHtml;
            
            // Display red flags/key blockers (Prospect-specific)
            const flagsHtml = (data.red_flags || data.key_blockers || []).map(flag => {
                return `
                <div class="red-flag-item ${flag.severity === 'medium' ? 'warning' : ''}">
                    <div class="red-flag-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
                    <div class="red-flag-content"><div class="red-flag-title">${flag.issue || flag}</div><div class="red-flag-desc">${flag.impact || ''}</div></div>
                </div>
            `;
            }).join('');
            document.getElementById('redFlagsList').innerHTML = flagsHtml || '<p style="color: var(--gray-500);">No critical blockers detected.</p>';
            
            // Display preparation list (Prospect-specific)
            const preparationList = data.preparation_list || data.what_to_prepare || [];
            const preparationHtml = preparationList.length > 0 ? `
                <ul style="list-style: none; padding: 0;">
                    ${preparationList.map(item => `<li style="padding: var(--space-sm) 0; border-bottom: 1px solid var(--gray-200);">âœ“ ${item}</li>`).join('')}
                </ul>
            ` : '<p style="color: var(--gray-500);">No specific preparation items identified.</p>';
            document.getElementById('preparationList').innerHTML = preparationHtml;
            
            // Display high-level timeline (Prospect-specific - simplified)
            document.getElementById('timelineSummary').innerHTML = `
                <strong>High-level Timeline:</strong> ${data.implementation_plan?.high_level_timeline || data.implementation_plan?.estimated_timeline || 'TBD'}<br>
                <strong>Estimated Effort Band:</strong> ${data.implementation_plan?.estimated_effort_band || 'TBD'}
            `;
            
            // Display simplified implementation phases (Prospect-specific - high-level only)
            const phasesHtml = (data.implementation_plan?.phases || []).map(phase => {
                return `
                <div class="timeline-phase">
                    <div class="timeline-phase-header">
                        <div>
                            <div class="timeline-phase-title">${phase.name || phase.phase || 'Phase'}</div>
                            <div class="timeline-phase-duration">${phase.duration || 'TBD'}</div>
                        </div>
                    </div>
                    <div class="timeline-phase-content">
                        ${(phase.activities || []).slice(0, 3).map(a => `<div class="timeline-activity">${a}</div>`).join('')}
                        ${(phase.activities || []).length > 3 ? '<div class="timeline-activity" style="color: var(--gray-500); font-style: italic;">... and more</div>' : ''}
                    </div>
                </div>
            `;
            }).join('');
            document.getElementById('implementationPhases').innerHTML = phasesHtml || '<p style="color: var(--gray-500);">Timeline details will be provided after purchase.</p>';
        }
        
        // ============================================
        // PROSPECT TOGGLE FUNCTIONS
        // ============================================
        function toggleProspectMigrationSection() {
            // This function can be used to show/hide migration-related questions
            // Currently, migration questions are always shown but can be skipped based on answer
            const migrationExpected = document.getElementById('prospectMigrationExpected');
            // Migration section visibility logic can be added here if needed
        }
        
        // ============================================
        // CUSTOMER VALIDATION
        // ============================================
        function validateCustomerSection(section) {
            let isValid = true;
            
            if (section === 1) {
                // Primary POC Name
                const primaryName = document.getElementById('customerPrimaryContactName');
                if (!primaryName || !primaryName.value.trim()) {
                    if (primaryName) primaryName.classList.add('error');
                    isValid = false;
                } else {
                    primaryName.classList.remove('error');
                }
                
                // Primary POC Role
                const primaryRole = document.getElementById('customerPrimaryContactRole');
                if (!primaryRole || !primaryRole.value.trim()) {
                    if (primaryRole) primaryRole.classList.add('error');
                    isValid = false;
                } else {
                    primaryRole.classList.remove('error');
                }
                
                // Approving Stakeholder for Templates
                const templateApprover = document.getElementById('customerTemplateApprover');
                if (!templateApprover || !templateApprover.value.trim()) {
                    if (templateApprover) templateApprover.classList.add('error');
                    isValid = false;
                } else {
                    templateApprover.classList.remove('error');
                }
                
                // Approving Stakeholder for Migrations
                const migrationApprover = document.getElementById('customerMigrationApprover');
                if (!migrationApprover || !migrationApprover.value.trim()) {
                    if (migrationApprover) migrationApprover.classList.add('error');
                    isValid = false;
                } else {
                    migrationApprover.classList.remove('error');
                }
                
                // Approving Stakeholder for Integrations
                const integrationApprover = document.getElementById('customerIntegrationApprover');
                if (!integrationApprover || !integrationApprover.value.trim()) {
                    if (integrationApprover) integrationApprover.classList.add('error');
                    isValid = false;
                } else {
                    integrationApprover.classList.remove('error');
                }
            }
            
            if (section === 2) {
                // Purchased modules
                const selectedModules = document.querySelectorAll('#customerPurchasedModules .chip.selected');
                const modulesError = document.getElementById('customerPurchasedModulesError');
                if (selectedModules.length === 0) {
                    if (modulesError) modulesError.classList.add('visible');
                    isValid = false;
                } else {
                    if (modulesError) modulesError.classList.remove('visible');
                }
                // Template count and readiness were removed - no validation needed
            }
            
            if (section === 3) {
                // Migration needed
                const migrationNeeded = document.getElementById('customerMigrationNeeded');
                if (!migrationNeeded || !migrationNeeded.value) {
                    if (migrationNeeded) migrationNeeded.classList.add('error');
                    isValid = false;
                } else {
                    migrationNeeded.classList.remove('error');
                    
                    // If migration is needed, validate migration questions
                    if (migrationNeeded.value !== 'No') {
                        const contractCount = document.getElementById('customerMigrationContractCount');
                        const storage = document.getElementById('customerContractStorage');
                        const cleanliness = document.getElementById('customerDataCleanliness');
                        
                        if (!contractCount || !contractCount.value) {
                            if (contractCount) contractCount.classList.add('error');
                            isValid = false;
                        } else {
                            contractCount.classList.remove('error');
                        }
                        
                        if (!storage || !storage.value) {
                            if (storage) storage.classList.add('error');
                            isValid = false;
                        } else {
                            storage.classList.remove('error');
                        }
                        
                        if (!cleanliness || !cleanliness.value) {
                            if (cleanliness) cleanliness.classList.add('error');
                            isValid = false;
                        } else {
                            cleanliness.classList.remove('error');
                        }
                    }
                }
            }
            
            if (section === 4) {
                // Integration systems
                const selectedSystems = document.querySelectorAll('#customerIntegrationSystems .chip.selected');
                const systemsError = document.getElementById('customerIntegrationSystemsError');
                if (selectedSystems.length === 0) {
                    if (systemsError) systemsError.classList.add('visible');
                    isValid = false;
                } else {
                    if (systemsError) systemsError.classList.remove('visible');
                }
                
                // API access
                const apiAccess = document.getElementById('customerApiAccess');
                if (!apiAccess || !apiAccess.value) {
                    if (apiAccess) apiAccess.classList.add('error');
                    isValid = false;
                } else {
                    apiAccess.classList.remove('error');
                }
                
                // Webhooks support
                const webhooks = document.getElementById('customerWebhooksSupport');
                if (!webhooks || !webhooks.value) {
                    if (webhooks) webhooks.classList.add('error');
                    isValid = false;
                } else {
                    webhooks.classList.remove('error');
                }
            }
            
            if (section === 5) {
                // Approval complexity
                const complexity = document.getElementById('customerApprovalComplexity');
                if (!complexity || !complexity.value) {
                    if (complexity) complexity.classList.add('error');
                    isValid = false;
                } else {
                    complexity.classList.remove('error');
                }
                
                // Conditional routing was removed - no validation needed
                
                // Agreement signers
                const signers = document.getElementById('customerAgreementSigners');
                if (!signers || !signers.value) {
                    if (signers) signers.classList.add('error');
                    isValid = false;
                } else {
                    signers.classList.remove('error');
                }
            }
            
            if (section === 6) {
                // SSO required
                const sso = document.getElementById('customerSSORequired');
                if (!sso || !sso.value) {
                    if (sso) sso.classList.add('error');
                    isValid = false;
                } else {
                    sso.classList.remove('error');
                }
                
                // Security needs
                const securityNeeds = document.getElementById('customerSecurityNeeds');
                if (!securityNeeds || !securityNeeds.value) {
                    if (securityNeeds) securityNeeds.classList.add('error');
                    isValid = false;
                } else {
                    securityNeeds.classList.remove('error');
                }
                
                // DPA status
                const dpaStatus = document.getElementById('customerDPAStatus');
                if (!dpaStatus || !dpaStatus.value) {
                    if (dpaStatus) dpaStatus.classList.add('error');
                    isValid = false;
                } else {
                    dpaStatus.classList.remove('error');
                }
            }
            
            // Section 7 (uploads) has no required fields, always valid
            if (section === 7) {
                return true;
            }
            
            return isValid;
        }
        
        // ============================================
        // CUSTOMER SAVE DATA
        // ============================================
        function saveCustomerSection(section) {
            if (!formData.customer) {
                formData.customer = {};
            }
            
            if (section === 1) {
                formData.customer.section1 = {
                    primaryContactName: document.getElementById('customerPrimaryContactName')?.value || '',
                    primaryContactRole: document.getElementById('customerPrimaryContactRole')?.value || '',
                    templateApprover: document.getElementById('customerTemplateApprover')?.value || '',
                    migrationApprover: document.getElementById('customerMigrationApprover')?.value || '',
                    integrationApprover: document.getElementById('customerIntegrationApprover')?.value || ''
                };
            }
            
            if (section === 2) {
                formData.customer.section2 = {
                    purchasedModules: getSelectedChips('customerPurchasedModules')
                    // Template count and readiness were removed
                };
            }
            
            if (section === 3) {
                formData.customer.section3 = {
                    migrationNeeded: document.getElementById('customerMigrationNeeded').value,
                    migrationContractCount: document.getElementById('customerMigrationContractCount').value,
                    contractStorage: document.getElementById('customerContractStorage').value,
                    dataCleanliness: document.getElementById('customerDataCleanliness').value
                };
            }
            
            if (section === 4) {
                formData.customer.section4 = {
                    integrationSystems: getSelectedChips('customerIntegrationSystems'),
                    apiAccess: document.getElementById('customerApiAccess').value,
                    webhooksSupport: document.getElementById('customerWebhooksSupport').value
                };
            }
            
            if (section === 5) {
                formData.customer.section5 = {
                    approvalComplexity: document.getElementById('customerApprovalComplexity')?.value || '',
                    agreementSigners: document.getElementById('customerAgreementSigners')?.value || ''
                    // Conditional routing was removed
                };
            }
            
            if (section === 6) {
                formData.customer.section6 = {
                    ssoRequired: document.getElementById('customerSSORequired').value,
                    securityNeeds: document.getElementById('customerSecurityNeeds').value,
                    dpaStatus: document.getElementById('customerDPAStatus').value
                };
            }
            
            if (section === 7) {
                formData.customer.section7 = {
                    templates: getFileList('customerTemplates'),
                    sampleContracts: getFileList('customerSampleContracts')
                };
            }
            
            autoSave();
        }
        
        // ============================================
        // CUSTOMER DATA COLLECTION
        // ============================================
        function collectCustomerFormData() {
            return {
                user_type: 'customer',
                customer_section_1_stakeholders: {
                    primary_contact_name: getValue('customerPrimaryContactName'),
                    primary_contact_role: getValue('customerPrimaryContactRole'),
                    technical_contact_name: getValue('customerTechnicalContactName'),
                    technical_contact_role: getValue('customerTechnicalContactRole'),
                    team_distribution: getSelectedChips('customerTeamDistribution'),
                    decision_approver: getValue('customerDecisionApprover')
                },
                customer_section_2_purchased_scope: {
                    purchased_modules: getSelectedChips('customerPurchasedModules'),
                    template_count: getValue('customerTemplateCount'),
                    template_readiness: getValue('customerTemplateReadiness')
                },
                customer_section_3_migration: {
                    migration_needed: getValue('customerMigrationNeeded'),
                    migration_contract_count: getValue('customerMigrationContractCount'),
                    contract_storage: getValue('customerContractStorage'),
                    data_cleanliness: getValue('customerDataCleanliness')
                },
                customer_section_4_integrations: {
                    integration_systems: getSelectedChips('customerIntegrationSystems'),
                    api_access: getValue('customerApiAccess'),
                    webhooks_support: getValue('customerWebhooksSupport')
                },
                customer_section_5_business_processes: {
                    approval_complexity: getValue('customerApprovalComplexity'),
                    agreement_signers: getValue('customerAgreementSigners')
                    // conditional_routing was removed
                },
                customer_section_6_security_access: {
                    sso_required: getValue('customerSSORequired'),
                    security_needs: getValue('customerSecurityNeeds'),
                    dpa_status: getValue('customerDPAStatus')
                },
                customer_section_7_uploads: {
                    templates: getFileList('customerTemplates'),
                    sample_contracts: getFileList('customerSampleContracts')
                }
            };
        }
        
        // ============================================
        // CUSTOMER SUBMIT
        // ============================================
        async function submitCustomerAssessment() {
            // Validate last section
            if (!validateCustomerSection(7)) return;
            
            // Save last section
            saveCustomerSection(7);
            
            const customerSection7 = document.getElementById('customerSection7');
            const progressContainer = document.getElementById('progressContainer');
            const loadingScreen = document.getElementById('loadingScreen');
            if (customerSection7) customerSection7.classList.remove('active');
            if (progressContainer) progressContainer.style.display = 'none';
            if (loadingScreen) loadingScreen.classList.add('active');
            
            // Reset and start progress animation
            updateLoadingProgress(0, 'Initializing...');
            const progressInterval = startProgressAnimation();
            
            try {
                const customerData = collectCustomerFormData();
                
                const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.ASSESS}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ intake_responses: customerData })
                });
                
                // Update progress to 98% when response arrives
                clearInterval(progressInterval);
                updateLoadingProgress(98, 'Processing AI response...');
                
                // Check for timeout or other errors
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorData;
                    try {
                        errorData = JSON.parse(errorText);
                    } catch (e) {
                        errorData = { error: errorText || `Server error: ${response.status}` };
                    }
                    throw new Error(errorData.error || `Server error: ${response.status}`);
                }
                
                const result = await response.json();
                if (result.success) {
                    // Complete the progress bar
                    updateLoadingProgress(100, 'Assessment complete!');
                    setTimeout(() => {
                    displayCustomerResults(result.data);
                    }, 300);
                } else {
                    throw new Error(result.error || 'Assessment failed');
                }
            } catch (error) {
                clearInterval(progressInterval);
                console.error('Error:', error);
                
                // Hide loading screen
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) loadingScreen.classList.remove('active');
                
                // Restore progress container visibility
                const progressContainer = document.getElementById('progressContainer');
                if (progressContainer) progressContainer.style.display = 'block';
                
                // Show error message and allow user to retry
                updateLoadingProgress(0, 'Error occurred');
            setTimeout(() => {
                    alert('Failed to submit assessment: ' + error.message + '\n\nPlease check your connection and try again.');
                    // Return to form (show customer section 7)
                    const customerSection7 = document.getElementById('customerSection7');
                    if (customerSection7) customerSection7.classList.add('active');
                }, 500);
            }
        }
        
        // ============================================
        // CUSTOMER RESULTS DISPLAY
        // ============================================
        function displayCustomerResults(data) {
            // Hide ALL form sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Hide progress container
            const progressContainer = document.getElementById('progressContainer');
            if (progressContainer) progressContainer.style.display = 'none';
            
            const loadingScreen = document.getElementById('loadingScreen');
            const resultsScreen = document.getElementById('resultsScreen');
            if (loadingScreen) loadingScreen.classList.remove('active');
            if (resultsScreen) resultsScreen.classList.add('active');
            
            // Configure results screen for Customer persona
            configureResultsScreenForPersona('customer');
            
            // Display Customer-specific results
            document.getElementById('overallScore').textContent = data.readiness_score?.overall || '--';
            document.getElementById('scoreStatus').textContent = data.status_label || 'Calculating...';
            document.getElementById('scoreDescription').textContent = data.status_description || '';
            
            // Display score breakdown (only Customer sections: stakeholders, purchased_scope, migration, integrations, business_processes, security_access, uploads)
            const customerSectionMap = {
                'stakeholders': 'Stakeholders',
                'purchased_scope': 'Purchased Scope',
                'migration': 'Migration',
                'integrations': 'Integrations',
                'business_processes': 'Business Processes',
                'security_access': 'Security & Access',
                'uploads': 'Uploads'
            };
            const breakdownHtml = Object.entries(data.readiness_score?.breakdown || {})
                .filter(([key]) => customerSectionMap[key])
                .map(([key, value]) => `
                <div class="score-breakdown-item">
                    <div class="score-breakdown-label">${customerSectionMap[key] || key.replace(/_/g, ' ')}</div>
                    <div class="score-breakdown-value">${value}%</div>
                    <div class="score-breakdown-bar"><div class="score-breakdown-fill" style="width: ${value}%"></div></div>
                </div>
            `).join('');
            document.getElementById('scoreBreakdown').innerHTML = breakdownHtml;
            
            // Display blockers by category (Customer-specific: template, migration, integration, security)
            const blockers = data.blockers || data.red_flags || [];
            const flagsHtml = blockers.map(blocker => {
                const category = blocker.category || blocker.section || '';
                const categoryLabel = category === 'template' ? 'Template' : 
                                     category === 'migration' ? 'Migration' : 
                                     category === 'integration' ? 'Integration' : 
                                     category === 'security' ? 'Security' : '';
                return `
                <div class="red-flag-item ${blocker.severity === 'medium' ? 'warning' : ''}">
                    <div class="red-flag-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
                    <div class="red-flag-content"><div class="red-flag-title">${categoryLabel ? categoryLabel + ': ' : ''}${blocker.issue || blocker}</div><div class="red-flag-desc">${blocker.impact || blocker.description || ''}</div></div>
                </div>
            `;
            }).join('');
            document.getElementById('redFlagsList').innerHTML = flagsHtml || '<p style="color: var(--gray-500);">No critical blockers detected.</p>';
            
            // Display action items (Customer-specific: customer and spotdraft teams)
            const actionItems = data.action_items || { customer: [], spotdraft: [] };
            const renderAction = item => {
                const sectionName = item.section || 'General';
                return `
                <div class="action-item">
                    <div class="action-item-priority ${item.priority || 'medium'}"></div>
                    <div class="action-item-content"><div class="action-item-task">${item.task || item}</div><div class="action-item-meta"><span>ðŸ“ ${sectionName}</span><span>ðŸ“… ${item.deadline || 'TBD'}</span><span>ðŸ‘¤ ${item.owner || 'TBD'}</span></div></div>
                </div>`;
            };
            document.getElementById('customerActions').innerHTML = actionItems.customer?.map(renderAction).join('') || '<p style="color: var(--gray-500);">No action items identified.</p>';
            document.getElementById('spotdraftActions').innerHTML = actionItems.spotdraft?.map(renderAction).join('') || '<p style="color: var(--gray-500);">No SpotDraft action items.</p>';
            
            // Display high-level timeline (Customer-specific)
            document.getElementById('timelineSummary').innerHTML = `
                <strong>High-level Timeline:</strong> ${data.implementation_plan?.high_level_timeline || data.implementation_plan?.recommended_go_live || 'TBD'}
            `;
            
            // Display implementation plan preview (Customer-specific)
            const phasesHtml = (data.implementation_plan?.phases || []).map(phase => {
                const status = phase.status || 'Unknown';
                const statusLower = status.toLowerCase();
                const statusClass = statusLower.includes('ready') ? 'ready' : statusLower.includes('block') ? 'blocked' : 'partial';
                return `
                <div class="timeline-phase">
                    <div class="timeline-phase-header">
                        <div>
                            <div class="timeline-phase-title">Phase ${phase.phase || 'N/A'}: ${phase.name || 'Unnamed'}</div>
                            <div class="timeline-phase-duration">${phase.duration || 'TBD'}</div>
                        </div>
                        <span class="timeline-phase-status ${statusClass}">${status}</span>
                    </div>
                    <div class="timeline-phase-content">
                        ${(phase.activities || []).map(a => `<div class="timeline-activity">${a}</div>`).join('')}
                        ${phase.dependencies ? `<div style="margin-top: var(--space-sm); font-size: 0.75rem; color: var(--gray-500);"><strong>Dependencies:</strong> ${phase.dependencies}</div>` : ''}
                    </div>
                </div>
            `;
            }).join('');
            document.getElementById('implementationPhases').innerHTML = phasesHtml || '<p style="color: var(--gray-500);">Implementation plan will be generated after assessment.</p>';
        }
        
        // ============================================
        // IMPLEMENTATION MANAGER VALIDATION
        // ============================================
        function validateIMSection(section) {
            let isValid = true;
            
            if (section === 1) {
                // Customer name
                const customerName = document.getElementById('imCustomerName');
                if (!customerName || !customerName.value.trim()) {
                    if (customerName) customerName.classList.add('error');
                    isValid = false;
                } else {
                    customerName.classList.remove('error');
                }
                
                // Package
                const packageType = document.getElementById('imPackage');
                if (!packageType || !packageType.value) {
                    if (packageType) packageType.classList.add('error');
                    isValid = false;
                } else {
                    packageType.classList.remove('error');
                }
                
                // Complexity
                const complexity = document.getElementById('imComplexity');
                if (!complexity || !complexity.value) {
                    if (complexity) complexity.classList.add('error');
                    isValid = false;
                } else {
                    complexity.classList.remove('error');
                }
                // Known risks are optional, no validation needed
            }
            
            if (section === 2) {
                // Template count
                const templateCount = document.getElementById('imTemplateCount');
                if (!templateCount || !templateCount.value) {
                    if (templateCount) templateCount.classList.add('error');
                    isValid = false;
                } else {
                    templateCount.classList.remove('error');
                }
                
                // Workflow complexity
                const workflowComplexity = document.getElementById('imWorkflowComplexity');
                if (!workflowComplexity || !workflowComplexity.value) {
                    if (workflowComplexity) workflowComplexity.classList.add('error');
                    isValid = false;
                } else {
                    workflowComplexity.classList.remove('error');
                }
                
                // Custom development
                const customDev = document.getElementById('imCustomDevelopment');
                if (!customDev || !customDev.value) {
                    if (customDev) customDev.classList.add('error');
                    isValid = false;
                } else {
                    customDev.classList.remove('error');
                    
                    // If Yes, validate custom development details
                    if (customDev.value === 'Yes') {
                        const customDetails = document.getElementById('imCustomDevelopmentDetails');
                        if (!customDetails || !customDetails.value.trim()) {
                            if (customDetails) customDetails.classList.add('error');
                            isValid = false;
                        } else {
                            customDetails.classList.remove('error');
                        }
                    }
                }
            }
            
            if (section === 3) {
                // Migration engineering support
                const migrationSupport = document.getElementById('imMigrationEngineeringSupport');
                if (!migrationSupport || !migrationSupport.value) {
                    if (migrationSupport) migrationSupport.classList.add('error');
                    isValid = false;
                } else {
                    migrationSupport.classList.remove('error');
                }
                
                // Migration volume
                const migrationVolume = document.getElementById('imMigrationVolume');
                if (!migrationVolume || !migrationVolume.value) {
                    if (migrationVolume) migrationVolume.classList.add('error');
                    isValid = false;
                } else {
                    migrationVolume.classList.remove('error');
                }
            }
            
            if (section === 4) {
                // Integration types
                const selectedIntegrations = document.querySelectorAll('#imIntegrationTypes .chip.selected');
                const integrationsError = document.getElementById('imIntegrationTypesError');
                if (selectedIntegrations.length === 0) {
                    if (integrationsError) integrationsError.classList.add('visible');
                    isValid = false;
                } else {
                    if (integrationsError) integrationsError.classList.remove('visible');
                }
                
                // Engineering effort
                const engineeringEffort = document.getElementById('imIntegrationEngineeringEffort');
                if (!engineeringEffort || !engineeringEffort.value) {
                    if (engineeringEffort) engineeringEffort.classList.add('error');
                    isValid = false;
                } else {
                    engineeringEffort.classList.remove('error');
                }
                
                // UAT rounds
                const uatRounds = document.getElementById('imIntegrationUATRounds');
                if (!uatRounds || !uatRounds.value) {
                    if (uatRounds) uatRounds.classList.add('error');
                    isValid = false;
                } else {
                    uatRounds.classList.remove('error');
                }
            }
            
            if (section === 6) {
                // Go-live expectation
                const goLive = document.getElementById('imGoLiveExpectation');
                if (!goLive || !goLive.value) {
                    if (goLive) goLive.classList.add('error');
                    isValid = false;
                } else {
                    goLive.classList.remove('error');
                }
                // Known blockers is optional, no validation needed
            }
            
            return isValid;
        }
        
        // ============================================
        // IMPLEMENTATION MANAGER SAVE DATA
        // ============================================
        function saveIMSection(section) {
            if (!formData.im) {
                formData.im = {};
            }
            
            if (section === 1) {
                formData.im.section1 = {
                    customerName: document.getElementById('imCustomerName').value,
                    package: document.getElementById('imPackage').value,
                    complexity: document.getElementById('imComplexity').value,
                    knownRisks: getSelectedChips('imKnownRisks')
                };
            }
            
            if (section === 2) {
                formData.im.section2 = {
                    templateCount: document.getElementById('imTemplateCount').value,
                    workflowComplexity: document.getElementById('imWorkflowComplexity').value,
                    customDevelopment: document.getElementById('imCustomDevelopment').value,
                    customDevelopmentDetails: document.getElementById('imCustomDevelopmentDetails').value
                };
            }
            
            if (section === 3) {
                formData.im.section3 = {
                    migrationEngineeringSupport: document.getElementById('imMigrationEngineeringSupport').value,
                    migrationVolume: document.getElementById('imMigrationVolume').value
                };
            }
            
            if (section === 4) {
                formData.im.section4 = {
                    integrationTypes: getSelectedChips('imIntegrationTypes'),
                    integrationEngineeringEffort: document.getElementById('imIntegrationEngineeringEffort').value,
                    integrationUATRounds: document.getElementById('imIntegrationUATRounds').value
                };
            }
            
            if (section === 6) {
                formData.im.section6 = {
                    goLiveExpectation: document.getElementById('imGoLiveExpectation').value,
                    knownBlockers: document.getElementById('imKnownBlockers').value
                };
            }
            
            autoSave();
        }
        
        // ============================================
        // IMPLEMENTATION MANAGER DATA COLLECTION
        // ============================================
        function collectIMFormData() {
            return {
                user_type: 'implementation_manager',
                im_section_1_customer_context: {
                    customer_name: getValue('imCustomerName'),
                    package: getValue('imPackage'),
                    complexity: getValue('imComplexity'),
                    known_risks: getSelectedChips('imKnownRisks')
                },
                im_section_2_scope_deliverables: {
                    template_count: getValue('imTemplateCount'),
                    workflow_complexity: getValue('imWorkflowComplexity'),
                    custom_development: getValue('imCustomDevelopment'),
                    custom_development_details: getValue('imCustomDevelopmentDetails')
                },
                im_section_3_migration_details: {
                    migration_engineering_support: getValue('imMigrationEngineeringSupport'),
                    migration_volume: getValue('imMigrationVolume')
                },
                im_section_4_integrations: {
                    integration_types: getSelectedChips('imIntegrationTypes'),
                    integration_engineering_effort: getValue('imIntegrationEngineeringEffort'),
                    integration_uat_rounds: getValue('imIntegrationUATRounds')
                },
                im_section_5_timeline_expectations: {
                    go_live_expectation: getValue('imGoLiveExpectation'),
                    known_blockers: getValue('imKnownBlockers')
                }
            };
        }
        
        // ============================================
        // IMPLEMENTATION MANAGER SUBMIT
        // ============================================
        async function submitIMAssessment() {
            // Validate last section
            if (!validateIMSection(6)) return;
            
            // Save last section
            saveIMSection(6);
            
            const imSection6 = document.getElementById('imSection6');
            const progressContainer = document.getElementById('progressContainer');
            const loadingScreen = document.getElementById('loadingScreen');
            if (imSection6) imSection6.classList.remove('active');
            if (progressContainer) progressContainer.style.display = 'none';
            if (loadingScreen) loadingScreen.classList.add('active');
            
            // Reset and start progress animation
            updateLoadingProgress(0, 'Initializing...');
            const progressInterval = startProgressAnimation();
            
            try {
                const imData = collectIMFormData();
                
                const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.ASSESS}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ intake_responses: imData })
                });
                
                // Update progress to 98% when response arrives
                clearInterval(progressInterval);
                updateLoadingProgress(98, 'Processing AI response...');
                
                // Check for timeout or other errors
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorData;
                    try {
                        errorData = JSON.parse(errorText);
                    } catch (e) {
                        errorData = { error: errorText || `Server error: ${response.status}` };
                    }
                    throw new Error(errorData.error || `Server error: ${response.status}`);
                }
                
                const result = await response.json();
                if (result.success) {
                    // Complete the progress bar
                    updateLoadingProgress(100, 'Plan generated!');
                    setTimeout(() => {
                    displayIMResults(result.data);
                    }, 300);
                } else {
                    throw new Error(result.error || 'Assessment failed');
                }
            } catch (error) {
                clearInterval(progressInterval);
                console.error('Error:', error);
                
                // Hide loading screen
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) loadingScreen.classList.remove('active');
                
                // Restore progress container visibility
                const progressContainer = document.getElementById('progressContainer');
                if (progressContainer) progressContainer.style.display = 'block';
                
                // Show error message and allow user to retry
                updateLoadingProgress(0, 'Error occurred');
                setTimeout(() => {
                    alert('Failed to submit assessment: ' + error.message + '\n\nPlease check your connection and try again.');
                    // Return to form (show IM section 6)
                    const imSection6 = document.getElementById('imSection6');
                    if (imSection6) imSection6.classList.add('active');
                }, 500);
            }
        }
        
        // ============================================
        // IMPLEMENTATION MANAGER RESULTS DISPLAY
        // ============================================
        function displayIMResults(data) {
            // Hide ALL form sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Hide progress container
            const progressContainer = document.getElementById('progressContainer');
            if (progressContainer) progressContainer.style.display = 'none';
            
            const loadingScreen = document.getElementById('loadingScreen');
            const resultsScreen = document.getElementById('resultsScreen');
            if (loadingScreen) loadingScreen.classList.remove('active');
            if (resultsScreen) resultsScreen.classList.add('active');
            
            // Configure results screen for IM persona
            configureResultsScreenForPersona('implementation_manager');
            
            // Update section titles for IM
            const redFlagsTitle = document.querySelector('#redFlagsSection h3');
            if (redFlagsTitle) redFlagsTitle.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--error)" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>Internal Notes & Risks';
            
            // Update action items tabs for IM (add Internal tab)
            const actionTabs = document.querySelector('#actionItemsSection .action-tabs');
            if (actionTabs && !actionTabs.querySelector('.action-tab[onclick*="internal"]')) {
                actionTabs.innerHTML = '<button class="action-tab active" onclick="switchActionTab(\'customer\')">Customer</button><button class="action-tab" onclick="switchActionTab(\'spotdraft\')">SpotDraft</button><button class="action-tab" onclick="switchActionTab(\'internal\')">Internal</button>';
            }
            
            // Add internal actions container if it doesn't exist
            if (!document.getElementById('internalActions')) {
                const actionItemsContainer = document.querySelector('#actionItemsSection');
                const spotdraftActions = document.getElementById('spotdraftActions');
                if (spotdraftActions && actionItemsContainer) {
                    const internalActions = document.createElement('div');
                    internalActions.className = 'action-tab-content';
                    internalActions.id = 'internalActions';
                    actionItemsContainer.insertBefore(internalActions, spotdraftActions.nextSibling);
                }
            }
            
            // Display IM-specific results (Rocketlane-ready plan)
            document.getElementById('overallScore').textContent = data.readiness_score?.overall || '--';
            document.getElementById('scoreStatus').textContent = data.status_label || 'Plan Generated';
            document.getElementById('scoreDescription').textContent = data.status_description || 'Implementation plan ready';
            
            // Display score breakdown (only IM sections: customer_context, scope_deliverables, migration_details, integrations, internal_dependencies, timeline_expectations)
            const imSectionMap = {
                'customer_context': 'Customer Context',
                'scope_deliverables': 'Scope & Deliverables',
                'migration_details': 'Migration Details',
                'integrations': 'Integrations',
                'internal_dependencies': 'Internal Dependencies',
                'timeline_expectations': 'Timeline Expectations'
            };
            const breakdownHtml = Object.entries(data.readiness_score?.breakdown || {})
                .filter(([key]) => imSectionMap[key])
                .map(([key, value]) => `
                <div class="score-breakdown-item">
                    <div class="score-breakdown-label">${imSectionMap[key] || key.replace(/_/g, ' ')}</div>
                    <div class="score-breakdown-value">${value}%</div>
                    <div class="score-breakdown-bar"><div class="score-breakdown-fill" style="width: ${value}%"></div></div>
                </div>
            `).join('');
            document.getElementById('scoreBreakdown').innerHTML = breakdownHtml;
            
            // Display internal notes/risks (IM-specific)
            const risks = data.red_flags || data.internal_notes || [];
            const flagsHtml = risks.map(risk => {
                return `
                <div class="red-flag-item ${risk.severity === 'medium' ? 'warning' : ''}">
                    <div class="red-flag-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
                    <div class="red-flag-content"><div class="red-flag-title">${risk.issue || risk.category || risk}</div><div class="red-flag-desc">${risk.impact || risk.description || ''}</div></div>
                    </div>
            `;
            }).join('');
            document.getElementById('redFlagsList').innerHTML = flagsHtml || '<p style="color: var(--gray-500);">No risks identified.</p>';
            
            // Display Rocketlane-ready action items (IM-specific: customer, spotdraft, internal)
            const actionItems = data.action_items || { customer: [], spotdraft: [], internal: [] };
            const renderAction = item => {
                return `
                <div class="action-item">
                    <div class="action-item-priority ${item.priority || 'medium'}"></div>
                    <div class="action-item-content"><div class="action-item-task">${item.task || item}</div><div class="action-item-meta"><span>ðŸ“… ${item.deadline || 'TBD'}</span><span>ðŸ‘¤ ${item.owner || 'TBD'}</span></div></div>
                </div>`;
            };
            document.getElementById('customerActions').innerHTML = actionItems.customer?.map(renderAction).join('') || '<p style="color: var(--gray-500);">No customer action items.</p>';
            document.getElementById('spotdraftActions').innerHTML = actionItems.spotdraft?.map(renderAction).join('') || '<p style="color: var(--gray-500);">No SpotDraft action items.</p>';
            const internalActionsEl = document.getElementById('internalActions');
            if (internalActionsEl) {
                internalActionsEl.innerHTML = actionItems.internal?.map(renderAction).join('') || '<p style="color: var(--gray-500);">No internal action items.</p>';
            }
            
            // Display timeline (IM-specific)
            document.getElementById('timelineSummary').innerHTML = `
                <strong>Realistic Go-Live:</strong> ${data.implementation_plan?.recommended_go_live || 'TBD'}<br>
                <strong>Estimated Timeline:</strong> ${data.implementation_plan?.estimated_timeline || 'TBD'}<br>
                ${data.implementation_plan?.internal_notes ? `<strong>Engineering Dependency:</strong> ${data.implementation_plan.internal_notes}` : ''}
            `;
            
            // Display Rocketlane-ready implementation plan (IM-specific with internal notes)
            const phasesHtml = (data.implementation_plan?.phases || []).map(phase => {
                const status = phase.status || 'Planned';
                const statusLower = status.toLowerCase();
                const statusClass = statusLower.includes('ready') ? 'ready' : statusLower.includes('block') ? 'blocked' : 'partial';
                return `
                <div class="timeline-phase">
                    <div class="timeline-phase-header">
                        <div>
                            <div class="timeline-phase-title">Phase ${phase.phase || 'N/A'}: ${phase.name || 'Unnamed'}</div>
                            <div class="timeline-phase-duration">${phase.duration || 'TBD'}</div>
                </div>
                        <span class="timeline-phase-status ${statusClass}">${status}</span>
                </div>
                    <div class="timeline-phase-content">
                        ${(phase.activities || []).map(a => `<div class="timeline-activity">${a}</div>`).join('')}
                        ${phase.dependencies ? `<div style="margin-top: var(--space-sm); font-size: 0.75rem; color: var(--gray-500);"><strong>Dependencies:</strong> ${phase.dependencies}</div>` : ''}
                        ${phase.internal_notes ? `<div style="margin-top: var(--space-sm); font-size: 0.75rem; color: var(--primary);"><strong>Internal Notes:</strong> ${phase.internal_notes}</div>` : ''}
                    </div>
                </div>
            `;
            }).join('');
            document.getElementById('implementationPhases').innerHTML = phasesHtml || '<p style="color: var(--gray-500);">Implementation plan will be generated.</p>';
        }
        
        // ============================================
        // IMPLEMENTATION MANAGER TOGGLE FUNCTIONS
        // ============================================
        function toggleIMCustomDevelopment() {
            const customDev = document.getElementById('imCustomDevelopment');
            const customSection = document.getElementById('imCustomDevelopmentSection');
            const customDetails = document.getElementById('imCustomDevelopmentDetails');
            
            if (customDev && customSection) {
                if (customDev.value === 'Yes') {
                    customSection.classList.add('visible');
                    if (customDetails) customDetails.required = true;
                } else {
                    customSection.classList.remove('visible');
                    if (customDetails) {
                        customDetails.required = false;
                        customDetails.value = '';
                    }
                }
            }
        }
        
        // ============================================
        // CUSTOMER TOGGLE FUNCTIONS
        // ============================================
        function toggleCustomerMigrationQuestions() {
            const migrationNeeded = document.getElementById('customerMigrationNeeded');
            const migrationSection = document.getElementById('customerMigrationQuestionsSection');
            
            if (migrationNeeded && migrationSection) {
                if (migrationNeeded.value === 'No') {
                    migrationSection.classList.remove('visible');
                    // Clear required validation on migration questions
                    const contractCount = document.getElementById('customerMigrationContractCount');
                    const storage = document.getElementById('customerContractStorage');
                    const cleanliness = document.getElementById('customerDataCleanliness');
                    if (contractCount) contractCount.required = false;
                    if (storage) storage.required = false;
                    if (cleanliness) cleanliness.required = false;
                } else {
                    migrationSection.classList.add('visible');
                    // Make migration questions required
                    const contractCount = document.getElementById('customerMigrationContractCount');
                    const storage = document.getElementById('customerContractStorage');
                    const cleanliness = document.getElementById('customerDataCleanliness');
                    if (contractCount) contractCount.required = true;
                    if (storage) storage.required = true;
                    if (cleanliness) cleanliness.required = true;
                }
            }
        }
        
        // ============================================
        // SAVE DATA
        // ============================================
        function saveSection(section) {
            if (section === 0) {
                // User type is already saved in selectUserType function
                // This function is called for consistency but userType is already in formData
                return;
            }
            
            if (section === 1) {
                formData.section1 = {
                    orgName: document.getElementById('orgName').value,
                    primaryPoc: {
                        name: document.getElementById('primaryPocName').value,
                        role: document.getElementById('primaryPocRole').value,
                        email: document.getElementById('primaryPocEmail').value,
                        timezone: document.getElementById('primaryPocTimezone').value
                    },
                    legalPoc: {
                        name: document.getElementById('legalPocName').value,
                        role: document.getElementById('legalPocRole').value,
                        email: document.getElementById('legalPocEmail').value,
                        timezone: document.getElementById('legalPocTimezone').value
                    },
                    integrationsRequired: formData.section1.integrationsRequired,
                    technicalPoc: formData.section1.integrationsRequired ? {
                        name: document.getElementById('technicalPocName').value,
                        email: document.getElementById('technicalPocEmail').value,
                        timezone: document.getElementById('technicalPocTimezone').value
                    } : null,
                    availability: document.getElementById('availability').value,
                    communicationChannels: getSelectedChips('communicationChannels'),
                    implementationStartDate: document.getElementById('implementationStartDate').value,
                    expectedGoLive: document.getElementById('expectedGoLive').value
                };
                
            }
            
            if (section === 2) {
                formData.section2 = {
                    purchasedModules: getSelectedModules(),
                    integrations: getSelectedIntegrations(),
                    additionalAddons: document.getElementById('additionalAddons').value
                };
                
            }
            
            autoSave();
        }
        
        // ============================================
        // TOGGLE FUNCTIONS
        // ============================================
        function toggleIntegrations() {
            const toggle = document.getElementById('integrationsToggle');
            const label = document.getElementById('integrationsToggleLabel');
            const section = document.getElementById('technicalPocSection');
            
            toggle.classList.toggle('active');
            formData.section1.integrationsRequired = toggle.classList.contains('active');
            label.textContent = formData.section1.integrationsRequired ? 'Yes' : 'No';
            
            // Only show/hide Technical POC section within Section 1
            // Section 5 visibility is controlled by navigation logic
            if (formData.section1.integrationsRequired) {
                if (section) section.classList.add('visible');
            } else {
                if (section) section.classList.remove('visible');
            }
        }
        
        function toggleChip(chip) {
            chip.classList.toggle('selected');
        }
        
        function getSelectedChips(containerId) {
            const chips = document.querySelectorAll(`#${containerId} .chip.selected`);
            return Array.from(chips).map(chip => chip.dataset.value);
        }
        
        // ============================================
        // MODULE CARDS
        // ============================================
        function toggleModule(card) {
            card.classList.toggle('selected');
            updateModuleConditionalSections();
            
            // Update formData
            formData.section2.purchasedModules = getSelectedModules();
        }
        
        function getSelectedModules() {
            const cards = document.querySelectorAll('#purchasedModules .module-card.selected');
            return Array.from(cards).map(card => card.dataset.value);
        }
        
        function updateModuleConditionalSections() {
            // No conditional sections in Section 2 anymore
            // This function is kept for backward compatibility but does nothing
        }
        
        // ============================================
        // INTEGRATION CHIPS
        // ============================================
        function toggleIntegrationChip(chip) {
            chip.classList.toggle('selected');
        }
        
        function getSelectedIntegrations() {
            // Integration systems moved to Section 5 - this function kept for backward compatibility
            // Returns empty array since integrations are no longer in Section 2
            return [];
        }
        
        // ============================================
        // API CONFIGURATION
        // ============================================
        const API_BASE_URL = 'http://localhost:3000'; // Update this to your server URL
        
        // ============================================
        // ============================================
        // GENERIC TOGGLE
        // ============================================
        function toggleGeneric(element) {
            if (!element) return;
            element.classList.toggle('active');
            const label = element.nextElementSibling;
            if (label && label.classList.contains('toggle-label')) {
                label.textContent = element.classList.contains('active') ? 'Yes' : 'No';
            }
        }
        
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                const isCurrentlyVisible = section.classList.contains('visible');
                section.classList.toggle('visible');
            }
        }
        
        function handleSecurityReviewChange() {
            const select = document.getElementById('s7SecurityReview');
            const section = document.getElementById('s7SecurityReviewSection');
            if (select && section) {
                if (select.value === 'Yes') {
                    section.classList.add('visible');
                } else {
                    section.classList.remove('visible');
                    // Clear selected chips when hiding
                    document.querySelectorAll('#s7SecurityReviews .chip.selected').forEach(chip => {
                        chip.classList.remove('selected');
                    });
                }
            }
        }
        
        
        // ============================================
        // DATA COLLECTION
        // ============================================
        function getValue(id) {
            const el = document.getElementById(id);
            return el ? el.value : '';
        }
        
        function getNumericValue(id) {
            const val = getValue(id);
            return val ? parseInt(val) : null;
        }
        
        function isToggleActive(id) {
            const el = document.getElementById(id);
            return el ? el.classList.contains('active') : false;
        }
        
        function getSelectedIntegrationsFromSection(containerId) {
            const chips = document.querySelectorAll(`#${containerId} .integration-chip.selected`);
            return Array.from(chips).map(chip => chip.dataset.value);
        }
        
        function getFileList(id) {
            const el = document.getElementById(id);
            return el && el.files ? Array.from(el.files).map(f => f.name) : [];
        }
        
        function collectAllFormData() {
            return {
                user_type: formData.userType || '',
                section_1_account_stakeholder: {
                    organisation_name: getValue('orgName'),
                    primary_poc: { name: getValue('primaryPocName'), role: getValue('primaryPocRole'), email: getValue('primaryPocEmail'), timezone: getValue('primaryPocTimezone') },
                    legal_poc: { name: getValue('legalPocName'), role: getValue('legalPocRole'), email: getValue('legalPocEmail'), timezone: getValue('legalPocTimezone') },
                    integrations_required: isToggleActive('integrationsToggle'),
                    technical_poc: isToggleActive('integrationsToggle') ? { name: getValue('technicalPocName'), email: getValue('technicalPocEmail'), timezone: getValue('technicalPocTimezone') } : null,
                    availability: getValue('availability'),
                    communication_channels: getSelectedChips('communicationChannels'),
                    implementation_start_date: getValue('implementationStartDate'),
                    expected_go_live: getValue('expectedGoLive')
                },
                section_2_order_form_scope: {
                    purchased_modules: getSelectedModules(),
                    integrations: getSelectedIntegrations(),
                    additional_addons: getValue('additionalAddons')
                },
                section_3_template_readiness: {
                    template_count: getNumericValue('s3TemplateCount'),
                    templates_finalized_count: getNumericValue('s3TemplatesFinalized'),
                    integrated_templates_count: getNumericValue('s3IntegratedTemplates'),
                    template_formats: getSelectedChips('s3TemplateFormats'),
                    dynamic_rendering_needed: getValue('s3DynamicRendering'),
                    dynamic_rendering_complexity: getValue('s3DynamicRenderingComplexity'),
                    conditional_logic: getValue('s3ConditionalLogic'),
                    merged_templates: isToggleActive('s3MergedTemplates'),
                    clause_level_changes: isToggleActive('s3ClauseChanges'),
                    language_variations: isToggleActive('s3LanguageVariations'),
                    calculations_involved: isToggleActive('s3Calculations'),
                    approval_matrices_exist: isToggleActive('s3ApprovalMatrices')
                },
                section_4_migration_readiness: {
                    contract_count: getNumericValue('s4ContractCount'),
                    contract_types: getValue('s4ContractTypes'),
                    metadata_fields_standard: true,
                    metadata_fields_customised: isToggleActive('s4MetadataFieldsCustomised'),
                    custom_metadata: getValue('s4CustomMetadata'),
                    storage_locations: getSelectedChips('s4StorageLocation'),
                    structured_naming: getValue('s4NamingConvention'),
                    contract_formats: getSelectedChips('s4ContractFormats'),
                    existing_metadata: getValue('s4ExistingMetadata'),
                    excel_trackers: isToggleActive('s4ExcelTrackers'),
                    migration_priority: getValue('s4MigrationPriority')
                },
                section_5_integration_readiness: (() => {
                    // Always collect integration data - use empty/default values if Section 5 was skipped
                    const integrationsRequired = isToggleActive('integrationsToggle');
                    if (!integrationsRequired) {
                        // If integrations not required, return empty/default values
                        return {
                            systems_to_integrate: [],
                            custom_integration: false,
                            custom_integration_details: '',
                            api_webhook_access: false,
                            admin_access: '',
                            security_approval: '',
                            decision_maker: { name: '', role: '', email: '' },
                            expected_outcomes: []
                        };
                    }
                    // If integrations required, collect actual data from Section 5
                    return {
                    systems_to_integrate: getSelectedIntegrationsFromSection('s5IntegrationSystems'),
                    custom_integration: isToggleActive('s5CustomIntegration'),
                    custom_integration_details: getValue('s5CustomIntegrationDetails'),
                    api_webhook_access: isToggleActive('s5ApiAccess'),
                    admin_access: getValue('s5AdminAccess'),
                    security_approval: getValue('s5SecurityApproval'),
                    decision_maker: { name: getValue('s5DecisionMakerName'), role: getValue('s5DecisionMakerRole'), email: getValue('s5DecisionMakerEmail') },
                    expected_outcomes: getSelectedChips('s5IntegrationOutcomes')
                    };
                })(),
                section_6_business_process: {
                    approval_workflow: getValue('s6ApprovalWorkflow'),
                    workflow_details: getValue('s6WorkflowDetails'),
                    contract_generators: getSelectedChips('s6ContractGenerators'),
                    bottlenecks: getValue('s6Bottlenecks'),
                    phase1_must_haves: getValue('s6Phase1MustHaves'),
                    phase2_nice_to_haves: getValue('s6Phase2NiceToHaves')
                },
                section_7_security_compliance: {
                    security_review: getValue('s7SecurityReview'),
                    security_reviews_needed: getSelectedChips('s7SecurityReviews'),
                    infosec_approvals: getValue('s7InfosecApprovals'),
                    infosec_details: getValue('s7InfosecDetails'),
                    data_residency: getValue('s7DataResidency'),
                    data_residency_details: getValue('s7DataResidencyDetails'),
                    custom_sso: getValue('s7CustomSSO'),
                    sso_details: getValue('s7SSODetails')
                },
                section_8_uploads: {
                    templates: getFileList('s8Templates'),
                    approval_matrices: getFileList('s8ApprovalMatrices'),
                    sample_contracts: getFileList('s8SampleContracts'),
                    integration_docs: getFileList('s8IntegrationDocs'),
                    brand_guidelines: getFileList('s8BrandGuidelines')
                }
            };
        }
        
        // ============================================
        // SUBMIT ASSESSMENT
        // ============================================
        // Progress bar animation function
        function updateLoadingProgress(percentage, text) {
            const progressFill = document.getElementById('loadingProgressFill');
            const progressText = document.getElementById('loadingProgressText');
            if (progressFill) {
                progressFill.style.width = percentage + '%';
            }
            if (progressText) {
                progressText.textContent = text;
            }
        }
        
        // Simulate progress while waiting for AI
        function startProgressAnimation() {
            // Evenly distribute progress from 10% to 95% across 8 stages
            const stages = [
                { progress: 10, text: 'Preparing assessment data...' },
                { progress: 25, text: 'Sending request to AI...' },
                { progress: 40, text: 'AI is analyzing your responses...' },
                { progress: 55, text: 'Calculating readiness scores...' },
                { progress: 70, text: 'Identifying red flags and risks...' },
                { progress: 82, text: 'Generating action items...' },
                { progress: 90, text: 'Creating implementation plan...' },
                { progress: 95, text: 'Finalizing assessment...' }
            ];
            
            let currentStage = 0;
            const totalStages = stages.length;
            // Each stage gets more time (4 seconds each = ~32 seconds total for all stages)
            // This ensures we spend adequate time on each stage before reaching "Finalizing"
            const intervalTime = 4000;
            
            const interval = setInterval(() => {
                if (currentStage < totalStages) {
                    updateLoadingProgress(stages[currentStage].progress, stages[currentStage].text);
                    currentStage++;
                } else {
                    // Once all stages are shown, keep at 95% until response arrives
                    // Don't update again, just maintain at 95%
                }
            }, intervalTime);
            
            return interval;
        }
        
        async function submitAssessment() {
            const section8 = document.getElementById('section8');
            const progressContainer = document.getElementById('progressContainer');
            const loadingScreen = document.getElementById('loadingScreen');
            if (section8) section8.classList.remove('active');
            if (progressContainer) progressContainer.style.display = 'none';
            if (loadingScreen) loadingScreen.classList.add('active');
            
            // Reset and start progress animation
            updateLoadingProgress(0, 'Initializing...');
            const progressInterval = startProgressAnimation();
            
            try {
                const allData = collectAllFormData();
                
                const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.ASSESS}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ intake_responses: allData })
                });
                
                // Update progress to 98% when response arrives
                clearInterval(progressInterval);
                updateLoadingProgress(98, 'Processing AI response...');
                
                // Check for timeout or other errors
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorData;
                    try {
                        errorData = JSON.parse(errorText);
                    } catch (e) {
                        errorData = { error: errorText || `Server error: ${response.status}` };
                    }
                    throw new Error(errorData.error || `Server error: ${response.status}`);
                }
                
                const result = await response.json();
                if (result.success) {
                    // Complete the progress bar
                    updateLoadingProgress(100, 'Assessment complete!');
                    setTimeout(() => {
                        // Route to persona-specific display function
                        const userType = formData.userType || (allData.user_type || '');
                        if (userType === 'prospect') {
                            displayProspectResults(result.data);
                        } else if (userType === 'customer') {
                            displayCustomerResults(result.data);
                        } else if (userType === 'implementation_manager') {
                            displayIMResults(result.data);
                        } else {
                            // Fallback to generic display
                    displayResults(result.data);
                        }
                    }, 300);
                } else {
                    throw new Error(result.error || 'Assessment failed');
                }
            } catch (error) {
                clearInterval(progressInterval);
                console.error('Error:', error);
                
                // Hide loading screen
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) loadingScreen.classList.remove('active');
                
                // Restore progress container visibility
                const progressContainer = document.getElementById('progressContainer');
                if (progressContainer) progressContainer.style.display = 'block';
                
                // Show error message and allow user to retry
                updateLoadingProgress(0, 'Error occurred');
                setTimeout(() => {
                    alert('Failed to submit assessment: ' + error.message + '\n\nPlease check your connection and try again.');
                    // Return to form (show section 8)
                    const section8 = document.getElementById('section8');
                    if (section8) section8.classList.add('active');
                }, 500);
            }
        }
        
        // ============================================
        // DISPLAY RESULTS
        // ============================================
        function displayResults(data) {
            // Fallback display function for backward compatibility
            // Hide ALL form sections first
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none'; // Force hide
            });
            
            // Hide progress container
            const progressContainer = document.getElementById('progressContainer');
            if (progressContainer) progressContainer.style.display = 'none';
            
            const loadingScreen = document.getElementById('loadingScreen');
            const resultsScreen = document.getElementById('resultsScreen');
            if (loadingScreen) loadingScreen.classList.remove('active');
            if (resultsScreen) resultsScreen.classList.add('active');
            
            // Show all sections for backward compatibility
            configureResultsScreenForPersona('customer'); // Default to customer view
            
            document.getElementById('overallScore').textContent = data.readiness_score?.overall || '--';
            document.getElementById('scoreStatus').textContent = data.status_label || 'Calculating...';
            document.getElementById('scoreDescription').textContent = data.status_description || '';
            
            const breakdownHtml = Object.entries(data.readiness_score.breakdown).map(([key, value]) => `
                <div class="score-breakdown-item">
                    <div class="score-breakdown-label">${key.replace(/_/g, ' ')}</div>
                    <div class="score-breakdown-value">${value}%</div>
                    <div class="score-breakdown-bar"><div class="score-breakdown-fill" style="width: ${value}%"></div></div>
                </div>
            `).join('');
            document.getElementById('scoreBreakdown').innerHTML = breakdownHtml;
            
            // Map section variable names to human-readable names
            const sectionNameMap = {
                'account_stakeholder': 'Account & Stakeholder',
                'order_form_scope': 'Order Form Scope',
                'template_readiness': 'Template Readiness',
                'migration_readiness': 'Migration Readiness',
                'integration_readiness': 'Integration Readiness',
                'business_process': 'Business Process',
                'security_compliance': 'Security & Compliance',
                'uploads': 'Uploads',
                'Security & Compliance': 'Security & Compliance',
                'Template Readiness': 'Template Readiness',
                'Integration Readiness': 'Integration Readiness',
                'Migration Readiness': 'Migration Readiness',
                'Account & Stakeholder': 'Account & Stakeholder',
                'Order Form Scope': 'Order Form Scope',
                'Business Process': 'Business Process',
                'Uploads': 'Uploads'
            };
            
            const getSectionName = (section) => {
                return sectionNameMap[section] || section.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            };
            
            const flagsHtml = data.red_flags.map(flag => {
                const sectionName = getSectionName(flag.section);
                return `
                <div class="red-flag-item ${flag.severity === 'medium' ? 'warning' : ''}">
                    <div class="red-flag-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div>
                    <div class="red-flag-content"><div class="red-flag-title">${sectionName}: ${flag.issue}</div><div class="red-flag-desc">${flag.impact}</div></div>
                </div>
            `;
            }).join('');
            document.getElementById('redFlagsList').innerHTML = flagsHtml || '<p style="color: var(--gray-500);">No critical red flags detected.</p>';
            
            const renderAction = item => {
                const sectionName = getSectionName(item.section);
                return `
                <div class="action-item">
                    <div class="action-item-priority ${item.priority}"></div>
                    <div class="action-item-content"><div class="action-item-task">${item.task}</div><div class="action-item-meta"><span>ðŸ“ ${sectionName}</span><span>ðŸ“… ${item.deadline || 'TBD'}</span><span>ðŸ‘¤ ${item.owner || 'TBD'}</span></div></div>
                </div>`;
            };
            document.getElementById('customerActions').innerHTML = data.action_items.customer.map(renderAction).join('');
            document.getElementById('spotdraftActions').innerHTML = data.action_items.spotdraft.map(renderAction).join('');
            
            document.getElementById('timelineSummary').innerHTML = `<strong>Recommended Go-Live:</strong> ${data.implementation_plan.recommended_go_live}${data.implementation_plan.timeline_adjusted ? `<br><small style="color: var(--warning);">Adjusted: ${data.implementation_plan.adjustment_reason}</small>` : ''}`;
            
            const phasesHtml = data.implementation_plan.phases.map(phase => {
                const status = phase.status || 'Unknown';
                const statusLower = status.toLowerCase();
                const statusClass = statusLower.includes('ready') ? 'ready' : statusLower.includes('block') ? 'blocked' : 'partial';
                return `
                <div class="timeline-phase">
                    <div class="timeline-phase-header"><div><div class="timeline-phase-title">Phase ${phase.phase || 'N/A'}: ${phase.name || 'Unnamed'}</div><div class="timeline-phase-duration">${phase.duration || 'TBD'}</div></div><span class="timeline-phase-status ${statusClass}">${status}</span></div>
                    <div class="timeline-phase-content">${(phase.activities || []).map(a => `<div class="timeline-activity">${a}</div>`).join('')}${phase.dependencies ? `<div style="margin-top: var(--space-sm); font-size: 0.75rem; color: var(--gray-500);"><strong>Dependencies:</strong> ${phase.dependencies}</div>` : ''}</div>
                </div>
            `;
            }).join('');
            document.getElementById('implementationPhases').innerHTML = phasesHtml;
            
        }
        
        function switchActionTab(tab) {
            document.querySelectorAll('.action-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.action-tab-content').forEach(c => c.classList.remove('active'));
            if (event && event.target) event.target.classList.add('active');
            const tabContent = document.getElementById(`${tab}Actions`);
            if (tabContent) tabContent.classList.add('active');
        }
        
        // Helper function to show/hide results sections based on persona
        function configureResultsScreenForPersona(persona) {
            const redFlagsSection = document.getElementById('redFlagsSection');
            const actionItemsSection = document.getElementById('actionItemsSection');
            const implementationPlanSection = document.getElementById('implementationPlanSection');
            const preparationListSection = document.getElementById('preparationListSection');
            
            if (persona === 'prospect') {
                // Prospect: Show Red Flags, Preparation List, High-level Timeline
                if (redFlagsSection) redFlagsSection.style.display = 'block';
                if (actionItemsSection) actionItemsSection.style.display = 'none';
                if (implementationPlanSection) implementationPlanSection.style.display = 'block';
                if (preparationListSection) preparationListSection.style.display = 'block';
            } else if (persona === 'customer') {
                // Customer: Show Red Flags, Action Items, Implementation Plan
                if (redFlagsSection) redFlagsSection.style.display = 'block';
                if (actionItemsSection) actionItemsSection.style.display = 'block';
                if (implementationPlanSection) implementationPlanSection.style.display = 'block';
                if (preparationListSection) preparationListSection.style.display = 'none';
            } else if (persona === 'implementation_manager') {
                // IM: Show Internal Notes/Risks, Action Items (with internal), Rocketlane Plan
                if (redFlagsSection) redFlagsSection.style.display = 'block';
                if (actionItemsSection) actionItemsSection.style.display = 'block';
                if (implementationPlanSection) implementationPlanSection.style.display = 'block';
                if (preparationListSection) preparationListSection.style.display = 'none';
            }
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        // Calculate go-live date from implementation start date (8-12 weeks)
        function calculateGoLiveDate() {
            const startDateInput = document.getElementById('implementationStartDate');
            const goLiveInput = document.getElementById('expectedGoLive');
            
            if (startDateInput && goLiveInput && startDateInput.value) {
                const startDate = new Date(startDateInput.value);
                if (startDate && !isNaN(startDate.getTime())) {
                    // Calculate 10 weeks from start date (middle of 8-12 week range)
                    const goLiveDate = new Date(startDate);
                    goLiveDate.setDate(goLiveDate.getDate() + (10 * 7)); // 10 weeks = 70 days
                    
                    // Ensure go-live is not in the past
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    if (goLiveDate < today) {
                        goLiveDate.setTime(today.getTime());
                    }
                    
                    goLiveInput.value = goLiveDate.toISOString().split('T')[0];
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Set minimum date for implementation start to today
            const today = new Date().toISOString().split('T')[0];
            const startDateInput = document.getElementById('implementationStartDate');
            if (startDateInput) {
                startDateInput.setAttribute('min', today);
                startDateInput.addEventListener('change', calculateGoLiveDate);
            }
            
            // Ensure all sections are properly hidden initially (except section 1 which will be shown on start)
            // Remove active class from all sections
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Initialize Section 5 - always hidden initially, shown only when navigating to it
            const section5 = document.getElementById('section5');
            if (section5) {
                section5.style.display = 'none'; // Hidden by default, shown during navigation if needed
            }
            
            // Initialize all Prospect sections - hidden by default
            for (let i = 1; i <= 4; i++) {
                const prospectSection = document.getElementById(`prospectSection${i}`);
                if (prospectSection) {
                    prospectSection.style.display = 'none';
                }
            }
            
            // Initialize all Customer sections - hidden by default
            for (let i = 1; i <= 7; i++) {
                const customerSection = document.getElementById(`customerSection${i}`);
                if (customerSection) {
                    customerSection.style.display = 'none';
                }
            }
            
            // Initialize all IM sections - hidden by default
            for (let i = 1; i <= 6; i++) {
                const imSection = document.getElementById(`imSection${i}`);
                if (imSection) {
                    imSection.style.display = 'none';
                }
            }
            
            // Initialize IM custom development section - hidden by default (already hidden via CSS)
        });
    </script>
    
    <!-- Auto-Save UI Elements -->
    <div id="saveIndicator" class="save-indicator">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 6L9 17l-5-5"/>
        </svg>
        Saved
    </div>
    
    <!-- Restore Prompt -->
    <div id="restorePrompt" class="restore-prompt">
        <h3>Restore Saved Progress?</h3>
        <p>We found saved form data from a previous session. Would you like to restore it and continue where you left off?</p>
        <div class="restore-prompt-actions">
            <button class="restore-btn secondary" onclick="document.getElementById('restorePrompt').style.display='none'; clearLocalStorage();">Start Fresh</button>
            <button class="restore-btn primary" onclick="document.getElementById('restorePrompt').style.display='none'; restoreFormFields();">Restore</button>
        </div>
    </div>
</body>
</html>